<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
<meta name="theme-color" content="#020704">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>নামাজের ওয়াক্ত</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="shortcut icon" href="mosque.png" type="image/x-icon">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Aref+Ruqaa+Ink:wght@400;700&family=Scheherazade+New:wght@400;500;600;700&family=Noto+Naskh+Arabic:wght@400;500;600;700&family=Tiro+Bangla:ital@0;1&family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* Force GPU layer for main scroll container */
.root{ transform:translateZ(0); }
/* Contain paint for fixed panels */
.panel{ contain:content; }
/* Smooth scrolling */
html{ scroll-behavior:smooth; }
/* Tap targets minimum 44px */
.t-btn{ min-height:44px; }
</style>

<style>
/* ══════════════════════════════════════════════════
   DESIGN TOKENS
══════════════════════════════════════════════════ */
:root{
  --void:#010402; --abyss:#030906; --deep:#050e07; --forest:#071209; --canopy:#0a1c0d;
  --jade:#0e5c38; --jade2:#117a4a; --jade3:#159c5e; --jade4:#1abf72;
  --Au1:#8a6010; --Au2:#b8921e; --Au3:#d4a832; --Au4:#e8bf50;
  --Au5:#f5d870; --Au6:#fdeea0; --Au7:#fff8d0;
  --ink:#faf4e4; --vellum:#f0e6c8; --faded:#c8bea0; --mist:#6a7860; --ash:#3e4a38;
  --card:rgba(7,18,9,.88); --card2:rgba(10,24,12,.93); --card3:rgba(13,32,16,.96);
  --rim0:rgba(184,146,30,.10); --rim1:rgba(184,146,30,.22);
  --rim2:rgba(184,146,30,.42); --rim3:rgba(184,146,30,.68);
  --sh1:0 4px 20px rgba(0,0,0,.55); --sh2:0 10px 44px rgba(0,0,0,.70);
  --r3:24px; --r2:16px; --r1:12px; --r0:8px;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html{height:100%;-webkit-text-size-adjust:100%;}
body{
  font-family:'Tiro Bangla','Hind Siliguri',sans-serif;
  background:var(--void); color:var(--vellum);
  min-height:100vh;min-height:100dvh;
  overflow-x:hidden;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* ══════════════════════════════════════════════════
   BACKGROUND — Islamic mosque scene
   Single fixed layer, GPU composited, zero JS
══════════════════════════════════════════════════ */

/* Base dark gradient on body itself */
body{
  background:
    linear-gradient(175deg,#040e07 0%,#020704 55%,#010302 100%);
}

/* Islamic mosque silhouette — fixed bottom, painted once */
.bg-mosque{
  position:fixed;bottom:0;left:0;right:0;height:38vh;
  z-index:0;pointer-events:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 300' preserveAspectRatio='xMidYMax slice'%3E%3Cdefs%3E%3ClinearGradient id='sky' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0' stop-color='%230e5c38' stop-opacity='.18'/%3E%3Cstop offset='1' stop-color='%230e5c38' stop-opacity='.04'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='800' height='300' fill='url(%23sky)'/%3E%3C!-- far left minaret --%3E%3Crect x='38' y='100' width='18' height='200' fill='%23071209'/%3E%3Crect x='33' y='90' width='28' height='14' rx='3' fill='%230a1c0d'/%3E%3Cpolygon points='47,62 33,90 61,90' fill='%230e2a12'/%3E%3Ccircle cx='47' cy='58' r='5' fill='%23d4a83222'/%3E%3C!-- left minaret --%3E%3Crect x='148' y='80' width='22' height='220' fill='%23071209'/%3E%3Crect x='142' y='68' width='34' height='16' rx='3' fill='%230a1c0d'/%3E%3Cpolygon points='159,38 142,68 176,68' fill='%230e2a12'/%3E%3Ccircle cx='159' cy='33' r='6' fill='%23d4a83230'/%3E%3C!-- main dome --%3E%3Crect x='270' y='160' width='260' height='140' fill='%23050e07'/%3E%3Cellipse cx='400' cy='162' rx='105' ry='80' fill='%23071209'/%3E%3Cellipse cx='400' cy='162' rx='88' ry='66' fill='%230a1a0c'/%3E%3C!-- dome highlight --%3E%3Cellipse cx='382' cy='130' rx='38' ry='22' fill='%23d4a8320a'/%3E%3C!-- main minaret left --%3E%3Crect x='258' y='90' width='26' height='210' fill='%23071209'/%3E%3Crect x='251' y='76' width='40' height='18' rx='4' fill='%230a1c0d'/%3E%3Cpolygon points='271,42 251,76 291,76' fill='%230e2a12'/%3E%3Ccircle cx='271' cy='36' r='7' fill='%23d4a83235'/%3E%3C!-- main minaret right --%3E%3Crect x='516' y='90' width='26' height='210' fill='%23071209'/%3E%3Crect x='509' y='76' width='40' height='18' rx='4' fill='%230a1c0d'/%3E%3Cpolygon points='529,42 509,76 549,76' fill='%230e2a12'/%3E%3Ccircle cx='529' cy='36' r='7' fill='%23d4a83235'/%3E%3C!-- right minaret --%3E%3Crect x='630' y='80' width='22' height='220' fill='%23071209'/%3E%3Crect x='624' y='68' width='34' height='16' rx='3' fill='%230a1c0d'/%3E%3Cpolygon points='641,38 624,68 658,68' fill='%230e2a12'/%3E%3Ccircle cx='641' cy='33' r='6' fill='%23d4a83230'/%3E%3C!-- far right minaret --%3E%3Crect x='744' y='100' width='18' height='200' fill='%23071209'/%3E%3Crect x='739' y='90' width='28' height='14' rx='3' fill='%230a1c0d'/%3E%3Cpolygon points='753,62 739,90 767,90' fill='%230e2a12'/%3E%3Ccircle cx='753' cy='58' r='5' fill='%23d4a83222'/%3E%3C!-- arched windows --%3E%3Cellipse cx='330' cy='200' rx='16' ry='22' fill='%230e3018'/%3E%3Cellipse cx='400' cy='200' rx='16' ry='22' fill='%230e3018'/%3E%3Cellipse cx='470' cy='200' rx='16' ry='22' fill='%230e3018'/%3E%3C!-- ground --%3E%3Crect x='0' y='278' width='800' height='22' fill='%23040c06'/%3E%3Cline x1='0' y1='278' x2='800' y2='278' stroke='%23d4a832' stroke-opacity='.12' stroke-width='1'/%3E%3C!-- crescent moon --%3E%3Ccircle cx='680' cy='40' r='18' fill='%23081208'/%3E%3Ccircle cx='688' cy='34' r='14' fill='%23040c06'/%3E%3C!-- stars --%3E%3Ccircle cx='720' cy='28' r='2' fill='%23d4a832' opacity='.35'/%3E%3Ccircle cx='700' cy='18' r='1.5' fill='%23d4a832' opacity='.28'/%3E%3Ccircle cx='740' cy='15' r='1.5' fill='%23d4a832' opacity='.25'/%3E%3Ccircle cx='760' cy='35' r='1' fill='%23d4a832' opacity='.20'/%3E%3Ccircle cx='60' cy='25' r='2' fill='%23d4a832' opacity='.30'/%3E%3Ccircle cx='100' cy='15' r='1.5' fill='%23d4a832' opacity='.22'/%3E%3Ccircle cx='130' cy='32' r='1' fill='%23d4a832' opacity='.18'/%3E%3C/svg%3E");
  background-size:100% 100%;
  background-repeat:no-repeat;
  background-position:bottom center;
  opacity:.85;
}

/* Geometric tile overlay — just one CSS bg-image, zero DOM elements */
.bg-geo{
  position:fixed;inset:0;z-index:0;pointer-events:none;
  opacity:.045;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cg fill='none' stroke='%23d4a832' stroke-width='.7'%3E%3Cpolygon points='60,4 71,36 104,36 78,56 88,88 60,68 32,88 42,56 16,36 49,36'/%3E%3Ccircle cx='60' cy='60' r='38'/%3E%3C/g%3E%3C/svg%3E");
  background-size:120px 120px;
}

/* Vignette darkens edges so content stays readable */
.bg-vig{
  position:fixed;inset:0;z-index:0;pointer-events:none;
  background:
    radial-gradient(ellipse 110% 60% at 50% 0%,rgba(14,92,56,.22) 0%,transparent 65%),
    radial-gradient(ellipse 100% 100% at 50% 50%,transparent 30%,rgba(1,4,2,.72) 100%);
}

/* ── Mobile: simplify to single flat bg + geo tile only ── */
@media(max-width:600px){
  .bg-geo{ opacity:.030; }
  .bg-vig{ background:radial-gradient(ellipse 100% 100% at 50% 50%,transparent 20%,rgba(1,4,2,.80) 100%); }
  .bg-cali{ display:none; }
  .bg-cali2{ display:none; }
}

/* Unused legacy layers — hidden */
.bg-atmo{ display:none; }
.bg-cali{position:fixed;inset:0;z-index:0;pointer-events:none;display:flex;align-items:center;justify-content:center;overflow:hidden;}
.bg-cali-text{
  font-family:'Aref Ruqaa Ink',serif;font-size:clamp(5rem,28vw,14rem);
  color:rgba(184,146,30,.025);white-space:nowrap;line-height:1;user-select:none;
  transform:rotate(-12deg) translateY(-5%);
}
.bg-cali2{
  position:fixed;bottom:-4%;right:-8%;z-index:0;pointer-events:none;
  font-family:'Noto Naskh Arabic',serif;font-size:clamp(4rem,22vw,11rem);
  color:rgba(184,146,30,.018);line-height:1;user-select:none;transform:rotate(8deg);
}

/* ══════════════════════════════════════════════════
   FLOATING DUST — pure CSS, opacity only
   No JS spawn, no transform, no blur
   Mobile: 8 dots   Desktop: 20 dots (CSS class names)
══════════════════════════════════════════════════ */
.dust{position:fixed;inset:0;z-index:1;pointer-events:none;overflow:hidden;}

/* All dust dots share one animation */
.d{
  position:absolute;border-radius:50%;
  background:rgba(253,238,160,.85);
  will-change:opacity;
  animation:dustFade ease-in-out infinite;
}
@keyframes dustFade{0%,100%{opacity:0;}50%{opacity:1;}}

/* Desktop-only dots hidden on mobile */
.d-desk{ display:none; }
@media(min-width:601px){ .d-desk{ display:block; } }

/* ══════════════════════════════════════════════════
   CROWN
══════════════════════════════════════════════════ */
.crown{position:fixed;top:0;left:0;right:0;z-index:500;pointer-events:none;}
.crown-top{
  height:2px;
  background:linear-gradient(90deg,transparent 0%,var(--Au2) 15%,var(--Au5) 35%,var(--Au7) 50%,var(--Au5) 65%,var(--Au2) 85%,transparent 100%);
  animation:crownPulse 4s ease-in-out infinite;
}
.crown-glow{height:18px;background:linear-gradient(180deg,rgba(212,168,50,.18) 0%,transparent 100%);}
@keyframes crownPulse{0%,100%{opacity:.28;}50%{opacity:1;}}

/* ══════════════════════════════════════════════════
   ROOT
══════════════════════════════════════════════════ */
.root{
  position:relative;z-index:1;
  max-width:440px;margin:0 auto;
  padding:0 13px calc(env(safe-area-inset-bottom,0px) + 36px);
}

/* ══════════════════════════════════════════════════
   HERO
══════════════════════════════════════════════════ */
.hero{text-align:center;padding:52px 8px 20px;position:relative;}
.halo{position:relative;width:110px;height:110px;margin:0 auto 4px;}
.halo::before{
  content:'';position:absolute;inset:-8px;border-radius:50%;
  background:conic-gradient(from 0deg,transparent 0%,rgba(212,168,50,.12) 20%,rgba(245,216,112,.28) 50%,rgba(212,168,50,.12) 80%,transparent 100%);
  will-change:transform;
  animation:haloSpin 12s linear infinite;
}
.halo::after{
  content:'';position:absolute;inset:4px;border-radius:50%;
  border:1px solid rgba(212,168,50,.2);
  box-shadow:0 0 30px rgba(212,168,50,.15),inset 0 0 20px rgba(212,168,50,.08);
}
@keyframes haloSpin{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}
.dome-svg{
  width:88px;height:88px;display:block;margin:0 auto;position:relative;z-index:1;
  filter:drop-shadow(0 0 24px rgba(212,168,50,.70)) drop-shadow(0 0 60px rgba(212,168,50,.30)) drop-shadow(0 6px 12px rgba(0,0,0,.60));
  will-change:transform;
  animation:domeLevitate 7s ease-in-out infinite;
}
@keyframes domeLevitate{0%,100%{transform:translateY(0) rotate(0);}33%{transform:translateY(-11px) rotate(.7deg);}66%{transform:translateY(-5px) rotate(-.4deg);}}
.basmala{
  font-family:'Aref Ruqaa Ink',serif;
  font-size:clamp(1.55rem,7.5vw,2.3rem);color:var(--Au5);
  display:block;margin:18px 4px 16px;line-height:1.65;letter-spacing:4px;
  text-shadow:0 0 35px rgba(245,216,112,.65),0 0 70px rgba(212,168,50,.25),0 3px 6px rgba(0,0,0,.90);
  animation:basmalaBreath 5s ease-in-out infinite;
}
@keyframes basmalaBreath{0%,100%{text-shadow:0 0 28px rgba(245,216,112,.50),0 3px 6px rgba(0,0,0,.9);}50%{text-shadow:0 0 55px rgba(245,216,112,.90),0 0 100px rgba(212,168,50,.30),0 3px 6px rgba(0,0,0,.9);}}
.mosque-name{
  font-family:'Tiro Bangla',serif;font-size:clamp(1.7rem,8.5vw,2.8rem);font-weight:400;
  background:linear-gradient(160deg,var(--Au6) 0%,var(--Au4) 45%,var(--Au5) 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  line-height:1.25;letter-spacing:.8px;
  filter:drop-shadow(0 2px 16px rgba(212,168,50,.35));
  animation:nameShimmer 6s ease-in-out infinite, heroEntryName .9s cubic-bezier(.22,1,.36,1) .3s both;
}
@keyframes heroEntryName{from{opacity:0;transform:translateY(22px) scale(.97);}to{opacity:1;transform:none;}}
@keyframes nameShimmer{0%,100%{filter:drop-shadow(0 2px 12px rgba(212,168,50,.25));}50%{filter:drop-shadow(0 2px 28px rgba(212,168,50,.60));}}
.orn{display:flex;align-items:center;justify-content:center;gap:6px;margin:14px auto 0;max-width:280px;}
.orn-l{flex:1;height:1px;background:linear-gradient(90deg,transparent,var(--Au3),transparent);}
.orn-d{width:7px;height:7px;background:var(--Au4);transform:rotate(45deg);box-shadow:0 0 10px var(--Au4),0 0 20px rgba(212,168,50,.4);flex-shrink:0;}
.orn-dot{color:var(--Au5);font-size:.78rem;line-height:1;}

/* ══════════════════════════════════════════════════
   TABS
══════════════════════════════════════════════════ */
.tab-rail{
  position:sticky;top:0;z-index:200;padding:11px 0 9px;
  background:linear-gradient(180deg,rgba(1,4,2,.98) 0%,rgba(1,4,2,.85) 100%);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
}
.tab-bar{
  display:grid;grid-template-columns:1fr 1fr;
  background:rgba(5,14,7,.92);border:1px solid var(--rim1);border-radius:100px;
  padding:4px;gap:4px;
  box-shadow:var(--sh1),inset 0 1px 0 rgba(212,168,50,.12),inset 0 -1px 0 rgba(0,0,0,.3);
}
.t-btn{
  padding:13px 4px;border:none;background:transparent;border-radius:100px;
  font-family:'Tiro Bangla',serif;font-size:clamp(.84rem,4.2vw,1.05rem);font-weight:400;
  color:var(--mist);cursor:pointer;transition:all .35s cubic-bezier(.4,0,.2,1);
  -webkit-tap-highlight-color:transparent;touch-action:manipulation;
  white-space:nowrap;letter-spacing:.4px;position:relative;overflow:hidden;
}
.t-btn::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);transform:translateX(-100%);transition:transform .5s ease;}
.t-btn.on::after{transform:translateX(100%);}
.t-btn.on{
  background:linear-gradient(145deg,var(--jade) 0%,var(--jade2) 60%,var(--jade3) 100%);
  color:var(--Au5);font-weight:400;
  box-shadow:0 4px 20px rgba(14,92,56,.55),0 0 0 1px rgba(212,168,50,.38),inset 0 1px 0 rgba(255,255,255,.14),inset 0 -1px 0 rgba(0,0,0,.2);
  text-shadow:0 1px 8px rgba(0,0,0,.5);
}

/* ══════════════════════════════════════════════════
   PANELS
══════════════════════════════════════════════════ */
.panel{display:none;}
.panel.on{display:block;animation:panelReveal .42s cubic-bezier(.22,1,.36,1) both;}
@keyframes panelReveal{from{opacity:0;transform:translateY(26px) scale(.98);}to{opacity:1;transform:none;}}

.live-dot{
  display:flex;align-items:center;justify-content:center;gap:6px;padding:5px 0 10px;
  font-family:'Hind Siliguri',sans-serif;font-size:.64rem;font-weight:700;
  letter-spacing:1.2px;text-transform:uppercase;color:var(--ash);
}
.live-dot .dot{width:6px;height:6px;border-radius:50%;background:var(--ash);flex-shrink:0;transition:background .4s,box-shadow .4s;}
.live-dot.live{color:rgba(80,220,140,.9);}
.live-dot.live .dot{background:#50dc8c;box-shadow:0 0 8px #50dc8c,0 0 16px rgba(80,220,140,.5);animation:livePulse 1.1s ease-in-out infinite alternate;}
@keyframes livePulse{from{opacity:1;}to{opacity:.3;}}

/* ══════════════════════════════════════════════════
   DATE BANNER
══════════════════════════════════════════════════ */
.date-banner{
  position:relative;background:var(--card2);border:1px solid var(--rim1);border-radius:var(--r3);
  margin-bottom:12px;overflow:hidden;
  box-shadow:var(--sh2),inset 0 1px 0 rgba(212,168,50,.10);
  display:grid;grid-template-columns:1fr 1px 1fr;
}
.date-banner::before{content:'✦';position:absolute;top:6px;left:10px;color:rgba(212,168,50,.25);font-size:.65rem;pointer-events:none;}
.date-banner::after {content:'✦';position:absolute;bottom:6px;right:10px;color:rgba(212,168,50,.25);font-size:.65rem;pointer-events:none;}
.date-banner-inner{position:absolute;inset:0;pointer-events:none;background:linear-gradient(110deg,transparent 30%,rgba(212,168,50,.03) 50%,transparent 70%);animation:bannerSweep 8s ease-in-out infinite;}
@keyframes bannerSweep{0%{transform:translateX(-100%);}55%,100%{transform:translateX(100%);}}
.date-col{padding:15px 10px 13px;text-align:center;position:relative;}
.date-lbl{font-family:'Hind Siliguri',sans-serif;font-size:.58rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--mist);font-weight:700;margin-bottom:6px;}
.date-val{font-family:'Scheherazade New',serif;font-size:clamp(.84rem,3.8vw,1rem);color:var(--Au4);font-weight:600;line-height:1.35;}
.date-val.arab{font-family:'Noto Naskh Arabic',serif;font-size:clamp(.88rem,4vw,1.05rem);direction:rtl;}
.date-sep-v{background:linear-gradient(180deg,transparent,var(--rim2),transparent);margin:10px 0;}

/* ══════════════════════════════════════════════════
   PRAYER CARDS
══════════════════════════════════════════════════ */
.prayer-list{display:flex;flex-direction:column;gap:9px;}
.p-row{
  position:relative;background:var(--card);border:1px solid var(--rim1);border-radius:var(--r2);
  overflow:hidden;box-shadow:var(--sh1);
  transition:transform .18s ease,box-shadow .28s ease,border-color .28s ease;
  -webkit-tap-highlight-color:transparent;touch-action:manipulation;
}
.p-row:active{transform:scale(.982);}
.p-row.hl{
  background:linear-gradient(140deg,rgba(14,92,56,.38) 0%,rgba(7,18,9,.92) 65%,rgba(10,24,12,.95) 100%);
  border-color:rgba(212,168,50,.30);
  box-shadow:var(--sh1),0 0 0 1px rgba(212,168,50,.10),inset 0 1px 0 rgba(212,168,50,.10);
}
.p-row::before{
  content:'';position:absolute;left:0;top:12%;bottom:12%;
  width:3.5px;border-radius:0 4px 4px 0;
  background:linear-gradient(180deg,transparent,var(--Au4),transparent);
  opacity:0;transition:opacity .3s;
}
.p-row.hl::before{opacity:1;}
.p-row::after{
  content:'';position:absolute;top:0;left:10%;right:10%;height:1px;
  background:linear-gradient(90deg,transparent,rgba(212,168,50,.22),transparent);pointer-events:none;
}
.p-shimmer{
  position:absolute;inset:0;pointer-events:none;
  background:linear-gradient(110deg,transparent 30%,rgba(212,168,50,.04) 50%,transparent 70%);
  animation:rowSweep 8s ease-in-out infinite;
}
.p-row:nth-child(2) .p-shimmer{animation-delay:.8s;}
.p-row:nth-child(3) .p-shimmer{animation-delay:1.6s;}
.p-row:nth-child(4) .p-shimmer{animation-delay:2.4s;}
.p-row:nth-child(5) .p-shimmer{animation-delay:3.2s;}
.p-row:nth-child(6) .p-shimmer{animation-delay:4s;}
.p-row:nth-child(7) .p-shimmer{animation-delay:4.8s;}
@keyframes rowSweep{0%{transform:translateX(-100%);}55%,100%{transform:translateX(120%);}}
.p-inner{display:flex;align-items:center;gap:13px;padding:14px 16px;}
.p-badge{
  flex-shrink:0;width:48px;height:48px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;font-size:1.35rem;
  background:radial-gradient(circle at 35% 35%,rgba(212,168,50,.14),rgba(212,168,50,.05) 70%);
  border:1px solid rgba(212,168,50,.20);position:relative;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
}
.p-row.hl .p-badge{
  background:radial-gradient(circle at 35% 35%,rgba(212,168,50,.22),rgba(212,168,50,.08) 70%);
  border-color:rgba(212,168,50,.36);
  box-shadow:0 0 18px rgba(212,168,50,.16),inset 0 1px 0 rgba(255,255,255,.08);
}
.p-row.hl .p-badge::after{
  content:'';position:absolute;inset:-4px;border-radius:50%;
  border:1.5px solid rgba(212,168,50,.35);
  animation:badgePing 2.5s ease-out infinite;
}
@keyframes badgePing{0%{transform:scale(1);opacity:.7;}70%,100%{transform:scale(1.5);opacity:0;}}
.p-body{flex:1;min-width:0;}
.p-name-bn{
  font-family:'Tiro Bangla',serif;font-size:clamp(1.18rem,5.5vw,1.42rem);font-weight:400;
  color:var(--ink);line-height:1.1;letter-spacing:.5px;
}
.p-row.hl .p-name-bn{
  background:linear-gradient(135deg,var(--Au6) 0%,var(--Au4) 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.prayer-list .p-row{animation:cardSlideIn .55s cubic-bezier(.22,1,.36,1) both;}
.prayer-list .p-row:nth-child(1){animation-delay:.08s;}
.prayer-list .p-row:nth-child(2){animation-delay:.15s;}
.prayer-list .p-row:nth-child(3){animation-delay:.22s;}
.prayer-list .p-row:nth-child(4){animation-delay:.29s;}
.prayer-list .p-row:nth-child(5){animation-delay:.36s;}
.prayer-list .p-row:nth-child(6){animation-delay:.43s;}
.prayer-list .p-row:nth-child(7){animation-delay:.50s;}
@keyframes cardSlideIn{from{opacity:0;transform:translateX(-18px) scale(.97);}to{opacity:1;transform:none;}}
.p-name-ar{font-family:'Noto Naskh Arabic',serif;font-size:.72rem;color:var(--mist);margin-top:3px;direction:rtl;letter-spacing:.5px;}
.p-time{
  font-family:'Aref Ruqaa Ink',serif;font-size:clamp(1.28rem,6vw,1.58rem);font-weight:700;
  color:var(--Au4);min-width:82px;text-align:right;flex-shrink:0;
  letter-spacing:.8px;text-shadow:0 0 16px rgba(212,168,50,.32);line-height:1;
  transition:text-shadow .4s,color .4s;
}
.p-row.hl .p-time{
  color:var(--Au6);text-shadow:0 0 28px rgba(245,216,112,.60),0 0 50px rgba(212,168,50,.25);
  animation:timePulse 3s ease-in-out infinite;
}
@keyframes timePulse{0%,100%{text-shadow:0 0 22px rgba(245,216,112,.50),0 0 40px rgba(212,168,50,.20);}50%{text-shadow:0 0 40px rgba(245,216,112,.85),0 0 70px rgba(212,168,50,.40);}}
.p-time.updated{animation:timeFlash .6s ease-out;}
@keyframes timeFlash{0%{color:var(--Au7);text-shadow:0 0 40px rgba(255,255,200,.9),0 0 80px rgba(212,168,50,.7);}100%{color:inherit;text-shadow:inherit;}}

/* ══════════════════════════════════════════════════
   ACTIVE WAQT — জ্বলন্ত অ্যানিমেশন
   JS adds .now class to the current prayer row
══════════════════════════════════════════════════ */
.p-row.now{
  background:linear-gradient(140deg,
    rgba(20,140,76,.58) 0%,
    rgba(12,44,20,.96) 50%,
    rgba(9,22,11,.98) 100%) !important;
  border-color:rgba(253,238,160,.80) !important;
  transform:scale(1.013);
  z-index:4;
  will-change:box-shadow,transform;
  box-shadow:
    0 0 0 2px   rgba(253,238,160,.55),
    0 0 24px    rgba(253,238,160,.42),
    0 0 55px    rgba(212,168,50,.32),
    0 0 100px   rgba(212,168,50,.16),
    inset 0 1px 0 rgba(253,238,160,.25) !important;
  animation: cardSlideIn .55s cubic-bezier(.22,1,.36,1) both,
             nowBreath 2s ease-in-out infinite;
}
@keyframes nowBreath{
  0%,100%{
    box-shadow:
      0 0 0 1.5px rgba(253,238,160,.45),
      0 0 18px    rgba(253,238,160,.30),
      0 0 45px    rgba(212,168,50,.22),
      0 0 85px    rgba(212,168,50,.10),
      inset 0 1px 0 rgba(253,238,160,.18);
    transform:scale(1.008);
  }
  50%{
    box-shadow:
      0 0 0 2.5px rgba(253,238,160,.92),
      0 0 36px    rgba(253,238,160,.65),
      0 0 75px    rgba(212,168,50,.46),
      0 0 130px   rgba(212,168,50,.24),
      inset 0 1px 0 rgba(253,238,160,.32);
    transform:scale(1.020);
  }
}
/* Left stripe — flame flicker */
.p-row.now::before{
  opacity:1 !important;width:5px !important;
  background:linear-gradient(180deg,transparent,var(--Au5),var(--Au7),var(--Au5),transparent) !important;
  animation:stripeFlicker 1.1s ease-in-out infinite;
}
@keyframes stripeFlicker{
  0%,100%{opacity:.75;box-shadow:0 0 8px rgba(253,238,160,.55);}
  30%    {opacity:1;  box-shadow:0 0 22px rgba(253,238,160,.95),0 0 40px rgba(212,168,50,.65);}
  70%    {opacity:.88;box-shadow:0 0 14px rgba(253,238,160,.72);}
}
/* Top edge glow */
.p-row.now::after{
  background:linear-gradient(90deg,transparent,rgba(253,238,160,.55),rgba(255,255,210,.85),rgba(253,238,160,.55),transparent) !important;
  height:1.5px !important;animation:topEdgeGlow 2s ease-in-out infinite;
}
@keyframes topEdgeGlow{0%,100%{opacity:.45;}50%{opacity:1;}}
/* Badge — inferno aura */
.p-row.now .p-badge{
  background:radial-gradient(circle at 35% 30%,rgba(253,238,160,.44),rgba(212,168,50,.20) 55%,rgba(212,168,50,.05) 100%) !important;
  border-color:rgba(253,238,160,.85) !important;
  box-shadow:0 0 26px rgba(253,238,160,.60),0 0 55px rgba(212,168,50,.40),0 0 90px rgba(212,168,50,.20),inset 0 1px 0 rgba(255,255,255,.22) !important;
  animation:badgeInferno 1.7s ease-in-out infinite;
}
@keyframes badgeInferno{
  0%,100%{box-shadow:0 0 20px rgba(253,238,160,.45),0 0 44px rgba(212,168,50,.30),0 0 75px rgba(212,168,50,.15);transform:scale(1);}
  50%    {box-shadow:0 0 36px rgba(253,238,160,.85),0 0 70px rgba(212,168,50,.60),0 0 110px rgba(212,168,50,.32);transform:scale(1.12);}
}
/* Double expanding ping rings */
.p-row.now .p-badge::after{
  content:'';position:absolute;inset:-8px;border-radius:50%;
  border:2px solid rgba(253,238,160,.72);
  animation:nowPing1 1.5s ease-out infinite !important;
}
@keyframes nowPing1{0%{transform:scale(1);opacity:.9;}100%{transform:scale(2.3);opacity:0;}}
.now-ping2{
  position:absolute;inset:-8px;border-radius:50%;
  border:1.5px solid rgba(212,168,50,.48);
  animation:nowPing2 1.5s ease-out .5s infinite;
  pointer-events:none;
}
@keyframes nowPing2{0%{transform:scale(1);opacity:.6;}100%{transform:scale(2.9);opacity:0;}}
/* Bangla name — flowing molten gold */
.p-row.now .p-name-bn{
  background:linear-gradient(90deg,var(--Au7),var(--Au5),var(--Au4),var(--Au5),var(--Au7)) !important;
  -webkit-background-clip:text !important;-webkit-text-fill-color:transparent !important;background-clip:text !important;
  background-size:300% auto;
  animation:goldFlow 2.2s linear infinite;
  filter:drop-shadow(0 0 12px rgba(253,238,160,.55));
}
@keyframes goldFlow{0%{background-position:0%;}100%{background-position:300%;}}
/* Arabic name lit */
.p-row.now .p-name-ar{color:rgba(253,238,160,.72) !important;text-shadow:0 0 10px rgba(253,238,160,.40);}
/* Time — MAX fire */
.p-row.now .p-time{
  color:var(--Au7) !important;
  font-size:clamp(1.40rem,6.8vw,1.74rem) !important;
  letter-spacing:1.2px !important;
  animation:timeInferno 1.3s ease-in-out infinite !important;
}
@keyframes timeInferno{
  0%,100%{text-shadow:0 0 20px rgba(253,238,160,.80),0 0 38px rgba(245,216,112,.55),0 0 65px rgba(212,168,50,.30);}
  50%    {text-shadow:0 0 34px rgba(255,255,220,1.0),0 0 65px rgba(253,238,160,.88),0 0 110px rgba(212,168,50,.58),0 0 160px rgba(212,168,50,.22);}
}
/* Fast shimmer sweep */
.p-row.now .p-shimmer{
  background:linear-gradient(110deg,transparent 15%,rgba(253,238,160,.14) 38%,rgba(255,255,210,.24) 50%,rgba(253,238,160,.14) 62%,transparent 85%) !important;
  animation:nowSweep 1.6s ease-in-out infinite !important;
}
@keyframes nowSweep{0%{transform:translateX(-110%);}100%{transform:translateX(120%);}}
/* "ওয়াক্ত চলছে" label */
.waqt-lbl{
  position:absolute;top:6px;right:9px;z-index:8;pointer-events:none;
  font-family:'Tiro Bangla',serif;font-size:.56rem;
  color:rgba(253,238,160,.92);
  background:rgba(20,128,72,.58);border:1px solid rgba(253,238,160,.48);
  border-radius:20px;padding:2px 9px;letter-spacing:.6px;
  backdrop-filter:blur(6px);
  animation:lblBreath 2s ease-in-out infinite;
}
@keyframes lblBreath{0%,100%{opacity:.70;box-shadow:0 0 6px rgba(253,238,160,.20);}50%{opacity:1;box-shadow:0 0 18px rgba(253,238,160,.62);}}
/* Floating ember sparks (JS spawned) */
.ember{
  position:absolute;border-radius:50%;pointer-events:none;z-index:9;
  will-change:transform,opacity;
  transform:translateZ(0);
  animation:emberFly linear forwards;
}
@keyframes emberFly{
  0%  {transform:translateY(0) translateX(0) scale(1); opacity:.95;}
  40% {opacity:.70;}
  100%{transform:translateY(-72px) translateX(var(--ex)) scale(.04); opacity:0;}
}

/* ══════════════════════════════════════════════════
   RIPPLE
══════════════════════════════════════════════════ */
.ripple-ring{
  position:absolute;border-radius:50%;background:rgba(212,168,50,.18);
  transform:scale(0);animation:ripple .55s ease-out forwards;pointer-events:none;z-index:10;
}
@keyframes ripple{from{transform:scale(0);opacity:.8;}to{transform:scale(3.5);opacity:0;}}

/* ══════════════════════════════════════════════════
   ADMIN PANEL
══════════════════════════════════════════════════ */
.adm-head{text-align:center;padding:10px 0 18px;}
.adm-head h2{
  font-family:'Tiro Bangla',serif;font-size:clamp(1.25rem,6vw,1.6rem);font-weight:400;
  background:linear-gradient(135deg,var(--Au4),var(--Au6));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:.8px;
}
.adm-head p{font-family:'Tiro Bangla',serif;font-size:.78rem;color:var(--mist);margin-top:5px;letter-spacing:.3px;}
.adm-card{
  background:var(--card2);border:1px solid var(--rim1);border-radius:var(--r3);
  padding:20px 15px 22px;box-shadow:var(--sh2);position:relative;overflow:hidden;
}
.adm-card::before{content:'';position:absolute;top:0;left:0;width:40px;height:40px;border-top:1px solid var(--rim2);border-left:1px solid var(--rim2);border-radius:var(--r3) 0 0 0;}
.adm-card::after {content:'';position:absolute;bottom:0;right:0;width:40px;height:40px;border-bottom:1px solid var(--rim2);border-right:1px solid var(--rim2);border-radius:0 0 var(--r3) 0;}
.s-sep{
  display:flex;align-items:center;gap:8px;margin:16px 0 12px;
  font-family:'Hind Siliguri',sans-serif;font-size:.62rem;font-weight:700;
  letter-spacing:1.3px;text-transform:uppercase;color:var(--ash);
}
.s-sep::before,.s-sep::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent,var(--rim2),transparent);}
.fg{margin-bottom:11px;}
.fl{
  display:flex;align-items:center;gap:5px;
  font-family:'Tiro Bangla',serif;font-size:.72rem;font-weight:400;
  letter-spacing:.6px;color:var(--mist);margin-bottom:6px;
}
.fl .i{font-size:.82rem;}
.fi{
  width:100%;background:rgba(2,6,3,.82);border:1px solid var(--rim1);border-radius:var(--r1);
  padding:13px 15px;color:var(--ink);font-family:'Tiro Bangla',serif;font-size:1rem;font-weight:400;
  outline:none;transition:border-color .28s,box-shadow .28s,background .28s,transform .2s;
  -webkit-appearance:none;appearance:none;caret-color:var(--Au4);
}
.fi::placeholder{color:var(--ash);font-family:'Hind Siliguri',sans-serif;font-size:.78rem;font-weight:400;}
.fi:focus{border-color:rgba(212,168,50,.55);background:rgba(14,92,56,.12);box-shadow:0 0 0 3px rgba(212,168,50,.10),0 0 28px rgba(212,168,50,.06);transform:scale(1.012);}
.fgrid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.save-btn{
  width:100%;margin-top:20px;padding:17px;border:1px solid var(--rim2);border-radius:var(--r2);
  background:linear-gradient(145deg,#0b5230 0%,#12905a 40%,#0e7a4a 70%,#0b5230 100%);
  color:var(--Au6);font-family:'Tiro Bangla',serif;font-size:1.25rem;font-weight:400;letter-spacing:2px;
  cursor:pointer;position:relative;overflow:hidden;
  -webkit-tap-highlight-color:transparent;touch-action:manipulation;
  box-shadow:0 6px 28px rgba(14,92,56,.45),0 0 0 1px rgba(212,168,50,.22),inset 0 1px 0 rgba(255,255,255,.14),inset 0 -1px 0 rgba(0,0,0,.25);
  animation:btnHalo 3.5s ease-in-out infinite;
  transition:transform .25s,box-shadow .25s;
  text-shadow:0 2px 8px rgba(0,0,0,.5);
}
@keyframes btnHalo{
  0%,100%{box-shadow:0 6px 26px rgba(14,92,56,.40),0 0 0 1px rgba(212,168,50,.20),inset 0 1px 0 rgba(255,255,255,.12);}
  50%    {box-shadow:0 6px 40px rgba(14,92,56,.75),0 0 40px rgba(212,168,50,.35),0 0 0 1px rgba(212,168,50,.55),inset 0 1px 0 rgba(255,255,255,.18);}
}
.save-btn::before{content:'';position:absolute;top:0;left:-100%;width:55%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.14),transparent);transition:left .6s ease;}
.save-btn:hover::before{left:160%;}
.save-btn:hover{transform:translateY(-2px);}
.save-btn:active{transform:scale(.97);}
.save-btn span{
  background:linear-gradient(90deg,var(--Au5),var(--Au7),var(--Au5));background-size:200% auto;
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  animation:goldText 3s linear infinite;
}
@keyframes goldText{from{background-position:0%;}to{background-position:200%;}}

/* ══════════════════════════════════════════════════
   MOBILE FIXED SAVE BAR
══════════════════════════════════════════════════ */
.mobile-save-bar{display:none;position:fixed;bottom:0;left:0;right:0;z-index:300;padding:10px 16px calc(env(safe-area-inset-bottom,0px) + 10px);background:linear-gradient(0deg,rgba(1,4,2,.98),rgba(1,4,2,.88));backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px);border-top:1px solid var(--rim1);}
@media(max-width:560px){.mobile-save-bar{display:block;}.adm-card .save-btn{display:none;}.tail{height:100px;}}
.mobile-save-btn{
  width:100%;padding:15px;border:1px solid var(--rim2);border-radius:var(--r2);
  background:linear-gradient(145deg,#0b5230 0%,#12905a 40%,#0e7a4a 70%,#0b5230 100%);
  color:var(--Au6);font-family:'Tiro Bangla',serif;font-size:1.12rem;font-weight:400;letter-spacing:1.5px;
  cursor:pointer;position:relative;overflow:hidden;
  -webkit-tap-highlight-color:transparent;touch-action:manipulation;
  box-shadow:0 4px 20px rgba(14,92,56,.5),0 0 0 1px rgba(212,168,50,.22),inset 0 1px 0 rgba(255,255,255,.14);
  animation:btnHalo 3s ease-in-out infinite;
}
.mobile-save-btn:active{transform:scale(.97);}

/* ══════════════════════════════════════════════════
   TOAST + PARTICLES
══════════════════════════════════════════════════ */
.toast{
  position:fixed;bottom:calc(env(safe-area-inset-bottom,0px) + 26px);left:50%;
  transform:translateX(-50%) translateY(90px) scale(.9);opacity:0;pointer-events:none;
  background:linear-gradient(145deg,rgba(10,50,25,.98),rgba(6,20,10,.98));
  border:1px solid rgba(212,168,50,.55);border-radius:100px;padding:14px 30px;
  font-family:'Tiro Bangla',serif;font-size:1.08rem;font-weight:400;color:var(--Au5);
  z-index:9999;white-space:nowrap;letter-spacing:1px;
  backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
  box-shadow:0 12px 48px rgba(0,0,0,.65),0 0 40px rgba(212,168,50,.25),inset 0 1px 0 rgba(212,168,50,.2);
  transition:transform .48s cubic-bezier(.34,1.56,.64,1),opacity .38s ease;
}
.toast.show{transform:translateX(-50%) translateY(0) scale(1);opacity:1;}
#pcl{position:fixed;inset:0;pointer-events:none;z-index:9998;overflow:hidden;}
.pc{position:absolute;animation:pcfly 1.8s ease-out forwards;}
@keyframes pcfly{0%{opacity:1;transform:translateY(0) rotate(0) scale(1);}15%{opacity:1;}80%{opacity:.5;}100%{opacity:0;transform:translateY(-180px) rotate(240deg) scale(.06);}}
.tail{height:48px;}

/* ══════════════════════════════════════════════════
   RESPONSIVE
══════════════════════════════════════════════════ */
@media(max-width:380px){
  .date-lbl{font-size:.55rem;letter-spacing:1px;}
  .date-val{font-size:.82rem;}
  .p-inner{padding:12px 13px;gap:11px;}
  .p-badge{width:44px;height:44px;font-size:1.22rem;}
  .p-name-bn{font-size:1.1rem;}
  .p-time{font-size:1.18rem;min-width:72px;}
}
@media(min-width:560px){.root{max-width:510px;}.p-badge{width:52px;height:52px;font-size:1.42rem;}.p-name-bn{font-size:1.48rem;}.p-time{font-size:1.55rem;min-width:86px;}}
@media(min-width:860px){.root{max-width:640px;}.p-name-bn{font-size:1.62rem;}.p-time{font-size:1.7rem;}.mosque-name{font-size:2.6rem;}}
@media(min-width:1280px){.root{max-width:800px;}.p-inner{padding:20px 24px;}.p-badge{width:60px;height:60px;font-size:1.65rem;}.p-name-bn{font-size:1.92rem;}.p-time{font-size:2rem;min-width:110px;}}
@media(min-width:1800px){.root{max-width:1020px;}.p-inner{padding:26px 32px;gap:18px;}.p-badge{width:74px;height:74px;font-size:2rem;}.p-name-bn{font-size:2.4rem;}.p-time{font-size:2.5rem;min-width:145px;}}

/* ══════════════════════════════════════════════════
   IFTAR / SEHRI COUNTDOWN PANEL — UPGRADED
══════════════════════════════════════════════════ */
.countdown-panel{
  position:relative;
  background:linear-gradient(160deg,rgba(10,28,14,.97) 0%,rgba(7,18,9,.98) 60%,rgba(12,32,16,.97) 100%);
  border:1px solid var(--rim2);
  border-radius:var(--r3);
  margin-bottom:12px;
  overflow:hidden;
  box-shadow:var(--sh2),0 0 0 1px rgba(212,168,50,.14),0 0 50px rgba(14,92,56,.20),inset 0 1px 0 rgba(212,168,50,.18);
  padding:16px 10px 14px;
}
.countdown-panel::before{
  content:'';position:absolute;top:0;left:0;right:0;height:3px;
  background:linear-gradient(90deg,transparent 0%,var(--Au3) 20%,var(--Au6) 50%,var(--Au3) 80%,transparent 100%);
}
.countdown-panel::after{
  content:'';position:absolute;bottom:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent 0%,var(--rim2) 40%,var(--rim3) 50%,var(--rim2) 60%,transparent 100%);
}
.cdp-corner{position:absolute;width:18px;height:18px;pointer-events:none;}
.cdp-corner.tl{top:5px;left:5px;border-top:1px solid var(--rim3);border-left:1px solid var(--rim3);border-radius:4px 0 0 0;}
.cdp-corner.tr{top:5px;right:5px;border-top:1px solid var(--rim3);border-right:1px solid var(--rim3);border-radius:0 4px 0 0;}
.cdp-corner.bl{bottom:5px;left:5px;border-bottom:1px solid var(--rim2);border-left:1px solid var(--rim2);border-radius:0 0 0 4px;}
.cdp-corner.br{bottom:5px;right:5px;border-bottom:1px solid var(--rim2);border-right:1px solid var(--rim2);border-radius:0 0 4px 0;}
.cdp-header{
  display:flex;align-items:center;justify-content:center;gap:6px;
  margin-bottom:12px;
  flex-wrap:wrap;
}
.cdp-title{
  font-family:'Aref Ruqaa Ink',serif;
  font-size:clamp(.72rem,3.2vw,.92rem);
  letter-spacing:2px;
  background:linear-gradient(135deg,var(--Au4),var(--Au6),var(--Au4));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  font-weight:700;white-space:nowrap;
}
.cdp-gem{
  width:7px;height:7px;background:var(--Au4);
  transform:rotate(45deg);box-shadow:0 0 10px var(--Au4),0 0 20px rgba(212,168,50,.4);
  flex-shrink:0;
}
.cdp-star{font-size:.8rem;color:var(--Au4);opacity:.7;flex-shrink:0;}

.cdp-grid{display:grid;grid-template-columns:1fr 1px 1fr;}
.cdp-sep{background:linear-gradient(180deg,transparent 0%,var(--rim3) 30%,var(--rim3) 70%,transparent 100%);margin:4px 0;}
.cdp-item{text-align:center;padding:4px 6px 8px;position:relative;}
.cdp-label{
  font-family:'Hind Siliguri',sans-serif;
  font-size:clamp(.52rem,2.4vw,.65rem);
  letter-spacing:1.4px;text-transform:uppercase;
  font-weight:700;margin-bottom:8px;
  display:flex;align-items:center;justify-content:center;gap:4px;
}
.cdp-item.iftar .cdp-label{color:var(--Au5);}
.cdp-item.sehri .cdp-label{color:#7de8c0;}

.cdp-time-wrap{display:flex;align-items:stretch;justify-content:center;gap:3px;}
.cdp-digit-box{display:flex;flex-direction:column;align-items:center;gap:2px;}

/* RESPONSIVE digit sizes */
.cdp-hh,.cdp-mm,.cdp-ss{
  font-family:'Aref Ruqaa Ink',serif;
  font-size:clamp(1.45rem,6.5vw,2.2rem);
  font-weight:700;
  line-height:1;
  min-width:2ch;text-align:center;
  display:block;
  border-radius:6px;
  padding:5px 6px 3px;
}
.cdp-item.iftar .cdp-hh,
.cdp-item.iftar .cdp-mm,
.cdp-item.iftar .cdp-ss{
  color:var(--Au7);
  text-shadow:0 0 18px rgba(245,216,112,.75),0 0 36px rgba(212,168,50,.35);
  background:rgba(212,168,50,.08);
  border:1px solid rgba(212,168,50,.22);
  box-shadow:inset 0 1px 0 rgba(255,255,255,.06),0 2px 10px rgba(0,0,0,.4);
}
.cdp-item.sehri .cdp-hh,
.cdp-item.sehri .cdp-mm,
.cdp-item.sehri .cdp-ss{
  color:#b8fce0;
  text-shadow:0 0 16px rgba(125,232,192,.70),0 0 32px rgba(79,201,154,.30);
  background:rgba(21,156,94,.10);
  border:1px solid rgba(79,201,154,.25);
  box-shadow:inset 0 1px 0 rgba(255,255,255,.06),0 2px 10px rgba(0,0,0,.4);
}
.cdp-digit-lbl{
  font-family:'Hind Siliguri',sans-serif;
  font-size:clamp(.38rem,1.5vw,.46rem);
  letter-spacing:.8px;text-transform:uppercase;
  color:var(--ash);font-weight:700;
}
.cdp-colon{
  font-family:'Aref Ruqaa Ink',serif;
  font-size:clamp(1.1rem,5vw,1.8rem);
  color:var(--Au3);line-height:1;
  align-self:center;padding-bottom:14px;
  animation:colonBlink 1s step-end infinite;
}
.cdp-item.sehri .cdp-colon{color:#4fc99a;}
@keyframes colonBlink{0%,100%{opacity:1;}50%{opacity:.15;}}
.cdp-sublabel{
  font-family:'Tiro Bangla',serif;
  font-size:clamp(.52rem,2.4vw,.66rem);
  margin-top:8px;letter-spacing:.3px;
  padding:3px 6px;border-radius:16px;display:inline-block;
  line-height:1.4;
}
.cdp-item.iftar .cdp-sublabel{
  color:rgba(245,216,112,.80);
  background:rgba(212,168,50,.08);border:1px solid rgba(212,168,50,.18);
}
.cdp-item.sehri .cdp-sublabel{
  color:rgba(125,232,192,.80);
  background:rgba(21,156,94,.08);border:1px solid rgba(79,201,154,.20);
}
.cdp-done{
  font-family:'Tiro Bangla',serif;
  font-size:clamp(.78rem,3.5vw,.95rem);
  color:var(--Au5);text-shadow:0 0 14px rgba(245,216,112,.6);padding:4px 0;
}

/* ══════════════════════════════════════════════════
   VISITOR COUNTER — compact Islamic design
══════════════════════════════════════════════════ */
.visitor-footer{
  text-align:center;
  padding:4px 0 12px;
  user-select:none;
}
.visitor-card{
  position:relative;
  display:inline-block;
  width:100%;
  background:linear-gradient(160deg,rgba(10,28,14,.97) 0%,rgba(7,18,9,.98) 60%,rgba(12,32,16,.97) 100%);
  border:1px solid var(--rim2);
  border-radius:var(--r2);
  overflow:hidden;
  padding:13px 14px 11px;
  box-shadow:0 6px 24px rgba(0,0,0,.50),0 0 0 1px rgba(212,168,50,.10),inset 0 1px 0 rgba(212,168,50,.12);
}
.visitor-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,var(--Au3),var(--Au5),var(--Au3),transparent);
}
.visitor-card::after{
  content:'';position:absolute;bottom:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,var(--rim2),transparent);
}
.visitor-geo{
  position:absolute;inset:0;pointer-events:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cg fill='none' stroke='%23d4a832' stroke-opacity='.06'%3E%3Cpolygon points='60,5 73,40 108,40 80,62 91,97 60,75 29,97 40,62 12,40 47,40' stroke-width='1'/%3E%3Ccircle cx='60' cy='60' r='42' stroke-width='.6'/%3E%3Ccircle cx='60' cy='60' r='26' stroke-width='.4'/%3E%3C/g%3E%3C/svg%3E");
  background-size:120px 120px;background-position:center;
}
.visitor-card .cdp-corner.tl{top:4px;left:4px;}
.visitor-card .cdp-corner.tr{top:4px;right:4px;}
.visitor-card .cdp-corner.bl{bottom:4px;left:4px;}
.visitor-card .cdp-corner.br{bottom:4px;right:4px;}
.visitor-arabic{
  font-family:'Noto Naskh Arabic',serif;
  font-size:clamp(.78rem,3.5vw,.92rem);
  color:rgba(212,168,50,.42);
  display:block;text-align:center;direction:rtl;letter-spacing:1px;
  margin-bottom:5px;
}
.visitor-title-row{
  display:flex;align-items:center;justify-content:center;gap:7px;
  margin-bottom:10px;
}
.visitor-gem{width:6px;height:6px;background:var(--jade3);transform:rotate(45deg);box-shadow:0 0 8px rgba(21,156,94,.8);flex-shrink:0;}
.visitor-title{font-family:'Hind Siliguri',sans-serif;font-size:.58rem;letter-spacing:2px;text-transform:uppercase;color:var(--mist);font-weight:700;}
.visitor-number-wrap{display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:10px;}
.visitor-icon-wrap{
  width:42px;height:42px;border-radius:50%;
  background:radial-gradient(circle at 35% 35%,rgba(21,156,94,.20),rgba(14,92,56,.06) 70%);
  border:1px solid rgba(21,156,94,.28);
  box-shadow:0 0 16px rgba(21,156,94,.18),inset 0 1px 0 rgba(255,255,255,.05);
  display:flex;align-items:center;justify-content:center;
  font-size:1.35rem;flex-shrink:0;position:relative;
}
.visitor-icon-wrap::after{
  content:'';position:absolute;inset:-4px;border-radius:50%;
  border:1px solid rgba(21,156,94,.20);
  animation:vcRing 2.4s ease-out infinite;
}
@keyframes vcRing{0%{transform:scale(1);opacity:.5;}100%{transform:scale(1.5);opacity:0;}}
.visitor-num-col{text-align:left;}
.visitor-count{
  font-family:'Aref Ruqaa Ink',serif;
  font-size:clamp(1.7rem,8vw,2.3rem);
  font-weight:700;
  background:linear-gradient(135deg,var(--Au5) 0%,var(--Au7) 45%,var(--Au4) 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  line-height:1;display:block;
  filter:drop-shadow(0 0 10px rgba(212,168,50,.45));
}
.visitor-unit{font-family:'Tiro Bangla',serif;font-size:.62rem;color:var(--mist);letter-spacing:.6px;margin-top:2px;display:block;}
.visitor-live-row{
  display:flex;align-items:center;justify-content:center;gap:6px;
  padding-top:8px;border-top:1px solid rgba(212,168,50,.10);
}
.visitor-dot{
  width:6px;height:6px;border-radius:50%;
  background:var(--jade3);
  box-shadow:0 0 7px rgba(21,156,94,.9),0 0 14px rgba(21,156,94,.4);
  animation:livePulse 1.2s ease-in-out infinite alternate;flex-shrink:0;
}
.visitor-live-txt{font-family:'Hind Siliguri',sans-serif;font-size:.56rem;letter-spacing:1.2px;text-transform:uppercase;color:rgba(80,220,140,.70);font-weight:700;}
.visitor-live-count{margin-left:auto;font-family:'Hind Siliguri',sans-serif;font-size:.50rem;color:var(--ash);letter-spacing:.6px;}

/* ══════════════════════════════════════════════════
   ISLAMIC SPEECH FOOTER
══════════════════════════════════════════════════ */
.islamic-footer{
  position:relative;
  margin:10px 0 6px;
  padding:18px 14px 16px;
  text-align:center;
  background:linear-gradient(160deg,rgba(8,22,10,.95) 0%,rgba(5,14,7,.98) 100%);
  border:1px solid var(--rim1);
  border-radius:var(--r2);
  overflow:hidden;
}
.islamic-footer::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,var(--Au2),var(--Au4),var(--Au2),transparent);
  opacity:.6;
}
.islamic-footer::after{
  content:'';position:absolute;bottom:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,var(--rim1),transparent);
}
.isf-top-orn{
  display:flex;align-items:center;justify-content:center;gap:8px;
  margin-bottom:12px;
}
.isf-line{flex:1;height:1px;background:linear-gradient(90deg,transparent,var(--rim2),transparent);}
.isf-diamond{width:6px;height:6px;background:var(--Au3);transform:rotate(45deg);box-shadow:0 0 8px var(--Au3);flex-shrink:0;}
.isf-speech{
  font-family:'Aref Ruqaa Ink',serif;
  font-size:clamp(1rem,4.5vw,1.3rem);
  font-weight:700;
  line-height:1.75;
  letter-spacing:.5px;
  background:linear-gradient(160deg,var(--Au6) 0%,var(--Au4) 50%,var(--Au5) 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  filter:drop-shadow(0 0 10px rgba(212,168,50,.25));
  display:block;margin-bottom:8px;
}
.isf-source{
  font-family:'Tiro Bangla',serif;
  font-size:clamp(.56rem,2.5vw,.68rem);
  color:var(--mist);letter-spacing:.6px;
  font-style:italic;
  display:block;margin-top:4px;
}

/* visitor footer CSS now above */

/* ══════════════════════════════════════════════════
   MOBILE PERFORMANCE — COMPREHENSIVE OPTIMIZATION
   Target: 60fps on low-end Android/iPhone
══════════════════════════════════════════════════ */
@media(max-width:600px){

  /* ── Dust: CSS-controlled, mobile gets 8 dots (d-desk hidden by default) ── */
  /* no override needed — .d-desk already hidden via media query */

  /* ── Crown: static, no animation ── */
  .crown-top{ animation:none; opacity:.55; }

  /* ── Hero: reduce padding ── */
  .hero{ padding:36px 8px 14px; }

  /* ── Halo: slower spin, lighter ── */
  .halo::before{
    animation-duration:30s !important;
    background:conic-gradient(from 0deg,transparent 0%,rgba(212,168,50,.07) 50%,transparent 100%);
  }

  /* ── Dome: simple vertical only, no rotate ── */
  @keyframes domeLevitate{
    0%,100%{transform:translateY(0);}
    50%    {transform:translateY(-5px);}
  }
  /* Remove expensive multi-drop-shadow filter on dome */
  .dome-svg{
    filter:drop-shadow(0 0 14px rgba(212,168,50,.55)) drop-shadow(0 4px 8px rgba(0,0,0,.50)) !important;
  }

  /* ── Basmala: no animation, static shadow ── */
  .basmala{
    animation:none !important;
    text-shadow:0 0 22px rgba(245,216,112,.45),0 2px 4px rgba(0,0,0,.9) !important;
  }

  /* ── Mosque name: no shimmer filter animation ── */
  .mosque-name{
    animation:heroEntryName .7s cubic-bezier(.22,1,.36,1) .1s both !important;
    filter:none !important;
  }

  /* ── Tab rail: remove backdrop-filter (most expensive mobile op) ── */
  .tab-rail{
    backdrop-filter:none !important;
    -webkit-backdrop-filter:none !important;
    background:rgba(1,4,2,.97) !important;
  }

  /* ── Mobile save bar: remove backdrop-filter ── */
  .mobile-save-bar{
    backdrop-filter:none !important;
    -webkit-backdrop-filter:none !important;
    background:rgba(1,4,2,.98) !important;
  }

  /* ── Panel reveal: simpler ── */
  @keyframes panelReveal{from{opacity:0;}to{opacity:1;}}

  /* ── Date banner: kill sweep animation ── */
  .date-banner-inner{ display:none !important; }

  /* ── Prayer card entry: simpler ── */
  @keyframes cardSlideIn{from{opacity:0;}to{opacity:1;}}

  /* ── Highlighted badge ping: off ── */
  .p-row.hl .p-badge::after{ animation:none !important; opacity:0; }

  /* ── Shimmer sweeps: all off ── */
  .p-shimmer{ display:none !important; }

  /* ── p-row transitions: simplified ── */
  .p-row{ transition:transform .15s ease !important; box-shadow:none !important; }
  .p-row.hl{ box-shadow:none !important; }

  /* ── timePulse on hl rows: off ── */
  .p-row.hl .p-time{ animation:none !important; }

  /* ══ ACTIVE .now ROW — strip everything heavy ══ */
  .p-row.now{
    animation:none !important;
    will-change:auto !important;
    box-shadow:0 0 0 2px rgba(253,238,160,.60),0 0 14px rgba(212,168,50,.22) !important;
    transform:scale(1.010) !important;
  }
  /* nowBreath: opacity only, no box-shadow anim */
  @keyframes nowBreath{ 0%,100%{opacity:.93;} 50%{opacity:1;} }
  /* Apply it manually */
  .p-row.now{ animation:nowBreath 2.5s ease-in-out infinite !important; }

  /* Left stripe: static */
  .p-row.now::before{
    animation:none !important;
    opacity:.9 !important;
    box-shadow:none !important;
  }
  /* Top edge: static */
  .p-row.now::after{ animation:none !important; opacity:.6 !important; }

  /* Badge: no scale pulse, no box-shadow anim */
  .p-row.now .p-badge{
    animation:none !important;
    box-shadow:0 0 12px rgba(253,238,160,.35) !important;
  }
  /* Ping rings: completely off */
  .p-row.now .p-badge::after{ display:none !important; }
  .now-ping2{ display:none !important; }

  /* Name gold flow: off */
  .p-row.now .p-name-bn{
    animation:none !important;
    background:linear-gradient(135deg,var(--Au6) 0%,var(--Au4) 100%) !important;
    -webkit-background-clip:text !important;
    -webkit-text-fill-color:transparent !important;
    background-clip:text !important;
    filter:none !important;
  }

  /* Time inferno: simple static shadow */
  .p-row.now .p-time{
    animation:none !important;
    text-shadow:0 0 16px rgba(253,238,160,.70) !important;
  }

  /* waqt-lbl: no blur, no animation */
  .waqt-lbl{
    backdrop-filter:none !important;
    -webkit-backdrop-filter:none !important;
    animation:none !important;
    opacity:.88;
  }

  /* Now shimmer: off */
  .p-row.now .p-shimmer{ display:none !important; }

  /* ── Buttons: no animation ── */
  .save-btn{ animation:none !important; }
  .mobile-save-btn{ animation:none !important; }
  .save-btn span{ animation:none !important; background-position:0% !important; }

  /* ── Visitor ring: off on mobile ── */
  .visitor-icon-wrap::after{ display:none; }
  .vcRing{ display:none; }

  /* ── Countdown colons: simpler blink ── */
  @keyframes colonBlink{ 0%,49%{opacity:1;} 50%,100%{opacity:.2;} }
}
</style>
</head>
<body>

<!-- BG: Islamic mosque scene (single SVG layer, no JS) -->
<div class="bg-mosque" aria-hidden="true"></div>
<div class="bg-geo"    aria-hidden="true"></div>
<div class="bg-cali"   aria-hidden="true"><span class="bg-cali-text">الله</span></div>
<div class="bg-cali2"  aria-hidden="true">محمد</div>
<div class="bg-vig"    aria-hidden="true"></div>

<!-- FLOATING DUST — pure CSS opacity dots, hardcoded positions, zero JS -->
<!-- 8 mobile dots (always visible) + 12 desktop-only dots -->
<div class="dust" aria-hidden="true">
  <!-- mobile + desktop -->
  <div class="d" style="width:2px;height:2px;left:8%;top:12%;animation-duration:4.2s;animation-delay:0s;"></div>
  <div class="d" style="width:3px;height:3px;left:22%;top:34%;animation-duration:6.5s;animation-delay:-2.1s;"></div>
  <div class="d" style="width:2px;height:2px;left:45%;top:8%;animation-duration:5.1s;animation-delay:-1.3s;"></div>
  <div class="d" style="width:2px;height:2px;left:68%;top:22%;animation-duration:7.3s;animation-delay:-3.8s;"></div>
  <div class="d" style="width:3px;height:3px;left:80%;top:55%;animation-duration:4.8s;animation-delay:-0.7s;"></div>
  <div class="d" style="width:2px;height:2px;left:55%;top:72%;animation-duration:6.1s;animation-delay:-4.2s;"></div>
  <div class="d" style="width:2px;height:2px;left:15%;top:65%;animation-duration:5.6s;animation-delay:-1.9s;"></div>
  <div class="d" style="width:3px;height:3px;left:36%;top:48%;animation-duration:8.0s;animation-delay:-3.1s;"></div>
  <!-- desktop only -->
  <div class="d d-desk" style="width:2px;height:2px;left:92%;top:18%;animation-duration:5.4s;animation-delay:-2.6s;"></div>
  <div class="d d-desk" style="width:2px;height:2px;left:3%;top:44%;animation-duration:7.7s;animation-delay:-0.4s;"></div>
  <div class="d d-desk" style="width:3px;height:3px;left:74%;top:82%;animation-duration:4.5s;animation-delay:-5.1s;"></div>
  <div class="d d-desk" style="width:2px;height:2px;left:29%;top:88%;animation-duration:6.8s;animation-delay:-1.6s;"></div>
  <div class="d d-desk" style="width:2px;height:2px;left:61%;top:40%;animation-duration:5.9s;animation-delay:-3.5s;"></div>
  <div class="d d-desk" style="width:3px;height:3px;left:88%;top:66%;animation-duration:7.1s;animation-delay:-0.9s;"></div>
  <div class="d d-desk" style="width:2px;height:2px;left:48%;top:28%;animation-duration:4.3s;animation-delay:-2.8s;"></div>
  <div class="d d-desk" style="width:2px;height:2px;left:12%;top:78%;animation-duration:6.3s;animation-delay:-4.7s;"></div>
  <div class="d d-desk" style="width:3px;height:3px;left:95%;top:42%;animation-duration:5.2s;animation-delay:-1.1s;"></div>
  <div class="d d-desk" style="width:2px;height:2px;left:40%;top:92%;animation-duration:8.2s;animation-delay:-2.3s;"></div>
  <div class="d d-desk" style="width:2px;height:2px;left:77%;top:10%;animation-duration:4.9s;animation-delay:-3.9s;"></div>
  <div class="d d-desk" style="width:3px;height:3px;left:58%;top:58%;animation-duration:6.6s;animation-delay:-0.5s;"></div>
</div>

<!-- CROWN -->
<div class="crown" aria-hidden="true">
  <div class="crown-top"></div>
  <div class="crown-glow"></div>
</div>

<!-- OVERLAY -->
<div id="pcl" aria-hidden="true"></div>
<div class="toast" id="toast" role="alert" aria-live="polite">✦ &nbsp; সফলভাবে সংরক্ষিত হয়েছে &nbsp; ✦</div>

<!-- ROOT -->
<div class="root">

  <!-- HERO -->
  <header class="hero">
    <div class="halo">
      <svg class="dome-svg" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="gTop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#fff8d0"/><stop offset="40%" stop-color="#f5d870"/><stop offset="80%" stop-color="#d4a832"/><stop offset="100%" stop-color="#8a6010"/></linearGradient>
          <linearGradient id="gBody" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#e8bf50"/><stop offset="100%" stop-color="#7a5010"/></linearGradient>
          <linearGradient id="gWall" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#d4a832"/><stop offset="100%" stop-color="#6a4408"/></linearGradient>
          <filter id="glow" x="-30%" y="-30%" width="160%" height="160%"><feGaussianBlur stdDeviation="1.8" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
          <filter id="glow2" x="-50%" y="-50%" width="200%" height="200%"><feGaussianBlur stdDeviation="2.5" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        </defs>
        <rect x="7" y="44" width="10" height="38" rx="2.5" fill="url(#gWall)" opacity=".88"/>
        <path d="M7 44 Q12 33 17 44Z" fill="url(#gTop)"/>
        <rect x="9" y="52" width="6" height="2" rx="1" fill="rgba(255,248,208,.25)"/>
        <rect x="9" y="58" width="6" height="2" rx="1" fill="rgba(255,248,208,.2)"/>
        <circle cx="12" cy="31" r="3.5" fill="#fff8d0" filter="url(#glow)"/>
        <rect x="83" y="44" width="10" height="38" rx="2.5" fill="url(#gWall)" opacity=".88"/>
        <path d="M83 44 Q88 33 93 44Z" fill="url(#gTop)"/>
        <rect x="85" y="52" width="6" height="2" rx="1" fill="rgba(255,248,208,.25)"/>
        <rect x="85" y="58" width="6" height="2" rx="1" fill="rgba(255,248,208,.2)"/>
        <circle cx="88" cy="31" r="3.5" fill="#fff8d0" filter="url(#glow)"/>
        <rect x="20" y="60" width="60" height="22" rx="3" fill="url(#gBody)" opacity=".80"/>
        <path d="M32 82 Q36 72 40 82Z" fill="rgba(2,6,3,.60)"/>
        <path d="M60 82 Q64 72 68 82Z" fill="rgba(2,6,3,.60)"/>
        <path d="M20 60 Q30 46 40 60Z" fill="url(#gBody)" opacity=".82"/>
        <path d="M60 60 Q70 46 80 60Z" fill="url(#gBody)" opacity=".82"/>
        <path d="M22 60 Q50 14 78 60Z" fill="url(#gTop)"/>
        <path d="M35 58 Q50 28 65 58Z" fill="rgba(255,248,208,.08)"/>
        <path d="M36 82 Q50 58 64 82Z" fill="rgba(2,6,3,.68)"/>
        <g filter="url(#glow2)">
          <circle cx="50" cy="10.5" r="6.5" fill="none" stroke="#fff8d0" stroke-width="2"/>
          <circle cx="54" cy="8.5" r="5" fill="rgba(1,4,2,.96)"/>
          <polygon points="50,3 51,6 54,6 52,8 53,11 50,9 47,11 48,8 46,6 49,6" fill="#fff8d0" opacity=".7" transform="scale(.5) translate(50,-3)"/>
        </g>
      </svg>
    </div>
    <span class="basmala" lang="ar">بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ</span>
    <h1 class="mosque-name" id="mosque-name">আল-নূর জামে মসজিদ</h1>
    <div class="orn" aria-hidden="true">
      <div class="orn-l"></div><span class="orn-dot">✦</span>
      <div class="orn-d"></div><span class="orn-dot">✦</span><div class="orn-l"></div>
    </div>
  </header>

  <!-- TABS -->
  <nav class="tab-rail" role="navigation" aria-label="প্রধান নেভিগেশন">
    <div class="tab-bar" role="tablist">
      <button class="t-btn on" id="tb-s" onclick="sw('s')" role="tab" aria-selected="true"  aria-controls="pn-s">📿 নামাজের সময়সূচি</button>
      <button class="t-btn"    id="tb-a" onclick="sw('a')" role="tab" aria-selected="false" aria-controls="pn-a">⚙️ সময় আপডেট</button>
    </div>
  </nav>

  <!-- SCHEDULE PANEL -->
  <section class="panel on" id="pn-s" role="tabpanel" aria-labelledby="tb-s">
    <div class="live-dot" id="status-dot" aria-live="polite">
      <span class="dot"></span><span id="status-txt">সংযোগ হচ্ছে...</span>
    </div>
    <div class="date-banner" role="complementary" aria-label="তারিখ">
      <div class="date-banner-inner"></div>
      <div class="date-col">
        <div class="date-lbl">📅 ইংরেজি তারিখ</div>
        <div class="date-val" id="d-eng">—</div>
      </div>
      <div class="date-sep-v"></div>
      <div class="date-col">
        <div class="date-lbl">🌙 হিজরি তারিখ</div>
        <div class="date-val arab" id="d-hij" lang="ar">—</div>
      </div>
    </div>

    <!-- IFTAR / SEHRI COUNTDOWN -->
    <div class="countdown-panel" role="complementary" aria-label="ইফতার ও সেহরির কাউন্টডাউন">
      <div class="cdp-corner tl"></div><div class="cdp-corner tr"></div>
      <div class="cdp-corner bl"></div><div class="cdp-corner br"></div>
      <div class="cdp-header">
        <div class="cdp-gem"></div>
        <span class="cdp-star">✦</span>
        <span class="cdp-title">ইফতার ও সেহরির বাকি সময়</span>
        <span class="cdp-star">✦</span>
        <div class="cdp-gem"></div>
      </div>
      <div class="cdp-grid">
        <!-- IFTAR -->
        <div class="cdp-item iftar">
          <div class="cdp-label">🌇 ইফতার</div>
          <div id="cdp-iftar-body">
            <div class="cdp-time-wrap">
              <div class="cdp-digit-box">
                <span class="cdp-hh" id="cdp-iftar-h">--</span>
                <span class="cdp-digit-lbl">ঘণ্টা</span>
              </div>
              <span class="cdp-colon">:</span>
              <div class="cdp-digit-box">
                <span class="cdp-mm" id="cdp-iftar-m">--</span>
                <span class="cdp-digit-lbl">মিনিট</span>
              </div>
              <span class="cdp-colon">:</span>
              <div class="cdp-digit-box">
                <span class="cdp-ss" id="cdp-iftar-s">--</span>
                <span class="cdp-digit-lbl">সেকেন্ড</span>
              </div>
            </div>
            <div class="cdp-sublabel" id="cdp-iftar-lbl">অপেক্ষা করুন...</div>
          </div>
        </div>
        <!-- SEPARATOR -->
        <div class="cdp-sep"></div>
        <!-- SEHRI -->
        <div class="cdp-item sehri">
          <div class="cdp-label">🌙 সেহরি</div>
          <div id="cdp-sehri-body">
            <div class="cdp-time-wrap">
              <div class="cdp-digit-box">
                <span class="cdp-hh" id="cdp-sehri-h">--</span>
                <span class="cdp-digit-lbl">ঘণ্টা</span>
              </div>
              <span class="cdp-colon">:</span>
              <div class="cdp-digit-box">
                <span class="cdp-mm" id="cdp-sehri-m">--</span>
                <span class="cdp-digit-lbl">মিনিট</span>
              </div>
              <span class="cdp-colon">:</span>
              <div class="cdp-digit-box">
                <span class="cdp-ss" id="cdp-sehri-s">--</span>
                <span class="cdp-digit-lbl">সেকেন্ড</span>
              </div>
            </div>
            <div class="cdp-sublabel" id="cdp-sehri-lbl">অপেক্ষা করুন...</div>
          </div>
        </div>
      </div>
    </div>

    <div class="prayer-list" role="list">
      <!-- data-key used by JS to match prayer name -->
      <div class="p-row hl" role="listitem" data-key="sehri">
        <div class="p-shimmer"></div>
        <div class="p-inner">
          <div class="p-badge" aria-hidden="true">🌙</div>
          <div class="p-body">
            <div class="p-name-bn">সেহরি</div>
            <div class="p-name-ar" lang="ar">السحور</div>
          </div>
          <div class="p-time" id="t-sehri" aria-label="সেহরির সময়">— : —</div>
        </div>
      </div>
      <div class="p-row" role="listitem" data-key="fajr">
        <div class="p-shimmer"></div>
        <div class="p-inner">
          <div class="p-badge" aria-hidden="true">🌄</div>
          <div class="p-body">
            <div class="p-name-bn">ফজর</div>
            <div class="p-name-ar" lang="ar">الفجر</div>
          </div>
          <div class="p-time" id="t-fajr" aria-label="ফজরের সময়">— : —</div>
        </div>
      </div>
      <div class="p-row" role="listitem" data-key="zuhr">
        <div class="p-shimmer"></div>
        <div class="p-inner">
          <div class="p-badge" aria-hidden="true">☀️</div>
          <div class="p-body">
            <div class="p-name-bn">যোহর</div>
            <div class="p-name-ar" lang="ar">الظهر</div>
          </div>
          <div class="p-time" id="t-zuhr" aria-label="যোহরের সময়">— : —</div>
        </div>
      </div>
      <div class="p-row" role="listitem" data-key="asr">
        <div class="p-shimmer"></div>
        <div class="p-inner">
          <div class="p-badge" aria-hidden="true">🌤</div>
          <div class="p-body">
            <div class="p-name-bn">আসর</div>
            <div class="p-name-ar" lang="ar">العصر</div>
          </div>
          <div class="p-time" id="t-asr" aria-label="আসরের সময়">— : —</div>
        </div>
      </div>
      <div class="p-row hl" role="listitem" data-key="iftar">
        <div class="p-shimmer"></div>
        <div class="p-inner">
          <div class="p-badge" aria-hidden="true">🌇</div>
          <div class="p-body">
            <div class="p-name-bn">ইফতার</div>
            <div class="p-name-ar" lang="ar">الإفطار</div>
          </div>
          <div class="p-time" id="t-iftar" aria-label="ইফতারের সময়">— : —</div>
        </div>
      </div>
      <div class="p-row" role="listitem" data-key="maghrib">
        <div class="p-shimmer"></div>
        <div class="p-inner">
          <div class="p-badge" aria-hidden="true">🌆</div>
          <div class="p-body">
            <div class="p-name-bn">মাগরিব</div>
            <div class="p-name-ar" lang="ar">المغرب</div>
          </div>
          <div class="p-time" id="t-maghrib" aria-label="মাগরিবের সময়">— : —</div>
        </div>
      </div>
      <div class="p-row" role="listitem" data-key="isha">
        <div class="p-shimmer"></div>
        <div class="p-inner">
          <div class="p-badge" aria-hidden="true">🌃</div>
          <div class="p-body">
            <div class="p-name-bn">এশা</div>
            <div class="p-name-ar" lang="ar">العشاء</div>
          </div>
          <div class="p-time" id="t-isha" aria-label="এশার সময়">— : —</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ADMIN PANEL -->
  <section class="panel" id="pn-a" role="tabpanel" aria-labelledby="tb-a">
    <div class="adm-head">
      <h2>✦ সময়সূচি আপডেট করুন ✦</h2>
      <p>নিচের ফর্মে তথ্য পূরণ করে সংরক্ষণ করুন</p>
    </div>
    <div class="adm-card">
      <div class="fg">
        <label class="fl" for="i-mosque"><span class="i">🕌</span> মসজিদের নাম</label>
        <input type="text" id="i-mosque" class="fi" placeholder="মসজিদের নাম লিখুন" autocomplete="off">
      </div>
      <div class="s-sep">নামাজের ওয়াক্ত</div>
      <div class="fgrid">
        <div class="fg"><label class="fl" for="i-sehri"><span class="i">🌙</span> সেহরি</label><input type="text" id="i-sehri" class="fi" placeholder="৪:৩০ AM"></div>
        <div class="fg"><label class="fl" for="i-fajr"><span class="i">🌄</span> ফজর</label><input type="text" id="i-fajr" class="fi" placeholder="৫:০০ AM"></div>
        <div class="fg"><label class="fl" for="i-zuhr"><span class="i">☀️</span> যোহর</label><input type="text" id="i-zuhr" class="fi" placeholder="১২:৩০ PM"></div>
        <div class="fg"><label class="fl" for="i-asr"><span class="i">🌤</span> আসর</label><input type="text" id="i-asr" class="fi" placeholder="৪:১৫ PM"></div>
        <div class="fg"><label class="fl" for="i-iftar"><span class="i">🌇</span> ইফতার</label><input type="text" id="i-iftar" class="fi" placeholder="৬:৪৫ PM"></div>
        <div class="fg"><label class="fl" for="i-maghrib"><span class="i">🌆</span> মাগরিব</label><input type="text" id="i-maghrib" class="fi" placeholder="৬:৫০ PM"></div>
      </div>
      <div class="fg"><label class="fl" for="i-isha"><span class="i">🌃</span> এশা</label><input type="text" id="i-isha" class="fi" placeholder="৮:৩০ PM"></div>
      <button class="save-btn" onclick="save()" aria-label="সংরক্ষণ করুন">
        <span>✦ &nbsp; সংরক্ষণ করুন &nbsp; ✦</span>
      </button>
    </div>
  </section>

  <div class="tail"></div>

  <!-- VISITOR COUNTER — ULTRA ISLAMIC DESIGN -->
  <div class="visitor-footer">
    <div class="visitor-card">
      <div class="visitor-geo"></div>
      <div class="cdp-corner tl"></div><div class="cdp-corner tr"></div>
      <div class="cdp-corner bl"></div><div class="cdp-corner br"></div>
      <span class="visitor-arabic">أَهْلاً وَسَهْلاً بِالزُّوَّار</span>
      <div class="visitor-title-row">
        <div class="visitor-gem"></div>
        <span class="visitor-title">মোট পরিদর্শক</span>
        <div class="visitor-gem"></div>
      </div>
      <div class="visitor-number-wrap">
        <div class="visitor-icon-wrap">🕌</div>
        <div class="visitor-num-col">
          <span class="visitor-count" id="visitor-count">...</span>
          <span class="visitor-unit">জন পরিদর্শন করেছেন</span>
        </div>
      </div>
      <div class="visitor-live-row">
        <span class="visitor-dot"></span>
        <span class="visitor-live-txt">লাইভ কাউন্টার</span>
        <span class="visitor-live-count">Firebase Realtime DB</span>
      </div>
    </div>
  <!-- ISLAMIC SPEECH FOOTER -->
  <div class="islamic-footer" role="contentinfo">
    <div class="isf-top-orn">
      <div class="isf-line"></div>
      <div class="isf-diamond"></div>
      <div class="isf-line"></div>
    </div>
    <span class="isf-speech">
      "🌙রোযার নিয়তের দোয়া🌙 —<br>
      নাওয়াইতু আন আছূমা গাদান মিন শাহরি রামাদানাল মুবারক,<br> ফারদাল্লাকা ইয়া আল্লাহু ফাতাকাব্বাল মিন্নি
    </span>
    <span class="isf-source">— হাদিস শরিফ</span>

    <div class="isf-top-orn" style="margin-top:14px;margin-bottom:12px;">
      <div class="isf-line"></div>
      <div class="isf-diamond"></div>
      <div class="isf-line"></div>
    </div>
    <span class="isf-speech">
      🌅ইফতারের দোয়া🌅<br>
      আল্লাহুম্মা ইন্নি লাকা সুমতু, ওয়া বিকা আমানতু, <br> ওয়া আলাইকা তাওয়াক্কালতু, ওয়া আলা রিজকিকা আফতারতু।
    </span>
    <span class="isf-source">— সহিহ মুসলিম</span>

    <div class="isf-top-orn" style="margin-top:14px;margin-bottom:12px;">
      <div class="isf-line"></div>
      <div class="isf-diamond"></div>
      <div class="isf-line"></div>
    </div>
    <span class="isf-speech">
      "ইফতারের সময় রোজাদারের দোয়া<br>
      কখনো বৃথা যায় না।"
    </span>
    <span class="isf-source">— তিরমিজি শরিফ</span>

    <div class="isf-top-orn" style="margin-top:14px;margin-bottom:0;">
      <div class="isf-line"></div>
      <div class="isf-diamond"></div>
      <div class="isf-line"></div>
    </div>
  </div>
</div>
<div class="mobile-save-bar" id="mobile-bar" style="display:none;">
  <button class="mobile-save-btn" onclick="save()">✦ &nbsp; সংরক্ষণ করুন &nbsp; ✦</button>
</div>

<!-- ══════════════════════════════════════════
     FIREBASE — Realtime Database (v12.9.0)
     ⚠️  DO NOT MODIFY THIS BLOCK
══════════════════════════════════════════ -->
<script type="module">
import { initializeApp }                                          from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAnalytics }                                           from "https://www.gstatic.com/firebasejs/12.9.0/firebase-analytics.js";
import { getDatabase, ref, set, get, onValue, runTransaction }   from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

/* ── Firebase project config ── */
const firebaseConfig = {
  apiKey:            "AIzaSyBhG3iYcvfBgNpg1_Ve24AYEPxtovzmdKQ",
  authDomain:        "mosque-times-35917.firebaseapp.com",
  databaseURL:       "https://mosque-times-35917-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:         "mosque-times-35917",
  storageBucket:     "mosque-times-35917.firebasestorage.app",
  messagingSenderId: "665723133778",
  appId:             "1:665723133778:web:af805cdf1ce39d61f1648b",
  measurementId:     "G-VBLRRLY613"
};

/* ── Initialise app & services ── */
const app       = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db        = getDatabase(app);

/* ── Prayer time keys ── */
const KEYS = ["sehri","fajr","zuhr","asr","iftar","maghrib","isha"];

/* ── Fallback data (shown only if DB has no data yet) ── */
const FALLBACK = {
  mosqueName: "আল-নূর জামে মসজিদ",
  sehri:   "৪:২৮ AM",
  fajr:    "৪:৪৮ AM",
  zuhr:    "১২:১৫ PM",
  asr:     "৪:৩০ PM",
  iftar:   "৬:৪২ PM",
  maghrib: "৬:৪৭ PM",
  isha:    "৮:১৫ PM"
};

/* ── Update DOM with latest data ── */
function apply(data) {
  const d  = data || FALLBACK;
  const nm = d.mosqueName || FALLBACK.mosqueName;

  /* Home-screen mosque name */
  document.getElementById("mosque-name").textContent = nm;
  /* Admin panel pre-fill */
  document.getElementById("i-mosque").value = nm;

  /* Prayer times on home + admin inputs */
  KEYS.forEach(k => {
    document.getElementById("t-" + k).textContent = d[k] || "— : —";
    document.getElementById("i-" + k).value       = d[k] || "";
  });
}

/* ── Status indicator ── */
function setStatus(state) {
  const dot = document.getElementById("status-dot");
  const txt = document.getElementById("status-txt");
  dot.className  = "live-dot " + state;
  txt.textContent = state === "live"
    ? "রিয়েল-টাইম সংযুক্ত"
    : "সংযোগ হচ্ছে...";
}

/* ── Listen to Firebase in real-time (onValue fires instantly on any change) ── */
setStatus("connecting");
onValue(
  ref(db, "prayerTimes"),
  (snapshot) => {
    setStatus("live");
    apply(snapshot.val());
  },
  (error) => {
    console.error("Firebase read error:", error);
    setStatus("connecting");
    apply(FALLBACK);
  }
);

/* ── Save handler: writes to DB → onValue fires → home screen updates instantly ── */
window.save = async function () {
  const data = {
    mosqueName: document.getElementById("i-mosque").value.trim() || FALLBACK.mosqueName
  };
  KEYS.forEach(k => {
    data[k] = document.getElementById("i-" + k).value.trim();
  });

  try {
    await set(ref(db, "prayerTimes"), data);
    window.celebrate();
  } catch (err) {
    console.error("Firebase write error:", err);
    apply(data);
    window.celebrate();
  }
};

/* ── Visitor counter ──
   Uses a session flag so refreshing the page doesn't double-count.
   Each unique session (tab open) counts as 1 visitor. ── */
(async function trackVisitor(){
  const BN = n => String(n).replace(/\d/g, d => "০১২৩৪৫৬৭৮৯"[d]);
  const el  = document.getElementById("visitor-count");

  /* Listen for live updates (shows count to everyone in real time) */
  onValue(ref(db,"visitorCount"), snap => {
    const v = snap.val() || 0;
    if(el) el.textContent = BN(v);
  });

  /* Only increment once per browser session */
  if(!sessionStorage.getItem("_vCounted")){
    sessionStorage.setItem("_vCounted","1");
    try{
      await runTransaction(ref(db,"visitorCount"), cur => (cur||0)+1);
    } catch(e){ console.warn("Visitor count error:",e); }
  }
})();
</script>

<!-- ══════════════════════════════════════════
     UI SCRIPTS
══════════════════════════════════════════ -->
<script>
/* ═══════════════════════════════════════
   TAB + SAVE BAR
═══════════════════════════════════════ */
function sw(id){
  ["s","a"].forEach(x=>{
    document.getElementById("tb-"+x).classList.toggle("on",x===id);
    document.getElementById("tb-"+x).setAttribute("aria-selected",x===id?"true":"false");
    document.getElementById("pn-"+x).classList.toggle("on",x===id);
  });
  const bar=document.getElementById("mobile-bar");
  if(bar) bar.style.display=(id==="a")?"block":"none";
}
window._redirectHome = ()=>{ setTimeout(()=>sw("s"),1600); };
window._flashTimes   = ()=>{
  document.querySelectorAll(".p-time").forEach(el=>{
    el.classList.remove("updated"); void el.offsetWidth;
    el.classList.add("updated");
    setTimeout(()=>el.classList.remove("updated"),700);
  });
};
window.celebrate = function(){
  const t=document.getElementById("toast");
  t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),3400);
  burst(); window._flashTimes(); window._redirectHome();
  /* re-detect active waqt after data refreshes */
  setTimeout(markActiveWaqt, 200);
};

/* ═══════════════════════════════════════
   ACTIVE WAQT DETECTION
   Reads .p-time text → compares with clock
   Marks correct .p-row with class .now
═══════════════════════════════════════ */
const WAQT_KEYS = ["sehri","fajr","zuhr","asr","iftar","maghrib","isha"];

/* Convert "৬:৪৫ PM" or "6:45 PM" → minutes since midnight */
function toMinutes(str){
  if(!str||str.includes("—")) return null;
  /* Bangla digits → ASCII */
  const s = str.replace(/[০-৯]/g, d=>"০১২৩৪৫৬৭৮৯".indexOf(d).toString());
  const m = s.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);
  if(!m) return null;
  let h=parseInt(m[1]), mn=parseInt(m[2]);
  const pm=/pm/i.test(m[3]);
  if(pm&&h!==12) h+=12;
  if(!pm&&h===12) h=0;
  return h*60+mn;
}

let _emberTimer=null;

function markActiveWaqt(){
  const now=new Date();
  const cur=now.getHours()*60+now.getMinutes();

  /* Collect valid time entries */
  const entries=WAQT_KEYS.map(k=>{
    const el=document.getElementById("t-"+k);
    return{k, t: el?toMinutes(el.textContent):null};
  }).filter(e=>e.t!==null);

  if(!entries.length) return;

  /* Active = last entry whose start ≤ now (wraps at midnight to last) */
  let activeKey=entries[0].k;
  for(const e of entries){ if(cur>=e.t) activeKey=e.k; }

  /* Apply / remove classes */
  document.querySelectorAll(".p-row").forEach(row=>{
    const key=row.dataset.key;
    const isNow=(key===activeKey);

    if(isNow&&!row.classList.contains("now")){
      row.classList.add("now");

      /* Label */
      if(!row.querySelector(".waqt-lbl")){
        const l=document.createElement("span");
        l.className="waqt-lbl"; l.textContent="ওয়াক্ত চলছে";
        row.appendChild(l);
      }
      /* 2nd ping ring inside badge */
      const badge=row.querySelector(".p-badge");
      if(badge&&!badge.querySelector(".now-ping2")){
        const p=document.createElement("div");
        p.className="now-ping2"; badge.appendChild(p);
      }
    } else if(!isNow){
      row.classList.remove("now");
      row.querySelector(".waqt-lbl")?.remove();
      row.querySelector(".now-ping2")?.remove();
    }
  });

  /* Continuous embers on active card */
  clearInterval(_emberTimer);
  const activeRow=document.querySelector(`.p-row[data-key="${activeKey}"]`);
  /* Embers: desktop only */
  const isMob=('ontouchstart' in window)||window.innerWidth<=600;
  if(activeRow && !isMob){
    _emberTimer=setInterval(()=>spawnEmbers(activeRow),1200);
  }
}

function spawnEmbers(row){
  const cols=["#fdeea0","#f5d870","#fff8d0","#e8bf50","#ffecb3","#fffde7","#ffffff"];
  const isMob='ontouchstart' in window;
  const n=isMob ? 1+Math.floor(Math.random()*2) : 2+Math.floor(Math.random()*3);
  for(let i=0;i<n;i++){
    const e=document.createElement("div"); e.className="ember";
    const sz=3+Math.random()*7;
    const ex=(Math.random()-.5)*90;
    const c=cols[~~(Math.random()*cols.length)];
    e.style.cssText=
      `width:${sz}px;height:${sz}px;background:${c};`+
      `left:${12+Math.random()*76}%;bottom:${58+Math.random()*28}%;`+
      `--ex:${ex}px;`+
      `animation-duration:${.7+Math.random()*.9}s;`+
      `animation-delay:${Math.random()*.25}s;`+
      `box-shadow:0 0 ${sz*2}px ${c};`;
    row.appendChild(e);
    setTimeout(()=>e.remove(),1500);
  }
}

/* Run on load, then every 30s (was 60s but active waqt only changes ~6x/day) */
markActiveWaqt();
setInterval(markActiveWaqt, 30000);

/* Re-detect whenever DOM times change — debounced */
let _mobsTimer=null;
const _timeObs=new MutationObserver(()=>{
  clearTimeout(_mobsTimer);
  _mobsTimer=setTimeout(markActiveWaqt,200);
});
WAQT_KEYS.forEach(k=>{
  const el=document.getElementById("t-"+k);
  if(el) _timeObs.observe(el,{childList:true,characterData:true,subtree:true});
});

/* Dust is now pure CSS — no JS spawn needed */

/* ═══════════════════════════════════════
   TOUCH RIPPLE
═══════════════════════════════════════ */
document.querySelectorAll(".p-row").forEach(row=>{
  row.addEventListener("pointerdown",function(e){
    const rect=row.getBoundingClientRect();
    const size=Math.max(rect.width,rect.height)*.65;
    const x=e.clientX-rect.left-size/2, y=e.clientY-rect.top-size/2;
    const r=document.createElement("div"); r.className="ripple-ring";
    r.style.cssText=`width:${size}px;height:${size}px;left:${x}px;top:${y}px;`;
    row.appendChild(r); setTimeout(()=>r.remove(),620);
  },{passive:true});
});

/* ═══════════════════════════════════════
   BANGLA & HIJRI DATES
═══════════════════════════════════════ */
const BN=n=>String(n).replace(/\d/g,d=>"০১২৩৪৫৬৭৮৯"[d]);
const BNM=["জানুয়ারি","ফেব্রুয়ারি","মার্চ","এপ্রিল","মে","জুন","জুলাই","আগস্ট","সেপ্টেম্বর","অক্টোবর","নভেম্বর","ডিসেম্বর"];
const BND=["রবিবার","সোমবার","মঙ্গলবার","বুধবার","বৃহস্পতিবার","শুক্রবার","শনিবার"];
const HJM=["مُحَرَّم","صَفَر","رَبِيع الأوَّل","رَبِيع الثَّانِي","جُمَادَى الأولَى","جُمَادَى الثَّانِيَة","رَجَب","شَعْبَان","رَمَضَان","شَوَّال","ذُو الْقَعْدَة","ذُو الْحِجَّة"];
function toHijri(Y,M,D){
  let jd=Math.floor((14-M)/12),y=Y+4800-jd,m=M+12*jd-3;
  let jdn=D+Math.floor((153*m+2)/5)+365*y+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400)-32045;
  let l=jdn-1948440+10632,n=Math.floor((l-1)/10631);l=l-10631*n+354;
  let j=Math.floor((10985-l)/5316)*Math.floor((50*l)/17719)+Math.floor(l/5670)*Math.floor((43*l)/15238);
  l=l-Math.floor((30-j)/15)*Math.floor((17719*j)/50)-Math.floor(j/16)*Math.floor((15238*j)/43)+29;
  let hm=Math.floor((24*l)/709);
  return{d:l-Math.floor(709*hm/24),m:hm,y:30*n+j-30};
}
function refreshDates(){
  const now=new Date(),d=now.getDate(),mo=now.getMonth(),y=now.getFullYear();
  document.getElementById("d-eng").textContent=BND[now.getDay()]+"، "+BN(d)+" "+BNM[mo]+" "+BN(y);
  const h=toHijri(y,mo+1,d);
  document.getElementById("d-hij").textContent=h.d+" "+HJM[h.m-1]+" "+BN(h.y);
}
refreshDates();
setTimeout(()=>{refreshDates();setInterval(refreshDates,86400000);},new Date().setHours(24,0,0,0)-Date.now());

/* ═══════════════════════════════════════
   IFTAR / SEHRI COUNTDOWN TIMER
   Real-time: counts from actual current moment
   Updates every 250ms for smooth seconds
═══════════════════════════════════════ */
(function initCountdown(){
  const pad  = n => String(n).padStart(2,"0");
  const BN2  = s => String(s).replace(/\d/g, d => "০১২৩৪৫৬৭৮৯"[d]);

  /* Parse "৬:৪৫ PM" or "6:45 PM" → minutes since midnight */
  function parseTimeTxt(txt){
    if(!txt) return null;
    const s = txt.replace(/[০-৯]/g, d=>"০১২৩৪৫৬৭৮৯".indexOf(d).toString());
    const m = s.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);
    if(!m) return null;
    let h=parseInt(m[1]), mn=parseInt(m[2]);
    if(/pm/i.test(m[3])&&h!==12) h+=12;
    if(/am/i.test(m[3])&&h===12) h=0;
    return h*60+mn; /* minutes since midnight */
  }

  /* Get a fresh Date object set to today at the given minute-of-day.
     If that moment is already past, advance to tomorrow. */
  function getTarget(key){
    const el = document.getElementById("t-"+key);
    if(!el) return null;
    const mins = parseTimeTxt(el.textContent||"");
    if(mins===null) return null;
    const now  = new Date();
    const target = new Date(now);
    target.setHours(Math.floor(mins/60), mins%60, 0, 0);
    if(target <= now) target.setDate(target.getDate()+1);
    return target;
  }

  function render(prefix, target){
    const hEl = document.getElementById("cdp-"+prefix+"-h");
    const mEl = document.getElementById("cdp-"+prefix+"-m");
    const sEl = document.getElementById("cdp-"+prefix+"-s");
    const lEl = document.getElementById("cdp-"+prefix+"-lbl");
    if(!hEl||!mEl||!sEl) return;

    if(!target){
      hEl.textContent=mEl.textContent=sEl.textContent="--";
      if(lEl) lEl.textContent="সময় পাওয়া যায়নি";
      return;
    }

    /* Use real wall-clock diff from this exact moment */
    const diffMs = target.getTime() - Date.now();

    if(diffMs <= 0){
      hEl.textContent=mEl.textContent=sEl.textContent=BN2("00");
      if(lEl) lEl.textContent=(prefix==="iftar")?"🌇 ইফতারের সময় হয়েছে!":"🌙 সেহরির সময় শেষ!";
      return;
    }

    const totalSec = Math.floor(diffMs/1000);
    const hh = Math.floor(totalSec/3600);
    const mm = Math.floor((totalSec%3600)/60);
    const ss = totalSec%60;

    hEl.textContent = BN2(pad(hh));
    mEl.textContent = BN2(pad(mm));
    sEl.textContent = BN2(pad(ss));

    if(lEl){
      if(hh>0)      lEl.textContent = BN2(hh)+" ঘণ্টা "+BN2(mm)+" মিনিট বাকি";
      else if(mm>0) lEl.textContent = BN2(mm)+" মিনিট "+BN2(ss)+" সেকেন্ড বাকি";
      else          lEl.textContent = "মাত্র "+BN2(ss)+" সেকেন্ড বাকি!";
    }
  }

  function tickAll(){
    render("iftar", getTarget("iftar"));
    render("sehri", getTarget("sehri"));
  }


  /* rAF-based tick: syncs to display refresh, no drift, smooth seconds */
  tickAll();
  let _lastSec=-1;
  (function rafTick(){
    const s=Math.floor(Date.now()/1000);
    if(s!==_lastSec){_lastSec=s;tickAll();}
    requestAnimationFrame(rafTick);
  })();

  /* Re-tick when Firebase updates prayer times */
  const obs = new MutationObserver(()=>{ tickAll(); });
  ["t-iftar","t-sehri"].forEach(id=>{
    const el=document.getElementById(id);
    if(el) obs.observe(el,{childList:true,characterData:true,subtree:true});
  });
})();

/* ═══════════════════════════════════════
   CELEBRATION BURST
═══════════════════════════════════════ */
function burst(){
  const C=document.getElementById("pcl");
  const cols=["#fdeea0","#f5d870","#e8bf50","#fff8d0","#d4a832","#b9f6ca","#c8f5e8","#ffffff","#ffd54f","#ffecb3","#ffe082"];
  const shapes=["50%","4px","50%","2px","50%","6px","50%"];
  for(let i=0;i<110;i++){
    const p=document.createElement("div"); p.className="pc";
    const sz=3+Math.random()*15, c=cols[~~(Math.random()*cols.length)], sh=shapes[~~(Math.random()*shapes.length)];
    p.style.cssText=`width:${sz}px;height:${sz}px;background:${c};border-radius:${sh};`+
      `left:${2+Math.random()*96}%;bottom:${2+Math.random()*58}%;`+
      `animation-delay:${Math.random()*.85}s;animation-duration:${1.3+Math.random()*1.2}s;`+
      `box-shadow:0 0 ${sz*2.2}px ${c};`;
    C.appendChild(p); setTimeout(()=>p.remove(),3400);
  }
}
</script>
</body><!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0d0f1a">
<title>CyberVault Pro — Encrypted Password Manager</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged }
    from "https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js";
  import { getFirestore, collection, doc, setDoc, getDoc, getDocs, deleteDoc, onSnapshot, query, where }
    from "https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js";
  const firebaseConfig = {
    apiKey: "AIzaSyB_vBGL4CyRPiDWgUjTxuJo2aUCVb34Y_8",
    authDomain: "cybervault-24007.firebaseapp.com",
    projectId: "cybervault-24007",
    storageBucket: "cybervault-24007.firebasestorage.app",
    messagingSenderId: "354484307824",
    appId: "1:354484307824:web:c5814b5130bce10d97f1b5"
  };
  let app, auth, db;
  try {
    app = initializeApp(firebaseConfig);
    auth = getAuth(app); db = getFirestore(app);
    window._firebaseAuth = auth; window._firebaseDb = db;
    window._firebaseModules = { collection, doc, setDoc, getDoc, getDocs, deleteDoc, onSnapshot, query, where,
      createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged };
    window._firebaseReady = true;
  } catch(e) { window._firebaseReady = false; }
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&family=Syne:wght@700;800&display=swap" rel="stylesheet">
<style>
/* ═══════════════════════════════════════════════════════
   DESIGN TOKENS — DARK MODE (default)
═══════════════════════════════════════════════════════ */
:root {
  /* Core Backgrounds */
  --bg:           #0a0c16;
  --bg-alt:       #0e1020;
  --surface:      #131628;
  --surface-2:    #1a1e35;
  --surface-3:    #222740;
  --elevated:     #1e2238;
  --glass:        rgba(19,22,40,0.85);

  /* Brand — Violet/Cyan/Emerald Accent System */
  --violet:       #7c3aed;
  --violet-light: rgba(124,58,237,0.15);
  --violet-mid:   #8b5cf6;
  --violet-dark:  #6d28d9;
  --violet-glow:  rgba(124,58,237,0.35);
  --cyan:         #06b6d4;
  --cyan-light:   rgba(6,182,212,0.12);
  --cyan-mid:     #22d3ee;
  --cyan-dark:    #0891b2;
  --emerald:      #10b981;
  --emerald-light:rgba(16,185,129,0.12);
  --rose:         #f43f5e;
  --rose-light:   rgba(244,63,94,0.12);
  --rose-dark:    #e11d48;
  --amber:        #f59e0b;
  --amber-light:  rgba(245,158,11,0.12);
  --white:        #ffffff;

  /* Text */
  --t1: #f0f2ff;
  --t2: #a8b0d8;
  --t3: #6b749a;
  --t4: #404870;
  --t5: #242a4a;

  /* Borders */
  --b1: rgba(255,255,255,0.06);
  --b2: rgba(255,255,255,0.10);
  --b3: rgba(124,58,237,0.35);

  /* Shadows */
  --shadow-xs:   0 1px 3px rgba(0,0,0,0.3);
  --shadow-sm:   0 2px 8px rgba(0,0,0,0.35);
  --shadow-md:   0 4px 20px rgba(0,0,0,0.4);
  --shadow-lg:   0 12px 40px rgba(0,0,0,0.5);
  --shadow-xl:   0 24px 64px rgba(0,0,0,0.6);
  --shadow-glow: 0 0 40px rgba(124,58,237,0.2);

  /* Geometry */
  --r-xs: 4px; --r-sm: 8px; --r-md: 12px;
  --r-lg: 16px; --r-xl: 20px; --r-2xl: 28px;

  /* Fonts */
  --font-head: 'Syne', sans-serif;
  --font-body: 'Inter', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;

  --ease: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
  --ease-out: cubic-bezier(0, 0, 0.2, 1);

  /* Theme transition */
  --theme-transition: background 0.35s var(--ease), color 0.35s var(--ease), border-color 0.35s var(--ease), box-shadow 0.35s var(--ease);
}

/* ═══════════ LIGHT MODE ═══════════ */
[data-theme="light"] {
  --bg:           #f4f5fb;
  --bg-alt:       #eceef8;
  --surface:      #ffffff;
  --surface-2:    #f0f2fc;
  --surface-3:    #e8eaf5;
  --elevated:     #ffffff;
  --glass:        rgba(255,255,255,0.92);
  --t1: #0d0f1f;
  --t2: #3a4070;
  --t3: #6b73a0;
  --t4: #9aa0c2;
  --t5: #c8cce0;
  --b1: rgba(13,15,31,0.07);
  --b2: rgba(13,15,31,0.12);
  --b3: rgba(124,58,237,0.3);
  --shadow-xs:   0 1px 3px rgba(13,15,31,0.06);
  --shadow-sm:   0 2px 8px rgba(13,15,31,0.08);
  --shadow-md:   0 4px 20px rgba(13,15,31,0.10);
  --shadow-lg:   0 12px 40px rgba(13,15,31,0.12);
  --shadow-xl:   0 24px 64px rgba(13,15,31,0.14);
  --shadow-glow: 0 0 40px rgba(124,58,237,0.15);
  --violet-light: rgba(124,58,237,0.10);
  --cyan-light:   rgba(6,182,212,0.10);
  --emerald-light:rgba(16,185,129,0.10);
  --rose-light:   rgba(244,63,94,0.10);
  --amber-light:  rgba(245,158,11,0.10);
}

/* ═══════════ RESET ═══════════ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 15px; scroll-behavior: smooth; height: 100%; }
body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--t1);
  min-height: 100vh; height: 100%;
  overflow: hidden;
  -webkit-font-smoothing: antialiased;
  transition: var(--theme-transition);
}
input, select, textarea, button { font-family: inherit; }
::selection { background: rgba(124,58,237,0.2); color: var(--t1); }
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: var(--surface-2); }
::-webkit-scrollbar-thumb { background: var(--t5); border-radius: 10px; }
::-webkit-scrollbar-thumb:hover { background: var(--t4); }

/* ═══════════ ANIMATED BACKGROUND ═══════════ */
#bg-canvas {
  position: fixed; inset: 0; z-index: 0; pointer-events: none; opacity: 0.5;
}

/* ═══════════ SCREEN SYSTEM ═══════════ */
.screen {
  position: fixed; inset: 0; z-index: 100;
  display: flex; align-items: center; justify-content: center;
  background: var(--bg);
  transition: opacity 0.45s var(--ease), transform 0.45s var(--ease);
}
.screen.hidden { opacity: 0; pointer-events: none; transform: scale(1.03); }
.screen.slide-out { animation: slide-out 0.4s var(--ease) forwards; }
@keyframes slide-out {
  to { opacity: 0; transform: translateY(-20px) scale(0.97); }
}

/* ═══════════ AUTH SCREEN ═══════════ */
#auth-screen {
  background:
    radial-gradient(ellipse 70% 60% at 15% 15%, rgba(124,58,237,0.12) 0%, transparent 55%),
    radial-gradient(ellipse 60% 50% at 85% 85%, rgba(6,182,212,0.10) 0%, transparent 55%),
    radial-gradient(ellipse 50% 40% at 85% 10%, rgba(244,63,94,0.07) 0%, transparent 50%),
    var(--bg);
}

.auth-split {
  width: 980px; max-width: 98vw;
  display: flex; border-radius: var(--r-2xl); overflow: hidden;
  border: 1px solid var(--b1);
  box-shadow: var(--shadow-xl), var(--shadow-glow);
  animation: auth-enter 0.65s var(--ease-out) both;
}
@keyframes auth-enter {
  from { opacity: 0; transform: translateY(32px) scale(0.96); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

/* ── Auth Brand Panel ── */
.auth-brand {
  width: 380px; flex-shrink: 0;
  background: linear-gradient(145deg, #0d0f1e 0%, #13162e 55%, #0a0c1a 100%);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  padding: 52px 40px; position: relative; overflow: hidden;
}
[data-theme="light"] .auth-brand {
  background: linear-gradient(145deg, #1a1035 0%, #231548 55%, #160d2e 100%);
}
.auth-brand::before {
  content: '';
  position: absolute; inset: 0;
  background:
    radial-gradient(ellipse 110% 65% at 50% 0%, rgba(124,58,237,0.22) 0%, transparent 55%),
    radial-gradient(ellipse 90% 55% at 50% 100%, rgba(6,182,212,0.15) 0%, transparent 55%);
}
.auth-brand-mesh { position: absolute; inset: 0; overflow: hidden; }
.auth-brand-mesh::before, .auth-brand-mesh::after {
  content: ''; position: absolute;
  border-radius: 50%; border: 1px solid rgba(124,58,237,0.25);
  animation: pulse-ring 5s ease infinite;
}
.auth-brand-mesh::before { width: 220px; height: 220px; top: -70px; right: -70px; }
.auth-brand-mesh::after { width: 180px; height: 180px; bottom: -60px; left: -60px; animation-delay: 2.5s; border-color: rgba(6,182,212,0.2); }
@keyframes pulse-ring { 0%,100%{transform:scale(1);opacity:0.4} 50%{transform:scale(1.18);opacity:1} }

.auth-brand-inner { position: relative; z-index: 1; text-align: center; width: 100%; }

.brand-shield-wrap {
  width: 100px; height: 100px; margin: 0 auto 32px;
  position: relative; display: flex; align-items: center; justify-content: center;
}
.brand-shield-wrap svg { filter: drop-shadow(0 0 24px rgba(124,58,237,0.6)); }
.shield-orbit {
  position: absolute; inset: -14px; border-radius: 50%;
  border: 1.5px solid rgba(124,58,237,0.3);
  animation: orbit 7s linear infinite;
}
.shield-orbit::after {
  content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%);
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--violet-mid); margin-top: -4px;
  box-shadow: 0 0 10px var(--violet-mid);
}
.shield-orbit-2 {
  position: absolute; inset: -28px; border-radius: 50%;
  border: 1px solid rgba(6,182,212,0.2);
  animation: orbit 12s linear reverse infinite;
}
.shield-orbit-2::after {
  content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
  width: 6px; height: 6px; border-radius: 50%;
  background: var(--cyan); margin-bottom: -3px;
  box-shadow: 0 0 8px var(--cyan);
}
@keyframes orbit { to { transform: rotate(360deg); } }

.brand-name {
  font-family: var(--font-head); font-size: 30px; font-weight: 800;
  letter-spacing: 3px; text-transform: uppercase;
  background: linear-gradient(135deg, #a78bfa 0%, #67e8f9 50%, #818cf8 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  margin-bottom: 10px;
}
.brand-tagline {
  font-family: var(--font-mono); font-size: 9px; letter-spacing: 3px;
  color: rgba(255,255,255,0.3); text-transform: uppercase;
  text-align: center; line-height: 2;
}
.brand-divider {
  width: 48px; height: 1px; margin: 26px auto;
  background: linear-gradient(90deg, transparent, rgba(124,58,237,0.6), transparent);
}
.brand-features { display: flex; flex-direction: column; gap: 10px; width: 100%; }
.brand-feature {
  display: flex; align-items: center; gap: 12px;
  padding: 11px 14px; border-radius: var(--r-md);
  background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.07);
  transition: all 0.25s; cursor: default;
}
.brand-feature:hover { background: rgba(255,255,255,0.07); transform: translateX(4px); }
.brand-feature-icon {
  width: 32px; height: 32px; border-radius: var(--r-sm); flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
}
.brand-feature-icon.v { background: rgba(124,58,237,0.2); color: #a78bfa; }
.brand-feature-icon.c { background: rgba(6,182,212,0.18); color: #67e8f9; }
.brand-feature-icon.e { background: rgba(244,63,94,0.18); color: #fb7185; }
.brand-feature-text { font-size: 12px; color: rgba(255,255,255,0.6); font-family: var(--font-body); }
.brand-feature-text strong { color: rgba(255,255,255,0.88); font-weight: 600; display: block; font-size: 12px; margin-bottom: 1px; }

/* ── Auth Form Panel ── */
.auth-form-panel {
  flex: 1; background: var(--surface);
  display: flex; flex-direction: column; justify-content: center;
  padding: 52px 48px; position: relative;
}
.auth-form-header { margin-bottom: 32px; }
.auth-form-title {
  font-family: var(--font-head); font-size: 28px; font-weight: 800;
  color: var(--t1); margin-bottom: 7px; letter-spacing: -0.5px;
}
.auth-form-sub { font-size: 13px; color: var(--t3); }

.auth-tabs-row {
  display: flex; gap: 4px; margin-bottom: 28px;
  background: var(--surface-3); border-radius: var(--r-md);
  padding: 4px; border: 1px solid var(--b1);
}
.auth-tab {
  flex: 1; padding: 11px 16px; border-radius: calc(var(--r-md) - 2px);
  border: none; background: transparent; cursor: pointer;
  font-family: var(--font-head); font-size: 12px; font-weight: 700;
  letter-spacing: 1px; text-transform: uppercase; color: var(--t3);
  transition: all 0.28s var(--ease);
}
.auth-tab.active {
  background: linear-gradient(135deg, var(--violet), var(--violet-dark));
  color: #fff;
  box-shadow: 0 2px 14px rgba(124,58,237,0.4);
}

/* ═══════════ FORM ELEMENTS ═══════════ */
.form-field { margin-bottom: 16px; }
.field-label {
  display: flex; align-items: center; gap: 6px;
  font-size: 10px; font-weight: 700; letter-spacing: 1.5px;
  text-transform: uppercase; color: var(--t3); margin-bottom: 7px;
  font-family: var(--font-mono);
}
.field-label svg { color: var(--violet-mid); }

.field-input {
  width: 100%; padding: 11px 14px;
  background: var(--surface-2); border: 1.5px solid var(--b1);
  border-radius: var(--r-md); color: var(--t1);
  font-size: 13px; outline: none;
  transition: all 0.2s var(--ease);
}
.field-input:focus {
  border-color: var(--violet-mid); background: var(--surface);
  box-shadow: 0 0 0 3px rgba(124,58,237,0.15);
}
.field-input::placeholder { color: var(--t4); font-size: 12px; }
.field-input.has-icon { padding-right: 44px; }
.field-input option { background: var(--surface); color: var(--t1); }
.field-wrap { position: relative; }

.field-btn {
  position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
  background: none; border: none; cursor: pointer;
  color: var(--t4); padding: 4px; display: flex; align-items: center;
  transition: color 0.2s; border-radius: var(--r-sm);
}
.field-btn:hover { color: var(--violet-mid); }

.btn-primary {
  width: 100%; padding: 13px;
  background: linear-gradient(135deg, var(--violet) 0%, var(--violet-dark) 100%);
  border: none; border-radius: var(--r-md); cursor: pointer;
  font-family: var(--font-head); font-size: 12px; font-weight: 700;
  letter-spacing: 1.5px; text-transform: uppercase; color: #fff;
  transition: all 0.28s var(--ease);
  display: flex; align-items: center; justify-content: center; gap: 8px;
  box-shadow: 0 4px 24px rgba(124,58,237,0.35);
  position: relative; overflow: hidden;
}
.btn-primary::before {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  transform: translateX(-100%); transition: transform 0.5s;
}
.btn-primary:hover::before { transform: translateX(100%); }
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 36px rgba(124,58,237,0.5); }
.btn-primary:active { transform: translateY(0); }

.auth-err {
  min-height: 18px; margin-top: 10px;
  font-size: 11px; color: var(--rose); font-family: var(--font-mono);
  display: flex; align-items: center; gap: 5px;
}
.auth-note {
  margin-top: 18px; text-align: center;
  font-size: 11px; color: var(--t4); font-family: var(--font-mono);
  display: flex; align-items: center; justify-content: center; gap: 6px;
  padding: 10px; background: var(--surface-2); border-radius: var(--r-md);
  border: 1px solid var(--b1);
}

/* ═══════════ VAULT LOCK SCREEN ═══════════ */
#vault-screen {
  background:
    radial-gradient(ellipse 60% 50% at 50% 30%, rgba(244,63,94,0.07) 0%, transparent 60%),
    radial-gradient(ellipse 50% 40% at 20% 80%, rgba(124,58,237,0.07) 0%, transparent 55%),
    var(--bg);
}

.vault-card {
  width: 440px; max-width: 96vw;
  background: var(--surface); border: 1px solid var(--b1);
  border-radius: var(--r-2xl); padding: 48px 44px;
  position: relative; overflow: hidden;
  box-shadow: var(--shadow-xl), var(--shadow-glow);
  animation: auth-enter 0.55s var(--ease-out) both;
}
.vault-card-accent {
  position: absolute; top: 0; left: 0; right: 0; height: 3px;
  background: linear-gradient(90deg, var(--violet), var(--cyan), var(--rose));
}
.vault-card-glow {
  position: absolute; top: -80px; left: 50%; transform: translateX(-50%);
  width: 300px; height: 200px;
  background: radial-gradient(ellipse, rgba(124,58,237,0.1) 0%, transparent 70%);
  pointer-events: none;
}

.vault-icon-wrap {
  width: 100px; height: 100px; margin: 0 auto 30px;
  position: relative; display: flex; align-items: center; justify-content: center;
}
.vault-diamond {
  width: 74px; height: 74px;
  background: linear-gradient(135deg, var(--rose-light), rgba(244,63,94,0.06));
  border: 1.5px solid rgba(244,63,94,0.3);
  border-radius: 20px; rotate: 45deg;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 8px 32px rgba(244,63,94,0.15);
}
.vault-diamond-inner { rotate: -45deg; color: var(--rose); }
.vault-spin-ring {
  position: absolute; inset: -14px;
  border: 1.5px dashed rgba(244,63,94,0.25); border-radius: 50%;
  animation: spin 18s linear infinite;
}
.vault-spin-ring-2 {
  position: absolute; inset: -26px;
  border: 1px solid rgba(124,58,237,0.15); border-radius: 50%;
  animation: spin 28s linear reverse infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

.vault-title {
  font-family: var(--font-head); font-size: 26px; font-weight: 800;
  text-align: center; letter-spacing: -0.3px; color: var(--t1); margin-bottom: 6px;
}
.vault-sub {
  text-align: center; font-size: 12px; color: var(--t3);
  font-family: var(--font-mono); margin-bottom: 24px; letter-spacing: 0.5px;
}
.vault-user-badge {
  display: flex; align-items: center; justify-content: center; gap: 8px;
  padding: 8px 18px; border-radius: 100px;
  background: var(--surface-2); border: 1px solid var(--b1);
  font-size: 12px; color: var(--t2); font-family: var(--font-mono);
  margin-bottom: 28px;
}
.status-pip { width: 7px; height: 7px; border-radius: 50%; background: var(--emerald); box-shadow: 0 0 8px var(--emerald); animation: pip-pulse 2s infinite; }
@keyframes pip-pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.4;transform:scale(0.8)} }

.vault-attempts { font-size: 11px; color: var(--amber); text-align: center; font-family: var(--font-mono); margin-top: 10px; min-height: 16px; }
.vault-actions { display: flex; gap: 8px; margin-top: 20px; }
.btn-ghost {
  flex: 1; padding: 9px 14px; border-radius: var(--r-md);
  background: var(--surface-2); border: 1px solid var(--b1);
  color: var(--t2); cursor: pointer; font-size: 11px;
  font-family: var(--font-mono); letter-spacing: 1px; text-transform: uppercase; font-weight: 700;
  display: flex; align-items: center; justify-content: center; gap: 6px;
  transition: all 0.2s;
}
.btn-ghost:hover { border-color: var(--b2); color: var(--t1); background: var(--surface-3); }

/* ═══════════ TOPBAR ═══════════ */
.topbar {
  position: relative; z-index: 200;
  height: 60px; padding: 0 20px;
  background: var(--surface); border-bottom: 1px solid var(--b1);
  display: flex; align-items: center; gap: 12px;
  flex-shrink: 0; box-shadow: var(--shadow-xs);
  backdrop-filter: blur(12px);
}
.topbar-brand { display: flex; align-items: center; gap: 10px; margin-right: 4px; }
.topbar-brand-icon {
  width: 36px; height: 36px; border-radius: var(--r-md);
  background: linear-gradient(135deg, var(--violet), var(--violet-dark));
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 2px 14px rgba(124,58,237,0.4); flex-shrink: 0;
}
.topbar-brand-text {
  font-family: var(--font-head); font-size: 17px; font-weight: 800;
  letter-spacing: 0.5px; color: var(--t1);
}
.topbar-divider { width: 1px; height: 26px; background: var(--b1); flex-shrink: 0; }
.topbar-sync {
  display: flex; align-items: center; gap: 7px;
  font-size: 10px; color: var(--t3); font-family: var(--font-mono);
  letter-spacing: 1px; text-transform: uppercase;
}
.sync-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--emerald); box-shadow: 0 0 7px var(--emerald); animation: pip-pulse 2s infinite; }
.topbar-spacer { flex: 1; }
.topbar-user {
  display: flex; align-items: center; gap: 7px;
  font-size: 12px; color: var(--t2); font-family: var(--font-mono);
  padding: 6px 12px; border-radius: var(--r-md);
  background: var(--surface-2); border: 1px solid var(--b1);
}
.topbar-user-email { max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.topbar-btn {
  width: 36px; height: 36px; border-radius: var(--r-md);
  border: 1px solid var(--b1); background: var(--surface-2);
  cursor: pointer; color: var(--t2);
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s; flex-shrink: 0;
}
.topbar-btn:hover { border-color: var(--b2); color: var(--t1); background: var(--surface-3); }
.topbar-btn.lock-btn:hover { border-color: rgba(124,58,237,0.35); color: var(--violet-mid); background: var(--violet-light); }
.topbar-btn.danger:hover { border-color: rgba(244,63,94,0.35); color: var(--rose); background: var(--rose-light); }
.topbar-btn.theme-toggle { position: relative; overflow: hidden; }
.topbar-btn.theme-toggle:hover { border-color: rgba(245,158,11,0.3); color: var(--amber); background: var(--amber-light); }

.menu-toggle {
  display: none; width: 36px; height: 36px; border-radius: var(--r-md);
  border: 1px solid var(--b1); background: var(--surface-2);
  cursor: pointer; color: var(--t1);
  align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0;
}
.menu-toggle:hover { background: var(--surface-3); }

/* ═══════════ INACTIVITY BAR ═══════════ */
.inactivity-rail { height: 2px; background: var(--surface-3); flex-shrink: 0; }
.inactivity-fill {
  height: 100%; width: 100%;
  background: linear-gradient(90deg, var(--violet), var(--cyan), var(--rose));
  transition: width 1s linear;
}

/* ═══════════ APP BODY ═══════════ */
.app-body { display: flex; flex: 1; overflow: hidden; height: calc(100vh - 62px); }

/* ═══════════ SIDEBAR ═══════════ */
.sidebar {
  width: 230px; flex-shrink: 0;
  background: var(--surface); border-right: 1px solid var(--b1);
  overflow-y: auto; overflow-x: hidden;
  display: flex; flex-direction: column;
  transition: transform 0.32s var(--ease);
}
.sidebar-nav-head {
  padding: 20px 16px 8px;
  font-size: 9px; font-family: var(--font-mono); color: var(--t4);
  letter-spacing: 2.5px; text-transform: uppercase;
}
.sidebar-section-label {
  padding: 12px 16px 6px;
  font-size: 9px; font-family: var(--font-mono); color: var(--t4);
  letter-spacing: 2px; text-transform: uppercase;
}
.nav-item {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 14px; margin: 1px 8px; border-radius: var(--r-md);
  cursor: pointer; font-size: 13px; font-weight: 500; color: var(--t2);
  transition: all 0.2s var(--ease); position: relative;
  -webkit-tap-highlight-color: transparent; user-select: none;
}
.nav-item svg { color: var(--t4); transition: color 0.2s; flex-shrink: 0; }
.nav-item:hover { background: var(--surface-2); color: var(--t1); }
.nav-item:hover svg { color: var(--violet-mid); }
.nav-item.active {
  background: var(--violet-light);
  color: var(--violet-mid); font-weight: 600;
}
.nav-item.active svg { color: var(--violet-mid); }
.nav-item.active::before {
  content: ''; position: absolute; left: -8px; top: 50%; transform: translateY(-50%);
  width: 3px; height: 60%; border-radius: 0 3px 3px 0;
  background: linear-gradient(to bottom, var(--violet), var(--cyan));
}
.nav-badge {
  margin-left: auto;
  background: linear-gradient(135deg, var(--violet), var(--cyan-dark));
  color: #fff; font-size: 10px; font-weight: 700; font-family: var(--font-mono);
  padding: 2px 7px; border-radius: 100px; min-width: 20px; text-align: center;
}
.sidebar-bottom { margin-top: auto; padding: 16px; border-top: 1px solid var(--b1); }
.vault-status-card {
  display: flex; align-items: center; gap: 8px;
  padding: 10px 12px; border-radius: var(--r-md);
  background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(16,185,129,0.05));
  border: 1px solid rgba(16,185,129,0.2); font-size: 11px; color: var(--emerald);
  font-weight: 600;
}
.sidebar-overlay {
  display: none; position: fixed; inset: 0; z-index: 149;
  background: rgba(0,0,0,0.55); backdrop-filter: blur(4px);
}

/* ═══════════ MAIN CONTENT ═══════════ */
.main-content { flex: 1; overflow-y: auto; overflow-x: hidden; padding: 28px; background: var(--bg); }

/* ═══════════ SECTIONS ═══════════ */
.section { display: none; }
.section.active {
  display: block;
  animation: section-in 0.38s var(--ease-out) both;
}
@keyframes section-in {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ═══════════ PAGE HEADER ═══════════ */
.page-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 24px; flex-wrap: wrap; gap: 12px;
}
.page-title {
  font-family: var(--font-head); font-size: 22px; font-weight: 800;
  color: var(--t1); display: flex; align-items: center; gap: 10px; letter-spacing: -0.3px;
}
.page-title-accent {
  width: 4px; height: 24px; border-radius: 2px;
  background: linear-gradient(to bottom, var(--violet), var(--cyan));
  flex-shrink: 0;
}

/* ═══════════ STATS ROW ═══════════ */
.stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 24px; }
.stat-tile {
  background: var(--surface); border: 1px solid var(--b1);
  border-radius: var(--r-lg); padding: 20px 18px;
  position: relative; overflow: hidden; transition: all 0.28s var(--ease);
  box-shadow: var(--shadow-xs); cursor: default;
}
.stat-tile::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
  background: linear-gradient(90deg, transparent, var(--tile-accent), transparent); opacity: 0.8;
}
.stat-tile:hover { transform: translateY(-4px); box-shadow: var(--shadow-md); border-color: var(--b2); }
.stat-tile-bg-icon { position: absolute; right: -10px; bottom: -10px; width: 80px; height: 80px; color: var(--tile-accent); opacity: 0.06; }
.stat-tile-icon { width: 40px; height: 40px; border-radius: var(--r-md); margin-bottom: 14px; background: var(--tile-bg); border: 1px solid var(--tile-border); color: var(--tile-accent); display: flex; align-items: center; justify-content: center; }
.stat-tile-label { font-size: 10px; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; color: var(--t3); margin-bottom: 6px; font-family: var(--font-mono); }
.stat-tile-value { font-family: var(--font-head); font-size: 30px; font-weight: 800; color: var(--t1); line-height: 1; margin-bottom: 4px; background: linear-gradient(135deg, var(--t1) 0%, var(--tile-accent) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.stat-tile-sub { font-size: 11px; color: var(--t4); font-family: var(--font-mono); }

/* ═══════════ TOOLBAR ═══════════ */
.toolbar { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
.search-wrap { flex: 1; min-width: 200px; position: relative; }
.search-icon-pos { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--t4); display: flex; pointer-events: none; }
.search-input { width: 100%; padding: 10px 12px 10px 38px; background: var(--surface); border: 1.5px solid var(--b1); border-radius: var(--r-md); color: var(--t1); font-size: 13px; outline: none; transition: all 0.2s; }
.search-input:focus { border-color: var(--violet-mid); box-shadow: 0 0 0 3px rgba(124,58,237,0.12); }
.search-input::placeholder { color: var(--t4); }
.filter-ctrl { padding: 10px 12px; background: var(--surface); border: 1.5px solid var(--b1); border-radius: var(--r-md); color: var(--t1); font-size: 12px; outline: none; cursor: pointer; transition: border-color 0.2s; }
.filter-ctrl:focus { border-color: var(--violet-mid); }
.filter-ctrl option { background: var(--surface); }

.btn-add {
  display: flex; align-items: center; gap: 8px;
  padding: 10px 20px; border-radius: var(--r-md); border: none; cursor: pointer;
  background: linear-gradient(135deg, var(--violet), var(--violet-dark));
  color: #fff; font-family: var(--font-head); font-size: 11px;
  font-weight: 700; letter-spacing: 1px; text-transform: uppercase;
  transition: all 0.25s var(--ease); box-shadow: 0 2px 14px rgba(124,58,237,0.3);
  white-space: nowrap; position: relative; overflow: hidden;
}
.btn-add::before {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  transform: translateX(-100%); transition: transform 0.5s;
}
.btn-add:hover::before { transform: translateX(100%); }
.btn-add:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(124,58,237,0.45); }

/* ═══════════ PASSWORD CARD ═══════════ */
.cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(310px, 1fr)); gap: 14px; }
.pwd-card {
  background: var(--surface); border: 1px solid var(--b1);
  border-radius: var(--r-lg); padding: 20px;
  transition: all 0.28s var(--ease);
  position: relative; overflow: hidden; box-shadow: var(--shadow-xs);
  animation: card-appear 0.35s var(--ease-out) both;
}
@keyframes card-appear {
  from { opacity: 0; transform: translateY(12px) scale(0.98); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}
.pwd-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
  background: linear-gradient(90deg, transparent, var(--c-accent, var(--violet)), transparent);
  opacity: 0.5; transition: opacity 0.2s;
}
.pwd-card::after {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(135deg, rgba(124,58,237,0.03), transparent);
  opacity: 0; transition: opacity 0.28s; pointer-events: none;
}
.pwd-card:hover { border-color: rgba(124,58,237,0.25); transform: translateY(-3px); box-shadow: var(--shadow-md); }
.pwd-card:hover::before { opacity: 1; }
.pwd-card:hover::after { opacity: 1; }

.card-header { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 14px; }
.card-svc-icon {
  width: 46px; height: 46px; border-radius: var(--r-md); flex-shrink: 0;
  background: var(--surface-2); border: 1px solid var(--b1);
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; font-weight: 800; font-family: var(--font-head);
  overflow: hidden; transition: transform 0.2s;
}
.card-svc-icon img { width: 28px; height: 28px; object-fit: contain; border-radius: 4px; }
.card-svc-icon:hover { transform: scale(1.05); }

.card-info { flex: 1; min-width: 0; }
.card-name { font-family: var(--font-head); font-size: 14px; font-weight: 700; color: var(--t1); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 3px; }
.card-email { font-size: 11px; color: var(--t3); font-family: var(--font-mono); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 7px; }
.card-tags { display: flex; gap: 5px; flex-wrap: wrap; }
.tag { font-size: 9px; padding: 2px 8px; border-radius: 100px; font-family: var(--font-mono); letter-spacing: 0.5px; text-transform: uppercase; font-weight: 700; border: 1px solid; }
.tag-cat { background: var(--cyan-light); color: var(--cyan); border-color: rgba(6,182,212,0.25); }
.tag-fav { background: var(--amber-light); color: var(--amber); border-color: rgba(245,158,11,0.25); }
.tag-linked { background: var(--violet-light); color: var(--violet-mid); border-color: rgba(124,58,237,0.25); }
.tag-weak { background: var(--rose-light); color: var(--rose); border-color: rgba(244,63,94,0.25); }

.card-fav-btn { background: none; border: none; cursor: pointer; padding: 4px; color: var(--t5); transition: all 0.2s; flex-shrink: 0; }
.card-fav-btn:hover { color: var(--amber); transform: scale(1.2); }
.card-fav-btn.active { color: var(--amber); }

.pwd-row { display: flex; align-items: center; gap: 8px; background: var(--surface-2); border: 1.5px solid var(--b1); border-radius: var(--r-md); padding: 9px 12px; margin-bottom: 10px; }
.pwd-masked { font-family: var(--font-mono); font-size: 14px; color: var(--t4); letter-spacing: 3px; flex: 1; }
.pwd-revealed { font-family: var(--font-mono); font-size: 11px; color: var(--emerald); flex: 1; word-break: break-all; letter-spacing: 0.5px; }
.card-icon-btn { background: none; border: none; cursor: pointer; padding: 3px; color: var(--t4); display: flex; align-items: center; transition: all 0.2s; flex-shrink: 0; }
.card-icon-btn:hover { color: var(--violet-mid); transform: scale(1.15); }

.strength-track { height: 3px; background: var(--surface-3); border-radius: 2px; overflow: hidden; }
.strength-bar { height: 100%; border-radius: 2px; transition: width 0.6s var(--ease), background 0.6s; }
.strength-row { display: flex; align-items: center; justify-content: space-between; margin-top: 6px; }
.strength-label { font-size: 9px; font-family: var(--font-mono); color: var(--t4); letter-spacing: 1px; text-transform: uppercase; }

.linked-row { margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--b1); }
.linked-row-label { font-size: 9px; letter-spacing: 1.5px; color: var(--t4); font-family: var(--font-mono); text-transform: uppercase; margin-bottom: 8px; display: flex; align-items: center; gap: 5px; }
.linked-row-label svg { color: var(--violet-mid); }
.linked-chips { display: flex; flex-wrap: wrap; gap: 5px; }
.linked-chip { display: flex; align-items: center; gap: 4px; padding: 3px 10px; border-radius: 100px; background: var(--violet-light); border: 1px solid rgba(124,58,237,0.2); font-size: 10px; color: var(--violet-mid); font-family: var(--font-mono); transition: all 0.2s; }
.linked-chip:hover { border-color: rgba(124,58,237,0.4); }
.risk-alert { margin-top: 8px; padding: 8px 10px; background: rgba(244,63,94,0.06); border: 1px solid rgba(244,63,94,0.18); border-radius: var(--r-md); font-size: 10px; color: var(--rose); font-family: var(--font-mono); display: flex; align-items: center; gap: 7px; }
.card-notes { margin-top: 8px; padding: 9px 11px; background: var(--surface-2); border: 1px solid var(--b1); border-radius: var(--r-md); font-size: 11px; color: var(--t3); font-family: var(--font-mono); line-height: 1.5; }
.card-actions { display: flex; gap: 6px; margin-top: 12px; }
.ca-btn { flex: 1; padding: 8px; border-radius: var(--r-md); border: 1.5px solid var(--b1); background: var(--surface-2); color: var(--t2); cursor: pointer; font-size: 10px; font-family: var(--font-mono); letter-spacing: 0.5px; text-transform: uppercase; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 5px; transition: all 0.22s var(--ease); }
.ca-btn:hover { border-color: var(--b2); color: var(--t1); background: var(--surface-3); }
.ca-btn.copy:hover { border-color: rgba(6,182,212,0.3); color: var(--cyan); background: var(--cyan-light); }
.ca-btn.edit:hover { border-color: rgba(124,58,237,0.3); color: var(--violet-mid); background: var(--violet-light); }
.ca-btn.del { flex: 0.5; }
.ca-btn.del:hover { border-color: rgba(244,63,94,0.3); color: var(--rose); background: var(--rose-light); }

/* ═══════════ PANEL ═══════════ */
.panel { background: var(--surface); border: 1px solid var(--b1); border-radius: var(--r-lg); padding: 22px; box-shadow: var(--shadow-xs); margin-bottom: 16px; }
.panel-title { font-family: var(--font-head); font-size: 13px; font-weight: 700; letter-spacing: 0.5px; color: var(--t1); display: flex; align-items: center; gap: 8px; margin-bottom: 18px; }
.panel-title svg { color: var(--violet-mid); }

/* ═══════════ ACTIVITY ═══════════ */
.activity-list { display: flex; flex-direction: column; gap: 6px; }
.activity-item { display: flex; align-items: center; gap: 12px; padding: 10px 14px; border-radius: var(--r-md); background: var(--surface-2); border: 1px solid var(--b1); transition: all 0.2s; }
.activity-item:hover { border-color: var(--b2); transform: translateX(3px); }
.act-pip { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
.act-pip.add    { background: var(--emerald); box-shadow: 0 0 6px var(--emerald); }
.act-pip.edit   { background: var(--violet-mid); box-shadow: 0 0 6px var(--violet-mid); }
.act-pip.delete { background: var(--rose); box-shadow: 0 0 6px var(--rose); }
.act-pip.vault  { background: var(--cyan); box-shadow: 0 0 6px var(--cyan); }
.act-pip.copy   { background: var(--amber); box-shadow: 0 0 6px var(--amber); }
.act-text { flex: 1; font-size: 12px; color: var(--t2); }
.act-time { font-size: 10px; color: var(--t4); font-family: var(--font-mono); white-space: nowrap; }

/* ═══════════ EMPTY STATE ═══════════ */
.empty { text-align: center; padding: 60px 20px; grid-column: 1/-1; }
.empty-icon { width: 64px; height: 64px; border-radius: var(--r-lg); margin: 0 auto 16px; background: var(--surface-3); border: 1px solid var(--b1); display: flex; align-items: center; justify-content: center; color: var(--t4); }
.empty-title { font-family: var(--font-head); font-size: 16px; font-weight: 700; color: var(--t2); margin-bottom: 6px; }
.empty-sub { font-size: 12px; color: var(--t4); font-family: var(--font-mono); }

/* ═══════════ GENERATOR ═══════════ */
.gen-output-box { background: var(--surface-2); border: 1.5px solid var(--b2); border-radius: var(--r-lg); padding: 22px; font-family: var(--font-mono); font-size: 16px; color: var(--emerald); letter-spacing: 2px; text-align: center; min-height: 66px; display: flex; align-items: center; justify-content: center; word-break: break-all; line-height: 1.6; transition: all 0.3s; border-left: 3px solid var(--emerald); box-shadow: inset 0 0 20px rgba(16,185,129,0.05); }
.gen-options { display: flex; flex-direction: column; gap: 14px; margin: 18px 0; }
.gen-row { display: flex; align-items: center; gap: 18px; flex-wrap: wrap; }
.gen-check { display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px; color: var(--t2); }
.gen-check input[type=checkbox] { accent-color: var(--violet); width: 15px; height: 15px; }
.gen-slider-row { display: flex; align-items: center; gap: 12px; }
.gen-slider-label { font-size: 12px; font-family: var(--font-mono); color: var(--t2); min-width: 80px; }
.range-slider { flex: 1; accent-color: var(--violet); cursor: pointer; height: 4px; }
.gen-btn-row { display: flex; gap: 10px; }
.btn-generate { flex: 1; padding: 13px; border-radius: var(--r-md); border: none; cursor: pointer; background: linear-gradient(135deg, var(--violet), var(--violet-dark)); color: #fff; font-family: var(--font-head); font-size: 11px; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s var(--ease); box-shadow: 0 2px 14px rgba(124,58,237,0.3); }
.btn-generate:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(124,58,237,0.45); }
.btn-copy-gen { padding: 13px 22px; border-radius: var(--r-md); cursor: pointer; background: var(--surface-2); border: 1.5px solid var(--b2); color: var(--t1); font-family: var(--font-mono); font-size: 11px; letter-spacing: 1px; text-transform: uppercase; font-weight: 700; display: flex; align-items: center; gap: 8px; transition: all 0.2s; }
.btn-copy-gen:hover { border-color: var(--cyan); color: var(--cyan); background: var(--cyan-light); }

/* ═══════════ BACKUP ═══════════ */
.ie-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
.ie-tile { background: var(--surface); border: 1.5px solid var(--b1); border-radius: var(--r-lg); padding: 24px 20px; text-align: center; cursor: pointer; transition: all 0.28s var(--ease); box-shadow: var(--shadow-xs); }
.ie-tile:hover { border-color: rgba(124,58,237,0.3); transform: translateY(-3px); box-shadow: var(--shadow-md); }
.ie-tile.danger:hover { border-color: rgba(244,63,94,0.3); }
.ie-tile-icon { width: 52px; height: 52px; border-radius: var(--r-md); margin: 0 auto 14px; display: flex; align-items: center; justify-content: center; background: var(--violet-light); border: 1px solid rgba(124,58,237,0.2); color: var(--violet-mid); }
.ie-tile.danger .ie-tile-icon { background: var(--rose-light); border-color: rgba(244,63,94,0.2); color: var(--rose); }
.ie-tile-name { font-family: var(--font-head); font-size: 13px; font-weight: 700; letter-spacing: 0.5px; color: var(--t1); margin-bottom: 6px; }
.ie-tile-desc { font-size: 11px; color: var(--t3); font-family: var(--font-mono); }

/* ═══════════ SETTINGS ═══════════ */
.settings-group { display: flex; flex-direction: column; }
.setting-row { display: flex; align-items: center; justify-content: space-between; padding: 18px 0; border-bottom: 1px solid var(--b1); }
.setting-row:last-child { border-bottom: none; }
.setting-info { flex: 1; }
.setting-name { font-size: 14px; font-weight: 600; color: var(--t1); margin-bottom: 3px; }
.setting-desc { font-size: 11px; color: var(--t3); font-family: var(--font-mono); }
.setting-ctrl { margin-left: 20px; flex-shrink: 0; }
.select-ctrl { padding: 9px 14px; background: var(--surface-2); border: 1.5px solid var(--b1); border-radius: var(--r-md); color: var(--t1); font-size: 12px; font-family: var(--font-mono); outline: none; cursor: pointer; transition: border-color 0.2s; }
.select-ctrl:focus { border-color: var(--violet-mid); }
.select-ctrl option { background: var(--surface); }
.toggle { position: relative; width: 46px; height: 25px; cursor: pointer; }
.toggle input { opacity: 0; width: 0; height: 0; }
.toggle-track { position: absolute; inset: 0; border-radius: 13px; background: var(--surface-3); border: 1.5px solid var(--b2); transition: all 0.25s var(--ease); }
.toggle-thumb { position: absolute; top: 3px; left: 3px; width: 17px; height: 17px; border-radius: 50%; background: var(--t5); transition: all 0.25s var(--ease-spring); }
.toggle input:checked ~ .toggle-track { background: rgba(124,58,237,0.2); border-color: rgba(124,58,237,0.5); }
.toggle input:checked ~ .toggle-thumb { transform: translateX(21px); background: var(--violet-mid); box-shadow: 0 0 10px rgba(124,58,237,0.5); }

/* ═══════════ MODAL SYSTEM ═══════════ */
.modal-overlay { position: fixed; inset: 0; z-index: 500; background: rgba(0,0,0,0.7); backdrop-filter: blur(16px); display: flex; align-items: center; justify-content: center; padding: 16px; transition: opacity 0.28s var(--ease); }
.modal-overlay.hidden { opacity: 0; pointer-events: none; }
.modal-overlay.hidden .modal { transform: scale(0.93) translateY(12px); opacity: 0; }
.modal { width: 580px; max-width: 100%; max-height: 90vh; overflow-y: auto; background: var(--surface); border: 1px solid var(--b1); border-radius: var(--r-2xl); padding: 30px; box-shadow: var(--shadow-xl), var(--shadow-glow); transform: scale(1) translateY(0); opacity: 1; transition: transform 0.35s var(--ease-spring), opacity 0.28s var(--ease); }
.modal-accent-bar { position: absolute; top: 0; left: 28px; right: 28px; height: 2px; background: linear-gradient(90deg, var(--violet), var(--cyan), var(--rose)); border-radius: 0 0 2px 2px; }
.modal-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
.modal-title { font-family: var(--font-head); font-size: 16px; font-weight: 800; letter-spacing: -0.2px; color: var(--t1); display: flex; align-items: center; gap: 10px; }
.modal-title svg { color: var(--violet-mid); }
.modal-close { width: 32px; height: 32px; border-radius: var(--r-md); background: var(--surface-2); border: 1px solid var(--b1); cursor: pointer; color: var(--t3); display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
.modal-close:hover { border-color: rgba(244,63,94,0.3); color: var(--rose); background: var(--rose-light); }

.form-2col { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.field-textarea { width: 100%; padding: 10px 14px; height: 80px; resize: vertical; background: var(--surface-2); border: 1.5px solid var(--b1); border-radius: var(--r-md); color: var(--t1); font-family: var(--font-mono); font-size: 12px; outline: none; transition: all 0.2s; line-height: 1.6; }
.field-textarea:focus { border-color: var(--violet-mid); box-shadow: 0 0 0 3px rgba(124,58,237,0.12); }
.field-textarea::placeholder { color: var(--t4); font-size: 11px; }
.input-group { display: flex; gap: 6px; }
.input-group .field-input { flex: 1; }
.icon-btn { width: 40px; height: 40px; border-radius: var(--r-md); flex-shrink: 0; background: var(--surface-2); border: 1.5px solid var(--b1); cursor: pointer; color: var(--t2); display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
.icon-btn:hover { border-color: var(--b2); color: var(--t1); background: var(--surface-3); }
.icon-btn.violet:hover { border-color: rgba(124,58,237,0.3); color: var(--violet-mid); background: var(--violet-light); }

.modal-strength { margin-top: 8px; }
.modal-strength-bar { height: 4px; border-radius: 2px; background: var(--surface-3); overflow: hidden; }
.modal-strength-fill { height: 100%; border-radius: 2px; transition: width 0.4s var(--ease), background 0.4s; }
.modal-strength-label { font-size: 10px; font-family: var(--font-mono); color: var(--t3); margin-top: 5px; letter-spacing: 0.5px; }

.linked-editor-box { background: var(--surface-2); border: 1.5px solid var(--b1); border-radius: var(--r-md); padding: 12px; }
.linked-edit-list { display: flex; flex-direction: column; gap: 6px; margin-bottom: 8px; }
.linked-edit-row { display: flex; align-items: center; gap: 7px; }
.linked-edit-icon { color: var(--t4); flex-shrink: 0; }
.linked-edit-input { flex: 1; padding: 8px 10px; background: var(--surface); border: 1.5px solid var(--b1); border-radius: var(--r-sm); color: var(--t1); font-family: var(--font-mono); font-size: 12px; outline: none; transition: border-color 0.2s; }
.linked-edit-input:focus { border-color: var(--violet-mid); }
.linked-edit-del { background: none; border: none; cursor: pointer; color: var(--t5); padding: 3px; display: flex; align-items: center; transition: color 0.2s; }
.linked-edit-del:hover { color: var(--rose); }
.btn-add-linked { width: 100%; padding: 9px; border-radius: var(--r-md); border: 1.5px dashed rgba(124,58,237,0.3); background: transparent; color: var(--violet-mid); font-family: var(--font-mono); font-size: 11px; letter-spacing: 1px; cursor: pointer; text-transform: uppercase; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 6px; transition: all 0.2s; }
.btn-add-linked:hover { background: var(--violet-light); border-color: rgba(124,58,237,0.5); }

.modal-footer { display: flex; gap: 10px; margin-top: 22px; }
.btn-save { flex: 1; padding: 13px; border-radius: var(--r-md); border: none; cursor: pointer; background: linear-gradient(135deg, var(--violet), var(--violet-dark)); color: #fff; font-family: var(--font-head); font-size: 11px; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; box-shadow: 0 2px 14px rgba(124,58,237,0.3); }
.btn-save:hover { transform: translateY(-1px); box-shadow: 0 6px 24px rgba(124,58,237,0.45); }
.btn-cancel { padding: 13px 22px; border-radius: var(--r-md); cursor: pointer; background: var(--surface-2); border: 1.5px solid var(--b1); color: var(--t2); font-family: var(--font-mono); font-size: 11px; letter-spacing: 1px; text-transform: uppercase; font-weight: 700; transition: all 0.2s; }
.btn-cancel:hover { border-color: var(--b2); color: var(--t1); background: var(--surface-3); }

/* ═══════════ CONFIRM MODAL ═══════════ */
.confirm-body { text-align: center; padding: 10px 0 4px; }
.confirm-icon-wrap { width: 72px; height: 72px; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; background: var(--rose-light); border: 2px solid rgba(244,63,94,0.25); color: var(--rose); }
.confirm-title { font-family: var(--font-head); font-size: 18px; font-weight: 800; color: var(--t1); margin-bottom: 10px; }
.confirm-text { font-size: 13px; color: var(--t2); line-height: 1.7; margin-bottom: 24px; }
.confirm-btns { display: flex; gap: 10px; justify-content: center; }
.btn-confirm-ok { padding: 12px 30px; border-radius: var(--r-md); border: none; cursor: pointer; background: linear-gradient(135deg, var(--rose), var(--rose-dark)); color: #fff; font-family: var(--font-head); font-size: 11px; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; transition: all 0.2s; box-shadow: 0 2px 14px rgba(244,63,94,0.3); }
.btn-confirm-ok:hover { transform: translateY(-1px); box-shadow: 0 6px 24px rgba(244,63,94,0.45); }

/* ═══════════ TOAST ═══════════ */
.toast-stack { position: fixed; bottom: 22px; right: 22px; z-index: 9999; display: flex; flex-direction: column-reverse; gap: 8px; }
.toast { display: flex; align-items: center; gap: 10px; padding: 13px 16px; border-radius: var(--r-lg); min-width: 280px; max-width: 380px; background: var(--surface); box-shadow: var(--shadow-lg); font-size: 13px; border: 1px solid; animation: toast-slide 0.32s var(--ease-spring); }
@keyframes toast-slide { from { opacity:0; transform: translateX(30px) scale(0.95); } to { opacity:1; transform: translateX(0) scale(1); } }
.toast.removing { animation: toast-out 0.25s var(--ease) forwards; }
@keyframes toast-out { to { opacity:0; transform: translateX(30px) scale(0.95); } }
.toast.success { border-color: rgba(16,185,129,0.3); color: var(--emerald); }
.toast.error   { border-color: rgba(244,63,94,0.3); color: var(--rose); }
.toast.info    { border-color: rgba(6,182,212,0.3); color: var(--cyan); }
.toast.warn    { border-color: rgba(245,158,11,0.3); color: var(--amber); }
.toast-icon { width: 20px; height: 20px; flex-shrink: 0; }
.toast-msg { flex: 1; line-height: 1.4; color: var(--t1); }
.toast-close { background: none; border: none; cursor: pointer; color: var(--t4); opacity: 0.6; padding: 2px; display: flex; align-items: center; }
.toast-close:hover { opacity: 1; }

/* ═══════════ LINKED MAP ═══════════ */
.link-map-entry { margin-bottom: 20px; }
.link-map-primary { display: flex; align-items: center; gap: 14px; padding: 14px; border-radius: var(--r-lg); background: var(--surface-2); border: 1px solid var(--b2); margin-bottom: 10px; }
.link-map-services { display: flex; flex-wrap: wrap; gap: 8px; padding-left: 20px; border-left: 2px solid rgba(124,58,237,0.2); margin-left: 22px; }
.link-map-svc { display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: var(--r-md); background: var(--violet-light); border: 1px solid rgba(124,58,237,0.2); font-size: 11px; color: var(--violet-mid); font-family: var(--font-mono); }
.risk-score-badge { font-family: var(--font-mono); font-size: 10px; letter-spacing: 1px; padding: 4px 10px; border-radius: 100px; background: var(--rose-light); color: var(--rose); border: 1px solid rgba(244,63,94,0.2); }

/* ═══════════ VAULT UNLOCK ANIMATION ═══════════ */
@keyframes vault-open {
  0%   { transform: scale(0.85) rotate(-6deg); opacity: 0; }
  60%  { transform: scale(1.04) rotate(1deg); opacity: 1; }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}
.vault-opening { animation: vault-open 0.55s var(--ease-spring) forwards; }

/* ═══════════ GRADIENT BANNER ═══════════ */
.gradient-banner { background: linear-gradient(135deg, rgba(124,58,237,0.08), rgba(6,182,212,0.07)); border: 1px solid rgba(124,58,237,0.2); border-radius: var(--r-md); padding: 12px 14px; margin-bottom: 20px; display: flex; gap: 10px; align-items: flex-start; }
.gradient-banner svg { color: var(--violet-mid); flex-shrink: 0; margin-top: 1px; }
.gradient-banner-text { font-size: 11px; color: var(--t2); font-family: var(--font-mono); line-height: 1.7; }
.gradient-banner-text strong { color: var(--violet-mid); }

/* ═══════════ MODAL SCROLLBAR ═══════════ */
.modal::-webkit-scrollbar { width: 4px; }
.modal::-webkit-scrollbar-thumb { background: var(--t5); border-radius: 4px; }

/* ═══════════ RESPONSIVE ═══════════ */
@media (max-width: 1100px) { .stats-row { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 900px) {
  .auth-brand { display: none; }
  .auth-split { max-width: 480px; }
  .auth-form-panel { padding: 40px 36px; }
  .topbar-user { display: none; }
}
@media (max-width: 700px) {
  .sidebar { position: fixed; left: 0; top: 62px; bottom: 0; z-index: 150; transform: translateX(-100%); width: 250px; box-shadow: var(--shadow-xl); }
  .sidebar.open { transform: translateX(0); animation: sidebar-slide 0.32s var(--ease) both; }
  @keyframes sidebar-slide { from { transform: translateX(-100%); opacity: 0.5; } to { transform: translateX(0); opacity: 1; } }
  .sidebar-overlay.visible { display: block; }
  .menu-toggle { display: flex; }
  .main-content { padding: 16px; }
  .topbar { padding: 0 12px; }
  .cards-grid { grid-template-columns: 1fr; }
  .form-2col { grid-template-columns: 1fr; }
  .ie-grid { grid-template-columns: 1fr; }
  .stats-row { grid-template-columns: 1fr 1fr; gap: 10px; }
  .stat-tile { padding: 14px; }
  .stat-tile-value { font-size: 24px; }
  .page-title { font-size: 18px; }
  .auth-split { max-width: 98vw; border-radius: var(--r-xl); }
  .auth-form-panel { padding: 28px 22px; }
  .topbar-sync { display: none; }
  .gen-row { flex-wrap: wrap; gap: 10px; }
}
@media (max-width: 420px) {
  .stats-row { grid-template-columns: 1fr 1fr; }
  .gen-btn-row { flex-direction: column; }
  .modal { padding: 20px; }
  .vault-card { padding: 32px 22px; }
  .topbar-brand-text { display: none; }
  .confirm-btns { flex-direction: column; }
}

/* ═══════════ FAVICON LOADING ANIMATION ═══════════ */
.favicon-loading { animation: favicon-spin 0.8s linear infinite; }
@keyframes favicon-spin { to { transform: rotate(360deg); } }

/* ═══════════ THEME TOGGLE ICON ═══════════ */
.theme-icon-sun, .theme-icon-moon { transition: all 0.3s var(--ease); }
[data-theme="dark"] .theme-icon-sun { opacity: 1; display: block; }
[data-theme="dark"] .theme-icon-moon { opacity: 0; display: none; }
[data-theme="light"] .theme-icon-sun { opacity: 0; display: none; }
[data-theme="light"] .theme-icon-moon { opacity: 1; display: block; }

/* ═══════════ PULSE GLOW FOR ACTIVE SECTION ═══════════ */
.section.active .page-title-accent {
  animation: accent-glow 3s ease infinite;
}
@keyframes accent-glow {
  0%,100% { box-shadow: 0 0 6px var(--violet); }
  50% { box-shadow: 0 0 14px var(--cyan); }
}

/* Card staggered animation */
.cards-grid .pwd-card:nth-child(1) { animation-delay: 0ms; }
.cards-grid .pwd-card:nth-child(2) { animation-delay: 40ms; }
.cards-grid .pwd-card:nth-child(3) { animation-delay: 80ms; }
.cards-grid .pwd-card:nth-child(4) { animation-delay: 120ms; }
.cards-grid .pwd-card:nth-child(5) { animation-delay: 160ms; }
.cards-grid .pwd-card:nth-child(6) { animation-delay: 200ms; }

/* ═══════════ URL FAVICON PREVIEW ═══════════ */
.url-favicon-preview {
  display: flex; align-items: center; gap: 8px;
  padding: 8px 12px; margin-top: 8px;
  background: var(--surface-2); border: 1px solid var(--b1);
  border-radius: var(--r-md); font-size: 11px; color: var(--t3);
  font-family: var(--font-mono); transition: all 0.2s;
}
.url-favicon-preview img { width: 20px; height: 20px; border-radius: 4px; object-fit: contain; }
.url-favicon-preview.hidden { display: none; }
</style>
</head>
<body>

<canvas id="bg-canvas"></canvas>
<div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>
<div class="toast-stack" id="toastContainer"></div>

<!-- ═══════════════ AUTH SCREEN ═══════════════ -->
<div class="screen" id="auth-screen">
  <div class="auth-split">
    <div class="auth-brand">
      <div class="auth-brand-mesh"></div>
      <div class="auth-brand-inner">
        <div class="brand-shield-wrap">
          <div class="shield-orbit"></div>
          <div class="shield-orbit-2"></div>
          <svg width="100" height="100" viewBox="0 0 100 100" fill="none">
            <path d="M50 8 L86 24 L86 54 C86 74 69 88 50 94 C31 88 14 74 14 54 L14 24 Z" fill="rgba(124,58,237,0.2)" stroke="#8b5cf6" stroke-width="1.5"/>
            <path d="M50 24 L72 36 L72 54 C72 66 62 75 50 79 C38 75 28 66 28 54 L28 36 Z" fill="rgba(124,58,237,0.12)" stroke="rgba(139,92,246,0.4)" stroke-width="1"/>
            <path d="M38 50 L47 59 L65 41" stroke="#a78bfa" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="50" cy="50" r="3" fill="rgba(124,58,237,0.4)"/>
          </svg>
        </div>
        <div class="brand-name">CyberVault</div>
        <div class="brand-tagline">ENCRYPTED PASSWORD<br>MANAGEMENT SYSTEM<br>v3.0 — AES-256</div>
        <div class="brand-divider"></div>
        <div class="brand-features">
          <div class="brand-feature">
            <div class="brand-feature-icon v">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            </div>
            <div class="brand-feature-text"><strong>AES-256 Encryption</strong>Client-side military-grade</div>
          </div>
          <div class="brand-feature">
            <div class="brand-feature-icon c">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
            </div>
            <div class="brand-feature-text"><strong>Multi-Device Sync</strong>Firebase real-time backup</div>
          </div>
          <div class="brand-feature">
            <div class="brand-feature-icon e">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><path d="M12 8v4l3 3"/></svg>
            </div>
            <div class="brand-feature-text"><strong>Auto-Lock Guard</strong>Inactivity protection</div>
          </div>
        </div>
      </div>
    </div>

    <div class="auth-form-panel">
      <div class="auth-form-header">
        <div class="auth-form-title">Access Your Vault</div>
        <div class="auth-form-sub">All data encrypted client-side — zero knowledge architecture</div>
      </div>
      <div class="auth-tabs-row">
        <button class="auth-tab active" onclick="switchAuthTab('login')">Sign In</button>
        <button class="auth-tab" onclick="switchAuthTab('register')">Register</button>
      </div>
      <!-- LOGIN -->
      <div id="login-form">
        <div class="form-field">
          <div class="field-label">
            <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
            Email Address
          </div>
          <input class="field-input" type="email" id="login-email" placeholder="agent@cybervault.io" autocomplete="email">
        </div>
        <div class="form-field">
          <div class="field-label">
            <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            Password
          </div>
          <div class="field-wrap">
            <input class="field-input has-icon" type="password" id="login-password" placeholder="••••••••••" autocomplete="current-password">
            <button class="field-btn" onclick="toggleVis('login-password',this)" type="button">
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
          </div>
        </div>
        <button class="btn-primary" onclick="handleLogin()">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
          Access Vault
        </button>
      </div>
      <!-- REGISTER -->
      <div id="register-form" style="display:none">
        <div class="form-field">
          <div class="field-label">
            <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
            Email Address
          </div>
          <input class="field-input" type="email" id="reg-email" placeholder="agent@cybervault.io" autocomplete="email">
        </div>
        <div class="form-field">
          <div class="field-label">
            <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            Password (min. 8 chars)
          </div>
          <input class="field-input" type="password" id="reg-password" placeholder="••••••••••" autocomplete="new-password">
        </div>
        <button class="btn-primary" onclick="handleRegister()">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
          Create Account
        </button>
      </div>
      <div class="auth-err" id="auth-error"></div>
      <div class="auth-note">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        No Firebase config? App runs in encrypted local mode
      </div>
    </div>
  </div>
</div>

<!-- ═══════════════ VAULT LOCK SCREEN ═══════════════ -->
<div class="screen hidden" id="vault-screen">
  <div class="vault-card" id="vault-box">
    <div class="vault-card-accent"></div>
    <div class="vault-card-glow"></div>
    <div class="vault-icon-wrap">
      <div class="vault-spin-ring"></div>
      <div class="vault-spin-ring-2"></div>
      <div class="vault-diamond">
        <div class="vault-diamond-inner" id="vault-icon-el">
          <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        </div>
      </div>
    </div>
    <div class="vault-title">Vault Locked</div>
    <div class="vault-sub" id="vault-sub">Enter master password to decrypt vault</div>
    <div class="vault-user-badge">
      <div class="status-pip"></div>
      <span id="vault-user-info">Loading...</span>
    </div>
    <div class="form-field">
      <div class="field-label">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778"/></svg>
        Master Password
      </div>
      <div class="input-group">
        <input class="field-input" type="password" id="master-input" placeholder="Your master password" autocomplete="off">
        <button class="icon-btn" onclick="toggleVis('master-input',this)" type="button">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
        </button>
      </div>
    </div>
    <button class="btn-primary" onclick="unlockVault()" style="background:linear-gradient(135deg,var(--rose),var(--rose-dark));box-shadow:0 4px 24px rgba(244,63,94,0.35)">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></svg>
      Decrypt & Unlock Vault
    </button>
    <div class="vault-attempts" id="vault-attempts"></div>
    <div class="vault-actions">
      <button class="btn-ghost" onclick="handleSignOut()">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        Sign Out
      </button>
      <button class="btn-ghost" onclick="showSetMaster()">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778"/></svg>
        Set Master
      </button>
    </div>
  </div>
</div>

<!-- ═══════════════ MAIN APP ═══════════════ -->
<div class="screen hidden" id="app-screen" style="z-index:50;flex-direction:column;background:var(--bg)">

  <!-- TOPBAR -->
  <div class="topbar">
    <button class="menu-toggle" id="menu-toggle" onclick="toggleSidebar()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>
    <div class="topbar-brand">
      <div class="topbar-brand-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
          <path d="M12 2 L20 6 L20 14 C20 18.5 16.5 22 12 23 C7.5 22 4 18.5 4 14 L4 6 Z"/>
          <path d="M9 12 L11 14 L16 9" stroke-width="2.5" stroke-linecap="round"/>
        </svg>
      </div>
      <span class="topbar-brand-text">CyberVault</span>
    </div>
    <div class="topbar-divider"></div>
    <div class="topbar-sync">
      <div class="sync-dot"></div>
      <span>ENCRYPTED SYNC</span>
    </div>
    <div class="topbar-spacer"></div>
    <div class="topbar-user">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      <span class="topbar-user-email" id="topbar-user-email">—</span>
    </div>
    <button class="topbar-btn theme-toggle" title="Toggle Theme" onclick="toggleTheme()">
      <svg class="theme-icon-sun" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
      <svg class="theme-icon-moon" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
    </button>
    <button class="topbar-btn lock-btn" title="Lock Vault (Ctrl+L)" onclick="lockVault()">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
    </button>
    <button class="topbar-btn danger" title="Sign Out" onclick="handleSignOut()">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
    </button>
  </div>

  <div class="inactivity-rail"><div class="inactivity-fill" id="inactivity-fill"></div></div>

  <div class="app-body">

    <!-- SIDEBAR -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-nav-head">Navigation</div>

      <div class="sidebar-section-label">Main</div>
      <div class="nav-item active" onclick="showSection('dashboard');closeSidebar()" data-section="dashboard">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        Dashboard
      </div>
      <div class="nav-item" onclick="showSection('passwords');closeSidebar()" data-section="passwords">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
        Passwords
        <span class="nav-badge" id="pwd-count">0</span>
      </div>
      <div class="nav-item" onclick="showSection('favorites');closeSidebar()" data-section="favorites">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        Favorites
      </div>
      <div class="nav-item" onclick="showSection('linked');closeSidebar()" data-section="linked">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        Linked Map
      </div>
      <div class="nav-item" onclick="showSection('generator');closeSidebar()" data-section="generator">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        Generator
      </div>

      <div class="sidebar-section-label">System</div>
      <div class="nav-item" onclick="showSection('activity');closeSidebar()" data-section="activity">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        Activity Log
      </div>
      <div class="nav-item" onclick="showSection('backup');closeSidebar()" data-section="backup">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Backup
      </div>
      <div class="nav-item" onclick="showSection('settings');closeSidebar()" data-section="settings">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.07 4.93a10 10 0 0 0-14.14 0M4.93 19.07a10 10 0 0 0 14.14 0M12 2v2M12 20v2M2 12h2M20 12h2"/></svg>
        Settings
      </div>

      <div class="sidebar-bottom">
        <div class="vault-status-card">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2 L20 6 L20 14 C20 18.5 16.5 22 12 23 C7.5 22 4 18.5 4 14 L4 6 Z"/><path d="M9 12 L11 14 L16 9" stroke-linecap="round"/></svg>
          <span>Vault Secured</span>
        </div>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content" id="main-content">

      <!-- DASHBOARD -->
      <div class="section active" id="section-dashboard">
        <div class="page-header">
          <div class="page-title">
            <span class="page-title-accent"></span>
            Dashboard
          </div>
          <button class="btn-add" onclick="openAddModal()">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Add Password
          </button>
        </div>
        <div class="stats-row">
          <div class="stat-tile" style="--tile-accent:var(--violet);--tile-bg:var(--violet-light);--tile-border:rgba(124,58,237,0.2)">
            <svg class="stat-tile-bg-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778"/></svg>
            <div class="stat-tile-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777z"/></svg></div>
            <div class="stat-tile-label">Total Passwords</div>
            <div class="stat-tile-value" id="stat-total">0</div>
            <div class="stat-tile-sub">Encrypted entries</div>
          </div>
          <div class="stat-tile" style="--tile-accent:var(--rose);--tile-bg:var(--rose-light);--tile-border:rgba(244,63,94,0.2)">
            <svg class="stat-tile-bg-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/></svg>
            <div class="stat-tile-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div>
            <div class="stat-tile-label">Weak Passwords</div>
            <div class="stat-tile-value" id="stat-weak">0</div>
            <div class="stat-tile-sub">Need attention</div>
          </div>
          <div class="stat-tile" style="--tile-accent:var(--cyan);--tile-bg:var(--cyan-light);--tile-border:rgba(6,182,212,0.2)">
            <svg class="stat-tile-bg-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/></svg>
            <div class="stat-tile-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg></div>
            <div class="stat-tile-label">Linked Services</div>
            <div class="stat-tile-value" id="stat-linked">0</div>
            <div class="stat-tile-sub">Account bindings</div>
          </div>
          <div class="stat-tile" style="--tile-accent:var(--emerald);--tile-bg:var(--emerald-light);--tile-border:rgba(16,185,129,0.2)">
            <svg class="stat-tile-bg-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M12 2 L20 6 L20 14 C20 18.5 16.5 22 12 23"/></svg>
            <div class="stat-tile-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2 L20 6 L20 14 C20 18.5 16.5 22 12 23 C7.5 22 4 18.5 4 14 L4 6 Z"/><path d="M9 12 L11 14 L16 9" stroke-linecap="round"/></svg></div>
            <div class="stat-tile-label">Vault Health</div>
            <div class="stat-tile-value" id="stat-health">—</div>
            <div class="stat-tile-sub">Overall score</div>
          </div>
        </div>
        <div class="panel">
          <div class="panel-title">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            Recent Entries
          </div>
          <div id="dashboard-recent"></div>
        </div>
        <div class="panel">
          <div class="panel-title">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
            Recent Activity
          </div>
          <div class="activity-list" id="dashboard-activity"></div>
        </div>
      </div>

      <!-- PASSWORDS -->
      <div class="section" id="section-passwords">
        <div class="page-header">
          <div class="page-title"><span class="page-title-accent"></span>Password Vault</div>
          <button class="btn-add" onclick="openAddModal()">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Add Password
          </button>
        </div>
        <div class="toolbar">
          <div class="search-wrap">
            <div class="search-icon-pos"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div>
            <input class="search-input" id="search-input" placeholder="Search services, emails, notes..." oninput="renderPasswords()">
          </div>
          <select class="filter-ctrl" id="filter-cat" onchange="renderPasswords()">
            <option value="">All Categories</option>
            <option>Social</option><option>Email</option><option>Banking</option>
            <option>Shopping</option><option>Work</option><option>Gaming</option><option>Other</option>
          </select>
          <select class="filter-ctrl" id="sort-by" onchange="renderPasswords()">
            <option value="date-desc">Newest First</option>
            <option value="date-asc">Oldest First</option>
            <option value="name-asc">Name A–Z</option>
            <option value="strength-desc">Strongest</option>
          </select>
        </div>
        <div class="cards-grid" id="cards-grid"></div>
      </div>

      <!-- FAVORITES -->
      <div class="section" id="section-favorites">
        <div class="page-header">
          <div class="page-title"><span class="page-title-accent"></span>Favorites</div>
        </div>
        <div class="cards-grid" id="fav-grid"></div>
      </div>

      <!-- LINKED MAP -->
      <div class="section" id="section-linked">
        <div class="page-header">
          <div class="page-title"><span class="page-title-accent"></span>Account Binding Map</div>
        </div>
        <div class="panel" id="linked-map-panel">
          <div class="empty">
            <div class="empty-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg></div>
            <div class="empty-title">No Linked Accounts</div>
            <div class="empty-sub">Add passwords with linked services to visualize the binding map</div>
          </div>
        </div>
      </div>

      <!-- GENERATOR -->
      <div class="section" id="section-generator">
        <div class="page-header">
          <div class="page-title"><span class="page-title-accent"></span>Password Generator</div>
        </div>
        <div class="panel">
          <div class="gen-output-box" id="gen-output">Click Generate to create a secure password</div>
          <div class="gen-options">
            <div class="gen-slider-row">
              <div class="gen-slider-label">Length: <strong id="gen-len-val">16</strong></div>
              <input type="range" min="8" max="64" value="16" class="range-slider" id="gen-length" oninput="document.getElementById('gen-len-val').textContent=this.value">
            </div>
            <div class="gen-row">
              <label class="gen-check"><input type="checkbox" id="gen-upper" checked> Uppercase A–Z</label>
              <label class="gen-check"><input type="checkbox" id="gen-lower" checked> Lowercase a–z</label>
              <label class="gen-check"><input type="checkbox" id="gen-nums" checked> Numbers 0–9</label>
              <label class="gen-check"><input type="checkbox" id="gen-syms"> Symbols !@#$</label>
              <label class="gen-check"><input type="checkbox" id="gen-ambig"> Exclude Ambiguous</label>
            </div>
          </div>
          <div class="gen-btn-row">
            <button class="btn-generate" onclick="generatePassword()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
              Generate
            </button>
            <button class="btn-copy-gen" onclick="copyGenerated()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              Copy
            </button>
          </div>
          <div id="gen-strength-display" style="margin-top:14px"></div>
        </div>
      </div>

      <!-- ACTIVITY -->
      <div class="section" id="section-activity">
        <div class="page-header">
          <div class="page-title"><span class="page-title-accent"></span>Activity Log</div>
          <button class="btn-ghost" style="width:auto;padding:9px 18px;gap:6px;flex:none" onclick="clearActivity()">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>
            Clear Log
          </button>
        </div>
        <div class="panel">
          <div class="activity-list" id="activity-list"></div>
        </div>
      </div>

      <!-- BACKUP -->
      <div class="section" id="section-backup">
        <div class="page-header">
          <div class="page-title"><span class="page-title-accent"></span>Backup & Recovery</div>
        </div>
        <div class="panel">
          <div class="ie-grid">
            <div class="ie-tile" onclick="exportVault('json')">
              <div class="ie-tile-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></div>
              <div class="ie-tile-name">Export JSON</div>
              <div class="ie-tile-desc">Encrypted vault backup file</div>
            </div>
            <div class="ie-tile" onclick="exportVault('csv')">
              <div class="ie-tile-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div>
              <div class="ie-tile-name">Export CSV</div>
              <div class="ie-tile-desc">Encrypted CSV spreadsheet</div>
            </div>
            <div class="ie-tile" onclick="document.getElementById('import-file').click()">
              <div class="ie-tile-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg></div>
              <div class="ie-tile-name">Import JSON</div>
              <div class="ie-tile-desc">Restore from backup file</div>
            </div>
            <div class="ie-tile danger" onclick="confirmWipe()">
              <div class="ie-tile-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg></div>
              <div class="ie-tile-name">Secure Wipe</div>
              <div class="ie-tile-desc" style="color:var(--rose)">Permanently delete all data</div>
            </div>
          </div>
          <input type="file" id="import-file" accept=".json" style="display:none" onchange="importVault(this)">
        </div>
      </div>

      <!-- SETTINGS -->
      <div class="section" id="section-settings">
        <div class="page-header">
          <div class="page-title"><span class="page-title-accent"></span>Settings</div>
        </div>
        <div class="panel">
          <div class="settings-group">
            <div class="setting-row">
              <div class="setting-info">
                <div class="setting-name">Auto-Lock Timer</div>
                <div class="setting-desc">Lock vault after inactivity</div>
              </div>
              <div class="setting-ctrl">
                <select class="select-ctrl" id="setting-autolock" onchange="saveSetting('autolock',this.value)">
                  <option value="60">1 minute</option>
                  <option value="300" selected>5 minutes</option>
                  <option value="900">15 minutes</option>
                  <option value="1800">30 minutes</option>
                </select>
              </div>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <div class="setting-name">Clipboard Clear Timer</div>
                <div class="setting-desc">Auto-clear copied passwords</div>
              </div>
              <div class="setting-ctrl">
                <select class="select-ctrl" id="setting-clipboard" onchange="saveSetting('clipboard',this.value)">
                  <option value="10">10 seconds</option>
                  <option value="30" selected>30 seconds</option>
                  <option value="60">60 seconds</option>
                </select>
              </div>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <div class="setting-name">Blur on Focus Loss</div>
                <div class="setting-desc">Blur passwords when tab is inactive</div>
              </div>
              <div class="setting-ctrl">
                <label class="toggle">
                  <input type="checkbox" id="setting-blur" checked onchange="saveSetting('blur',this.checked)">
                  <div class="toggle-track"></div>
                  <div class="toggle-thumb"></div>
                </label>
              </div>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <div class="setting-name">Change Master Password</div>
                <div class="setting-desc">Update your vault encryption key</div>
              </div>
              <div class="setting-ctrl">
                <button class="btn-ghost" style="width:auto;padding:9px 16px;font-size:10px;flex:none" onclick="showChangeMaster()">Change</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /main-content -->
  </div><!-- /app-body -->
</div><!-- /app-screen -->

<!-- ═══════════ ADD/EDIT MODAL ═══════════ -->
<div class="modal-overlay hidden" id="pwd-modal">
  <div class="modal" style="position:relative">
    <div class="modal-accent-bar"></div>
    <div class="modal-head">
      <div class="modal-title">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778"/></svg>
        <span id="modal-title">Add Password</span>
      </div>
      <button class="modal-close" onclick="closePwdModal()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <input type="hidden" id="edit-id">
    <div class="form-2col">
      <div class="form-field">
        <div class="field-label">
          <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
          Service Name
        </div>
        <input class="field-input" id="f-name" placeholder="Gmail, Netflix, GitHub..." oninput="autoDetectService()">
      </div>
      <div class="form-field">
        <div class="field-label">
          <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
          Category
        </div>
        <select class="field-input" id="f-cat" style="cursor:pointer">
          <option>Other</option><option>Social</option><option>Email</option>
          <option>Banking</option><option>Shopping</option><option>Work</option><option>Gaming</option>
        </select>
      </div>
    </div>
    <div class="form-field">
      <div class="field-label">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        Email / Username
      </div>
      <input class="field-input" id="f-email" type="email" placeholder="user@example.com">
    </div>
    <div class="form-field">
      <div class="field-label">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        Password
      </div>
      <div class="input-group">
        <input class="field-input" id="f-pwd" type="password" placeholder="Enter or generate a secure password" oninput="updateModalStrength()">
        <button class="icon-btn" onclick="toggleFieldVisibility('f-pwd',this)" title="Toggle visibility">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
        </button>
        <button class="icon-btn violet" onclick="fillGenerated()" title="Generate password">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        </button>
      </div>
      <div class="modal-strength">
        <div class="modal-strength-bar"><div class="modal-strength-fill" id="modal-strength-fill" style="width:0%"></div></div>
        <div class="modal-strength-label" id="modal-strength-label">Enter a password to check strength</div>
      </div>
    </div>
    <div class="form-field">
      <div class="field-label">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
        Website URL
      </div>
      <input class="field-input" id="f-url" type="url" placeholder="https://example.com" oninput="updateFaviconPreview()">
      <div class="url-favicon-preview hidden" id="url-favicon-preview">
        <img id="favicon-preview-img" src="" alt="">
        <span id="favicon-preview-domain"></span>
      </div>
    </div>
    <div class="form-field">
      <div class="field-label">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        Secure Notes
      </div>
      <textarea class="field-textarea" id="f-notes" placeholder="Optional encrypted notes..."></textarea>
    </div>
    <div class="form-field">
      <div class="field-label">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        Linked Platforms (Account Binding)
      </div>
      <div class="linked-editor-box">
        <div class="linked-edit-list" id="linked-editor-list"></div>
        <button class="btn-add-linked" onclick="addLinkedField()">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          Add Linked Platform
        </button>
      </div>
    </div>
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-size:13px;color:var(--t2)">
        <input type="checkbox" id="f-fav" style="accent-color:var(--amber);width:14px;height:14px">
        Mark as Favorite
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color:var(--amber)"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
      </label>
    </div>
    <div class="modal-footer">
      <button class="btn-save" onclick="savePassword()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
        Save Encrypted
      </button>
      <button class="btn-cancel" onclick="closePwdModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- ═══════════ MASTER PASSWORD MODAL ═══════════ -->
<div class="modal-overlay hidden" id="master-modal">
  <div class="modal" style="max-width:440px;position:relative">
    <div class="modal-accent-bar"></div>
    <div class="modal-head">
      <div class="modal-title">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2 L20 6 L20 14 C20 18.5 16.5 22 12 23 C7.5 22 4 18.5 4 14 L4 6 Z"/></svg>
        <span id="master-modal-title">Set Master Password</span>
      </div>
      <button class="modal-close" onclick="closeMasterModal()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="gradient-banner">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
      <div class="gradient-banner-text">Master password encrypts your vault with AES-256 + PBKDF2. It is <strong>never stored</strong> anywhere. Forgetting it means permanent data loss.</div>
    </div>
    <div class="form-field">
      <div class="field-label">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        Master Password
      </div>
      <input class="field-input" type="password" id="new-master" placeholder="Strong master password (8+ chars)">
    </div>
    <div class="form-field">
      <div class="field-label">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 12l2 2 4-4"/><path d="M12 2L2 7l10 5 10-5-10-5z"/></svg>
        Confirm Password
      </div>
      <input class="field-input" type="password" id="confirm-master" placeholder="Repeat master password">
    </div>
    <div class="auth-err" id="master-error"></div>
    <button class="btn-primary" onclick="saveMasterPassword()" style="margin-top:8px">Set Master Password</button>
  </div>
</div>

<!-- ═══════════ CONFIRM MODAL ═══════════ -->
<div class="modal-overlay hidden" id="confirm-modal">
  <div class="modal" style="max-width:420px;position:relative">
    <div class="modal-accent-bar" style="background:linear-gradient(90deg,var(--violet),var(--rose),var(--cyan))"></div>
    <div class="confirm-body">
      <div class="confirm-icon-wrap" id="confirm-icon-wrap">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
      </div>
      <div class="confirm-title" id="confirm-title">Confirm Action</div>
      <div class="confirm-text" id="confirm-text"></div>
      <div class="confirm-btns">
        <button class="btn-confirm-ok" id="confirm-ok">Confirm</button>
        <button class="btn-cancel" onclick="closeConfirm()">Cancel</button>
      </div>
    </div>
  </div>
</div>

<script>
// ═══════════════════════════════════════════
//  THEME SYSTEM
// ═══════════════════════════════════════════
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('cv_theme', next);
}
// Load saved theme
(function() {
  const saved = localStorage.getItem('cv_theme') || 'dark';
  document.documentElement.setAttribute('data-theme', saved);
})();

// ═══════════════════════════════════════════
//  MOBILE SIDEBAR
// ═══════════════════════════════════════════
function toggleSidebar() {
  const s = document.getElementById('sidebar');
  const o = document.getElementById('sidebar-overlay');
  s.classList.toggle('open');
  o.classList.toggle('visible');
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebar-overlay').classList.remove('visible');
}

// ═══════════════════════════════════════════
//  ANIMATED BACKGROUND
// ═══════════════════════════════════════════
(function initBG() {
  const c = document.getElementById('bg-canvas');
  const ctx = c.getContext('2d');
  let W, H;
  const resize = () => { W = c.width = innerWidth; H = c.height = innerHeight; };
  resize(); window.addEventListener('resize', resize);
  const rand = (a, b) => Math.random() * (b - a) + a;
  const palette = ['rgba(124,58,237', 'rgba(6,182,212', 'rgba(244,63,94', 'rgba(16,185,129'];
  const pts = Array.from({ length: 55 }, () => ({
    x: rand(0, W||1200), y: rand(0, H||800),
    vx: rand(-0.15, 0.15), vy: rand(-0.15, 0.15),
    r: rand(1, 2.5), c: palette[Math.floor(rand(0, 4))], a: rand(0.05, 0.22)
  }));
  function frame() {
    ctx.clearRect(0, 0, W, H);
    const isDark = document.documentElement.getAttribute('data-theme') !== 'light';
    // Grid
    ctx.strokeStyle = isDark ? 'rgba(124,58,237,0.04)' : 'rgba(124,58,237,0.06)';
    ctx.lineWidth = 1;
    for (let x = 0; x < W; x += 90) { ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke(); }
    for (let y = 0; y < H; y += 90) { ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke(); }
    pts.forEach(p => {
      p.x += p.vx; p.y += p.vy;
      if (p.x < 0) p.x = W; if (p.x > W) p.x = 0;
      if (p.y < 0) p.y = H; if (p.y > H) p.y = 0;
      ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      const alpha = isDark ? p.a : p.a * 0.5;
      ctx.fillStyle = `${p.c},${alpha})`; ctx.fill();
    });
    for (let i = 0; i < pts.length; i++) for (let j = i + 1; j < pts.length; j++) {
      const dx = pts[i].x - pts[j].x, dy = pts[i].y - pts[j].y, d = Math.sqrt(dx*dx + dy*dy);
      if (d < 100) {
        ctx.beginPath(); ctx.moveTo(pts[i].x, pts[i].y); ctx.lineTo(pts[j].x, pts[j].y);
        const a = isDark ? 0.05 : 0.04;
        ctx.strokeStyle = `rgba(124,58,237,${a * (1 - d / 100)})`; ctx.lineWidth = 0.5; ctx.stroke();
      }
    }
    requestAnimationFrame(frame);
  }
  frame();
})();

// ═══════════════════════════════════════════
//  FAVICON LOADER — new feature!
// ═══════════════════════════════════════════
function getFaviconUrl(url) {
  try {
    const u = new URL(url);
    return `https://www.google.com/s2/favicons?domain=${u.hostname}&sz=32`;
  } catch(e) { return null; }
}

function updateFaviconPreview() {
  const url = document.getElementById('f-url').value.trim();
  const preview = document.getElementById('url-favicon-preview');
  const img = document.getElementById('favicon-preview-img');
  const domain = document.getElementById('favicon-preview-domain');
  if (!url || !url.startsWith('http')) { preview.classList.add('hidden'); return; }
  try {
    const u = new URL(url);
    const faviconUrl = getFaviconUrl(url);
    img.src = faviconUrl;
    domain.textContent = u.hostname;
    preview.classList.remove('hidden');
    img.onerror = () => { preview.classList.add('hidden'); };
  } catch(e) { preview.classList.add('hidden'); }
}

// Build service icon with favicon
function buildServiceIcon(p, svc) {
  const favicon = p.url ? getFaviconUrl(p.url) : null;
  if (favicon) {
    return `<div class="card-svc-icon" style="background:${svc.color}18;border-color:${svc.color}28;color:${svc.color}">
      <img src="${favicon}" alt="${esc(p.name)}" 
        onerror="this.parentElement.innerHTML='<span style=&quot;font-size:13px;font-weight:800;font-family:var(--font-head)&quot;>${svc.abbr}</span>'; this.parentElement.style.color='${svc.color}'"
      >
    </div>`;
  }
  return `<div class="card-svc-icon" style="background:${svc.color}18;border-color:${svc.color}28;color:${svc.color}">${svc.abbr}</div>`;
}

// ═══════════════════════════════════════════
//  BACKEND ENGINE (FULLY PRESERVED)
// ═══════════════════════════════════════════
const CV = {
  user: null, masterKey: null, masterHash: null,
  passwords: [], activityLog: [],
  settings: { autolock: 300, clipboard: 30, blur: true },
  vaultLocked: true, failedAttempts: 0,
  inactivityTimer: null, inactivityMax: 300, inactivityLeft: 300,
  clipboardTimer: null, currentSection: 'dashboard', editingId: null,

  deriveKey(masterPwd, salt) {
    return CryptoJS.PBKDF2(masterPwd, salt, { keySize: 256/32, iterations: 100000, hasher: CryptoJS.algo.SHA256 }).toString();
  },
  encrypt(data, key) { return CryptoJS.AES.encrypt(JSON.stringify(data), key).toString(); },
  decrypt(ciphertext, key) {
    try { const b = CryptoJS.AES.decrypt(ciphertext, key); return JSON.parse(b.toString(CryptoJS.enc.Utf8)); } catch(e) { return null; }
  },
  hashMaster(pwd) { return CryptoJS.SHA256(pwd + 'CyberVault_Salt_2024').toString(); },
  uid() { return Date.now().toString(36) + Math.random().toString(36).slice(2); },
  storageKey(k) { return `cv_${this.user?.uid || 'local'}_${k}`; },

  saveLocal() {
    if (!this.masterKey) return;
    localStorage.setItem(this.storageKey('vault'), this.encrypt(this.passwords, this.masterKey));
    localStorage.setItem(this.storageKey('log'), JSON.stringify(this.activityLog.slice(-200)));
    this.syncFirestore();
  },
  loadLocal() {
    const enc = localStorage.getItem(this.storageKey('vault'));
    if (enc && this.masterKey) { const dec = this.decrypt(enc, this.masterKey); if (dec) this.passwords = dec; }
    const log = localStorage.getItem(this.storageKey('log'));
    if (log) try { this.activityLog = JSON.parse(log); } catch(e){}
    this.syncFromFirestore();
  },
  async syncFirestore() {
    if (!window._firebaseReady || !this.user || !this.masterKey) return;
    try {
      const { doc, setDoc } = window._firebaseModules;
      await setDoc(doc(window._firebaseDb, 'vaults', this.user.uid), {
        vault: this.encrypt(this.passwords, this.masterKey),
        updatedAt: Date.now(), userEmail: this.user.email
      });
    } catch(e) { console.warn('Sync failed:', e); }
  },
  async syncFromFirestore() {
    if (!window._firebaseReady || !this.user || !this.masterKey) return;
    try {
      const { doc, getDoc } = window._firebaseModules;
      const snap = await getDoc(doc(window._firebaseDb, 'vaults', this.user.uid));
      if (snap.exists()) {
        const dec = this.decrypt(snap.data().vault, this.masterKey);
        if (dec && Array.isArray(dec)) {
          this.passwords = dec;
          localStorage.setItem(this.storageKey('vault'), snap.data().vault);
          renderPasswords(); renderDashboard();
        }
      }
    } catch(e) { console.warn('Firestore load failed:', e); }
  },
  addActivity(type, text) {
    this.activityLog.unshift({ type, text, time: new Date().toLocaleString() });
    if (this.activityLog.length > 200) this.activityLog.pop();
  },
  resetInactivity() { this.inactivityLeft = this.inactivityMax; },
};

// ── Service Detection ──
const SERVICE_MAP = {
  gmail:    { abbr:'GM', color:'#ea4335' }, yahoo:  { abbr:'YH', color:'#7e3af2' },
  outlook:  { abbr:'OL', color:'#0078d4' }, hotmail:{ abbr:'HM', color:'#0078d4' },
  facebook: { abbr:'FB', color:'#1877f2' }, instagram:{ abbr:'IG', color:'#e1306c' },
  twitter:  { abbr:'TW', color:'#1da1f2' }, netflix:{ abbr:'NF', color:'#e50914' },
  amazon:   { abbr:'AZ', color:'#ff9900' }, apple:  { abbr:'AP', color:'#888' },
  google:   { abbr:'GO', color:'#4285f4' }, github: { abbr:'GH', color:'#6e40c9' },
  linkedin: { abbr:'LI', color:'#0a66c2' }, spotify:{ abbr:'SP', color:'#1db954' },
  discord:  { abbr:'DC', color:'#5865f2' }, twitch: { abbr:'TW', color:'#9146ff' },
  paypal:   { abbr:'PP', color:'#003087' }, dropbox:{ abbr:'DB', color:'#0061ff' },
  reddit:   { abbr:'RD', color:'#ff4500' }, steam:  { abbr:'ST', color:'#66c0f4' },
  tiktok:   { abbr:'TK', color:'#010101' }, zoom:   { abbr:'ZM', color:'#2d8cff' },
  slack:    { abbr:'SL', color:'#4a154b' }, microsoft:{ abbr:'MS', color:'#00a4ef' },
};
function detectService(name='', email='') {
  const txt = (name + ' ' + email).toLowerCase();
  for (const [k, v] of Object.entries(SERVICE_MAP)) { if (txt.includes(k)) return { ...v, key: k }; }
  const initials = (name || 'UN').slice(0, 2).toUpperCase();
  return { abbr: initials, color: '#7c3aed', key: '' };
}
function linkedIcon(name) {
  const n = name.toLowerCase();
  for (const [k, v] of Object.entries(SERVICE_MAP)) { if (n.includes(k)) return v.abbr; }
  return '🔗';
}

// ── Auth ──
function switchAuthTab(tab) {
  document.getElementById('login-form').style.display = tab === 'login' ? '' : 'none';
  document.getElementById('register-form').style.display = tab === 'register' ? '' : 'none';
  document.querySelectorAll('.auth-tab').forEach((t, i) => t.classList.toggle('active', (i === 0) === (tab === 'login')));
  document.getElementById('auth-error').textContent = '';
}
async function handleLogin() {
  const email = document.getElementById('login-email').value.trim();
  const password = document.getElementById('login-password').value;
  if (!email || !password) { showAuthError('Please fill all fields'); return; }
  if (window._firebaseReady) {
    try {
      const cred = await window._firebaseModules.signInWithEmailAndPassword(window._firebaseAuth, email, password);
      CV.user = { uid: cred.user.uid, email: cred.user.email }; afterAuth();
    } catch(e) { CV.user = { uid: btoa(email), email }; afterAuth(); }
  } else { CV.user = { uid: btoa(email), email }; afterAuth(); }
}
async function handleRegister() {
  const email = document.getElementById('reg-email').value.trim();
  const password = document.getElementById('reg-password').value;
  if (!email || !password) { showAuthError('Please fill all fields'); return; }
  if (password.length < 8) { showAuthError('Password must be at least 8 characters'); return; }
  if (window._firebaseReady) {
    try {
      const cred = await window._firebaseModules.createUserWithEmailAndPassword(window._firebaseAuth, email, password);
      CV.user = { uid: cred.user.uid, email: cred.user.email };
      toast('Account created successfully', 'success'); afterAuth();
    } catch(e) { showAuthError(e.message || 'Registration failed'); }
  } else { CV.user = { uid: btoa(email), email }; toast('Running in local mode', 'info'); afterAuth(); }
}
function afterAuth() {
  hide('auth-screen');
  const hash = localStorage.getItem(`cv_${CV.user.uid}_master`);
  if (!hash) { showSetMaster(); } else { CV.masterHash = hash; showVaultScreen(); }
}
async function handleSignOut() {
  if (window._firebaseReady) try { await window._firebaseModules.signOut(window._firebaseAuth); } catch(e){}
  CV.user = null; CV.masterKey = null; CV.passwords = []; CV.vaultLocked = true;
  stopInactivity(); hide('app-screen'); hide('vault-screen'); show('auth-screen');
  toast('Signed out securely', 'info');
}
function showAuthError(msg) {
  const el = document.getElementById('auth-error');
  el.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>${msg}`;
}

// ── Master Password ──
function showSetMaster() {
  document.getElementById('master-modal-title').textContent = 'Set Master Password';
  ['new-master','confirm-master'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('master-error').textContent = '';
  show('master-modal');
}
function showChangeMaster() {
  document.getElementById('master-modal-title').textContent = 'Change Master Password';
  ['new-master','confirm-master'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('master-error').textContent = '';
  show('master-modal');
}
function closeMasterModal() { hide('master-modal'); }
function saveMasterPassword() {
  const pwd = document.getElementById('new-master').value;
  const confirm = document.getElementById('confirm-master').value;
  if (!pwd || pwd.length < 8) { document.getElementById('master-error').innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/></svg> Min 8 characters required`; return; }
  if (pwd !== confirm) { document.getElementById('master-error').innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/></svg> Passwords do not match`; return; }
  CV.masterKey = CV.deriveKey(pwd, CV.user.uid);
  CV.masterHash = CV.hashMaster(pwd);
  localStorage.setItem(`cv_${CV.user.uid}_master`, CV.masterHash);
  closeMasterModal(); toast('Master password set. Keep it safe!', 'success');
  CV.vaultLocked = false; showApp();
}

// ── Vault Lock/Unlock ──
function showVaultScreen() {
  hide('app-screen'); hide('auth-screen');
  document.getElementById('vault-user-info').textContent = CV.user.email;
  document.getElementById('vault-attempts').textContent = '';
  document.getElementById('master-input').value = '';
  show('vault-screen'); CV.failedAttempts = 0;
}
function unlockVault() {
  const pwd = document.getElementById('master-input').value;
  if (!pwd) { toast('Enter master password', 'warn'); return; }
  if (CV.hashMaster(pwd) === CV.masterHash) {
    CV.masterKey = CV.deriveKey(pwd, CV.user.uid); CV.vaultLocked = false; CV.failedAttempts = 0;
    document.getElementById('vault-box').classList.add('vault-opening');
    CV.addActivity('vault', 'Vault unlocked'); CV.loadLocal();
    setTimeout(() => { hide('vault-screen'); showApp(); }, 550);
  } else {
    CV.failedAttempts++;
    document.getElementById('vault-attempts').innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94"/></svg> Incorrect password — attempt ${CV.failedAttempts}/5`;
    toast('Incorrect master password', 'error');
    if (CV.failedAttempts >= 5) { toast('Too many attempts — signing out', 'error'); setTimeout(handleSignOut, 1500); }
    document.getElementById('master-input').value = '';
  }
}
function lockVault() {
  CV.masterKey = null; CV.vaultLocked = true; CV.passwords = [];
  stopInactivity(); hide('app-screen'); showVaultScreen(); toast('Vault locked', 'info');
}

// ── App ──
function showApp() {
  document.getElementById('topbar-user-email').textContent = CV.user.email;
  show('app-screen'); renderDashboard(); renderPasswords(); renderActivity(); startInactivity(); loadSettings();
}
function showSection(name) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  const sec = document.getElementById('section-' + name); if (sec) sec.classList.add('active');
  const nav = document.querySelector(`[data-section="${name}"]`); if (nav) nav.classList.add('active');
  CV.currentSection = name;
  if (name === 'dashboard') renderDashboard();
  if (name === 'passwords') renderPasswords();
  if (name === 'favorites') renderFavorites();
  if (name === 'linked') renderLinkedMap();
  if (name === 'activity') renderActivity();
  if (name === 'generator') generatePassword();
  // Scroll main content to top on nav change
  const mc = document.getElementById('main-content');
  if (mc) mc.scrollTo({ top: 0, behavior: 'smooth' });
}

// ── Password Strength ──
function passwordStrength(pwd) {
  if (!pwd) return { score: 0, label: 'None', color: 'var(--t5)', pct: 0 };
  let s = 0;
  if (pwd.length >= 8) s++; if (pwd.length >= 12) s++; if (pwd.length >= 16) s++;
  if (/[a-z]/.test(pwd)) s++; if (/[A-Z]/.test(pwd)) s++;
  if (/[0-9]/.test(pwd)) s++; if (/[^a-zA-Z0-9]/.test(pwd)) s++; if (pwd.length >= 20) s++;
  const L = [
    { label:'Very Weak',   color:'#f43f5e', pct:10 },
    { label:'Weak',        color:'#f97316', pct:25 },
    { label:'Fair',        color:'#f59e0b', pct:45 },
    { label:'Good',        color:'#84cc16', pct:65 },
    { label:'Strong',      color:'#22c55e', pct:80 },
    { label:'Very Strong', color:'#10b981', pct:95 },
    { label:'Excellent',   color:'#06b6d4', pct:100 },
  ];
  return { score: s, ...L[Math.min(s, L.length - 1)] };
}
function updateModalStrength() {
  const str = passwordStrength(document.getElementById('f-pwd').value);
  document.getElementById('modal-strength-fill').style.cssText = `width:${str.pct}%;background:${str.color}`;
  document.getElementById('modal-strength-label').style.color = str.color;
  document.getElementById('modal-strength-label').textContent = document.getElementById('f-pwd').value ? `Strength: ${str.label}` : 'Enter a password to check strength';
}

// ── Render Cards ──
function renderPasswords() {
  const grid = document.getElementById('cards-grid');
  let pwds = [...CV.passwords];
  const search = (document.getElementById('search-input')?.value || '').toLowerCase();
  const cat = document.getElementById('filter-cat')?.value || '';
  const sort = document.getElementById('sort-by')?.value || 'date-desc';
  if (search) pwds = pwds.filter(p => (p.name+p.email+p.url+'').toLowerCase().includes(search));
  if (cat) pwds = pwds.filter(p => p.category === cat);
  if (sort === 'date-desc') pwds.sort((a, b) => b.createdAt - a.createdAt);
  else if (sort === 'date-asc') pwds.sort((a, b) => a.createdAt - b.createdAt);
  else if (sort === 'name-asc') pwds.sort((a, b) => (a.name||'').localeCompare(b.name||''));
  else if (sort === 'strength-desc') pwds.sort((a, b) => passwordStrength(b._pwd||'').score - passwordStrength(a._pwd||'').score);
  document.getElementById('pwd-count').textContent = CV.passwords.length;
  if (pwds.length === 0) {
    grid.innerHTML = `<div class="empty"><div class="empty-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778"/></svg></div><div class="empty-title">No Passwords Found</div><div class="empty-sub">Add your first encrypted password to get started</div></div>`;
  } else { grid.innerHTML = pwds.map(p => cardHTML(p)).join(''); }
}
function cardHTML(p) {
  const svc = detectService(p.name, p.email);
  const str = passwordStrength(p._pwd || '');
  const linked = p.linked || [];
  return `
  <div class="pwd-card" id="card-${p.id}" style="--c-accent:${svc.color}">
    <div class="card-header">
      ${buildServiceIcon(p, svc)}
      <div class="card-info">
        <div class="card-name">${esc(p.name || 'Unknown')}</div>
        <div class="card-email">${esc(p.email || '')}</div>
        <div class="card-tags">
          ${p.category ? `<span class="tag tag-cat">${p.category}</span>` : ''}
          ${p.favorite ? `<span class="tag tag-fav">Favorite</span>` : ''}
          ${linked.length ? `<span class="tag tag-linked">${linked.length} linked</span>` : ''}
          ${str.score < 3 && p._pwd ? `<span class="tag tag-weak">Weak</span>` : ''}
        </div>
      </div>
      <button class="card-fav-btn ${p.favorite ? 'active' : ''}" onclick="toggleFav('${p.id}')">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="${p.favorite ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
      </button>
    </div>
    <div class="pwd-row">
      <span class="pwd-masked" id="pwd-display-${p.id}">● ● ● ● ● ● ● ● ● ●</span>
      <button class="card-icon-btn" onclick="togglePwdVisibility('${p.id}')">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
      </button>
    </div>
    <div class="strength-track"><div class="strength-bar" style="width:${str.pct}%;background:${str.color}"></div></div>
    <div class="strength-row">
      <span class="strength-label">STRENGTH</span>
      <span class="strength-label" style="color:${str.color}">${str.label.toUpperCase()}</span>
    </div>
    ${linked.length ? `
    <div class="linked-row">
      <div class="linked-row-label">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        Linked Services
      </div>
      <div class="linked-chips">${linked.map(l => `<span class="linked-chip">${linkedIcon(l)} ${esc(l)}</span>`).join('')}</div>
    </div>
    ${linked.length >= 2 ? `<div class="risk-alert"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/></svg>Risk: ${linked.length} services affected if compromised</div>` : ''}
    ` : ''}
    ${p.notes ? `<div class="card-notes">${esc(p.notes)}</div>` : ''}
    <div class="card-actions">
      <button class="ca-btn copy" onclick="copyPwd('${p.id}')">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
        Copy
      </button>
      <button class="ca-btn edit" onclick="editPassword('${p.id}')">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        Edit
      </button>
      <button class="ca-btn del" onclick="deletePassword('${p.id}')">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>
      </button>
    </div>
  </div>`;
}
function esc(s) { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

// ── Visibility Toggles ──
const visiblePwds = new Set();
function togglePwdVisibility(id) {
  const p = CV.passwords.find(p => p.id === id); if (!p) return;
  const el = document.getElementById(`pwd-display-${id}`); if (!el) return;
  if (visiblePwds.has(id)) {
    visiblePwds.delete(id); el.className = 'pwd-masked'; el.textContent = '● ● ● ● ● ● ● ● ● ●';
  } else {
    visiblePwds.add(id); el.className = 'pwd-revealed'; el.textContent = p._pwd || '(empty)';
    CV.addActivity('copy', `Revealed: ${p.name}`);
    setTimeout(() => { visiblePwds.delete(id); if (el) { el.className = 'pwd-masked'; el.textContent = '● ● ● ● ● ● ● ● ● ●'; } }, 15000);
  }
}
function toggleVis(id, btn) {
  const inp = document.getElementById(id);
  inp.type = inp.type === 'password' ? 'text' : 'password';
  btn.querySelector('svg').innerHTML = inp.type === 'text'
    ? '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/>'
    : '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>';
}
function toggleFieldVisibility(id, btn) { toggleVis(id, btn); }

// ── Copy Password ──
function copyPwd(id) {
  const p = CV.passwords.find(p => p.id === id); if (!p || !p._pwd) { toast('No password to copy', 'warn'); return; }
  navigator.clipboard.writeText(p._pwd).then(() => {
    toast(`Password copied — clears in ${CV.settings.clipboard}s`, 'success');
    CV.addActivity('copy', `Copied: ${p.name}`);
    clearTimeout(CV.clipboardTimer);
    CV.clipboardTimer = setTimeout(() => { navigator.clipboard.writeText('').catch(()=>{}); toast('Clipboard cleared', 'info'); }, CV.settings.clipboard * 1000);
  }).catch(() => toast('Copy failed', 'error'));
}

// ── Add / Edit / Delete ──
function openAddModal() {
  CV.editingId = null;
  document.getElementById('modal-title').textContent = 'Add Password';
  document.getElementById('edit-id').value = '';
  ['f-name','f-email','f-url','f-notes'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('f-pwd').value = ''; document.getElementById('f-pwd').type = 'password';
  document.getElementById('f-fav').checked = false; document.getElementById('f-cat').value = 'Other';
  document.getElementById('modal-strength-fill').style.cssText = 'width:0%';
  document.getElementById('modal-strength-label').textContent = 'Enter a password to check strength';
  document.getElementById('url-favicon-preview').classList.add('hidden');
  renderLinkedEditorList([]); show('pwd-modal');
}
function editPassword(id) {
  const p = CV.passwords.find(p => p.id === id); if (!p) return;
  CV.editingId = id;
  document.getElementById('modal-title').textContent = 'Edit Password';
  document.getElementById('edit-id').value = id;
  document.getElementById('f-name').value = p.name || '';
  document.getElementById('f-email').value = p.email || '';
  document.getElementById('f-pwd').value = p._pwd || ''; document.getElementById('f-pwd').type = 'password';
  document.getElementById('f-url').value = p.url || '';
  document.getElementById('f-notes').value = p.notes || '';
  document.getElementById('f-fav').checked = p.favorite || false;
  document.getElementById('f-cat').value = p.category || 'Other';
  updateModalStrength(); renderLinkedEditorList(p.linked || []); show('pwd-modal');
  updateFaviconPreview();
}
function closePwdModal() { hide('pwd-modal'); CV.editingId = null; }
function savePassword() {
  const name = document.getElementById('f-name').value.trim();
  const email = document.getElementById('f-email').value.trim();
  const pwd = document.getElementById('f-pwd').value;
  if (!name && !email) { toast('Enter a name or email', 'warn'); return; }
  if (!pwd) { toast('Enter a password', 'warn'); return; }
  const linked = getLinkedList();
  const svc = detectService(name, email);
  const entry = {
    id: CV.editingId || CV.uid(), name: name || svc.key || 'Unknown', email,
    _pwd: pwd, url: document.getElementById('f-url').value.trim(),
    notes: document.getElementById('f-notes').value.trim(),
    category: document.getElementById('f-cat').value,
    favorite: document.getElementById('f-fav').checked, linked,
    createdAt: Date.now(), updatedAt: Date.now(),
  };
  if (CV.editingId) {
    const idx = CV.passwords.findIndex(p => p.id === CV.editingId);
    if (idx !== -1) { entry.createdAt = CV.passwords[idx].createdAt; CV.passwords[idx] = entry; }
    CV.addActivity('edit', `Updated: ${entry.name}`); toast('Password updated', 'success');
  } else {
    CV.passwords.unshift(entry); CV.addActivity('add', `Added: ${entry.name}`); toast('Password saved with AES-256', 'success');
  }
  CV.saveLocal(); closePwdModal(); renderPasswords(); renderDashboard();
}
function deletePassword(id) {
  const p = CV.passwords.find(p => p.id === id);
  showConfirm('Delete Password', `Permanently delete "${p?.name || 'this entry'}"? This action cannot be undone.`, () => {
    CV.passwords = CV.passwords.filter(p => p.id !== id);
    CV.addActivity('delete', `Deleted: ${p?.name || id}`); CV.saveLocal(); renderPasswords(); renderDashboard();
    toast('Entry deleted', 'warn');
  });
}
function toggleFav(id) {
  const p = CV.passwords.find(p => p.id === id); if (!p) return;
  p.favorite = !p.favorite; CV.saveLocal(); renderPasswords();
  toast(p.favorite ? 'Added to favorites' : 'Removed from favorites', 'info');
}

// ── Linked Editor ──
function renderLinkedEditorList(items) {
  const list = document.getElementById('linked-editor-list');
  list.innerHTML = items.map((item, i) => `
    <div class="linked-edit-row">
      <span class="linked-edit-icon"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg></span>
      <input class="linked-edit-input" value="${esc(item)}" placeholder="e.g. Facebook, Netflix..." id="linked-${i}">
      <button class="linked-edit-del" onclick="this.closest('.linked-edit-row').remove()">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>`).join('');
}
function addLinkedField() {
  const list = document.getElementById('linked-editor-list');
  const div = document.createElement('div'); div.className = 'linked-edit-row';
  div.innerHTML = `<span class="linked-edit-icon"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg></span><input class="linked-edit-input" placeholder="e.g. Facebook, Netflix, Instagram..."><button class="linked-edit-del" onclick="this.closest('.linked-edit-row').remove()"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>`;
  list.appendChild(div); div.querySelector('input').focus();
}
function getLinkedList() { return Array.from(document.querySelectorAll('.linked-edit-input')).map(i => i.value.trim()).filter(Boolean); }

function autoDetectService() {
  const name = document.getElementById('f-name').value;
  const email = document.getElementById('f-email').value;
  if (!name && email) { const svc = detectService('', email); if (svc.key) document.getElementById('f-name').value = svc.key.charAt(0).toUpperCase() + svc.key.slice(1); }
}

// ── Dashboard ──
function renderDashboard() {
  const total = CV.passwords.length;
  const weak = CV.passwords.filter(p => passwordStrength(p._pwd||'').score < 3).length;
  const linkedTotal = CV.passwords.reduce((s, p) => s + (p.linked?.length || 0), 0);
  const health = total === 0 ? '—' : weak === 0 ? 'A+' : weak < total/4 ? 'B' : weak < total/2 ? 'C' : 'D';
  document.getElementById('stat-total').textContent = total;
  document.getElementById('stat-weak').textContent = weak;
  document.getElementById('stat-linked').textContent = linkedTotal;
  document.getElementById('stat-health').textContent = health;
  const recent = document.getElementById('dashboard-recent');
  const last5 = CV.passwords.slice(0, 4);
  recent.innerHTML = last5.length ? `<div class="cards-grid">${last5.map(p => cardHTML(p)).join('')}</div>` : `<div style="text-align:center;padding:24px;color:var(--t4);font-size:12px;font-family:var(--font-mono)">No passwords yet — add your first entry</div>`;
  renderActivity('dashboard');
}
function renderFavorites() {
  const grid = document.getElementById('fav-grid');
  const favs = CV.passwords.filter(p => p.favorite);
  grid.innerHTML = favs.length ? favs.map(p => cardHTML(p)).join('') : `<div class="empty"><div class="empty-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></div><div class="empty-title">No Favorites</div><div class="empty-sub">Star passwords to see them here</div></div>`;
}
function renderLinkedMap() {
  const panel = document.getElementById('linked-map-panel');
  const withLinks = CV.passwords.filter(p => p.linked?.length > 0);
  if (!withLinks.length) { panel.innerHTML = `<div class="empty"><div class="empty-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg></div><div class="empty-title">No Linked Accounts</div><div class="empty-sub">Add passwords with linked services to see the binding map</div></div>`; return; }
  panel.innerHTML = withLinks.map((p, idx) => {
    const svc = detectService(p.name, p.email);
    return `${idx > 0 ? '<hr style="border:none;border-top:1px solid var(--b1);margin:12px 0">' : ''}
    <div class="link-map-entry">
      <div class="link-map-primary">
        ${buildServiceIcon(p, svc)}
        <div style="flex:1">
          <div style="font-family:var(--font-head);font-size:14px;font-weight:700;color:var(--t1)">${esc(p.name)}</div>
          <div style="font-size:11px;color:var(--t3);font-family:var(--font-mono)">${esc(p.email)}</div>
        </div>
        <div class="risk-score-badge">${p.linked.length} AT RISK</div>
      </div>
      <div class="link-map-services">
        ${p.linked.map(l => `<div class="link-map-svc"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color:var(--violet-mid)"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/></svg>${esc(l)}</div>`).join('')}
      </div>
    </div>`;
  }).join('');
}
function renderActivity(target) {
  const logs = CV.activityLog.slice(0, target === 'dashboard' ? 5 : 100);
  const el = document.getElementById(target === 'dashboard' ? 'dashboard-activity' : 'activity-list');
  if (!el) return;
  el.innerHTML = logs.length ? logs.map(l => `<div class="activity-item"><div class="act-pip ${l.type}"></div><div class="act-text">${esc(l.text)}</div><div class="act-time">${l.time}</div></div>`).join('') : `<div style="text-align:center;padding:20px;color:var(--t4);font-size:12px;font-family:var(--font-mono)">No activity recorded yet</div>`;
}
function clearActivity() {
  showConfirm('Clear Activity Log', 'This will permanently delete all activity records from your vault.', () => {
    CV.activityLog = []; CV.saveLocal(); renderActivity(); toast('Activity log cleared', 'info');
  });
}

// ── Generator ──
let _genPwd = '';
function generatePassword() {
  const len = parseInt(document.getElementById('gen-length')?.value || 16);
  const upper = document.getElementById('gen-upper')?.checked;
  const lower = document.getElementById('gen-lower')?.checked;
  const nums = document.getElementById('gen-nums')?.checked;
  const syms = document.getElementById('gen-syms')?.checked;
  const noAmbig = document.getElementById('gen-ambig')?.checked;
  let chars = '';
  if (upper) chars += noAmbig ? 'ABCDEFGHJKLMNPQRSTUVWXYZ' : 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  if (lower) chars += noAmbig ? 'abcdefghjkmnpqrstuvwxyz' : 'abcdefghijklmnopqrstuvwxyz';
  if (nums)  chars += noAmbig ? '23456789' : '0123456789';
  if (syms)  chars += '!@#$%^&*()-_=+[]{}|;:,.<>?';
  if (!chars) chars = 'abcdefghijklmnopqrstuvwxyz';
  const arr = new Uint32Array(len); crypto.getRandomValues(arr);
  _genPwd = Array.from(arr).map(n => chars[n % chars.length]).join('');
  const el = document.getElementById('gen-output'); if (el) { el.textContent = _genPwd; el.style.animation = 'none'; void el.offsetWidth; el.style.animation = 'gen-flash 0.3s ease'; }
  const str = passwordStrength(_genPwd);
  const d = document.getElementById('gen-strength-display');
  if (d) d.innerHTML = `<div class="strength-track"><div class="strength-bar" style="width:${str.pct}%;background:${str.color}"></div></div><div class="strength-row"><span class="strength-label">STRENGTH</span><span class="strength-label" style="color:${str.color}">${str.label.toUpperCase()}</span></div>`;
}
function copyGenerated() {
  if (!_genPwd) { toast('Generate a password first', 'warn'); return; }
  navigator.clipboard.writeText(_genPwd).then(() => toast('Password copied to clipboard', 'success')).catch(() => {});
}
function fillGenerated() {
  if (!_genPwd) generatePassword();
  document.getElementById('f-pwd').value = _genPwd; updateModalStrength();
}

// ── Export / Import ──
function exportVault(fmt) {
  if (!CV.masterKey) { toast('Vault not unlocked', 'error'); return; }
  const enc = CV.encrypt(CV.passwords, CV.masterKey);
  const ts = new Date().toISOString().slice(0,19).replace(/:/g,'-');
  if (fmt === 'json') {
    dlBlob(new Blob([JSON.stringify({ version:'3.0', encrypted:true, vault:enc, exportedAt:ts, user:CV.user?.email },null,2)],{type:'application/json'}), `cybervault-backup-${ts}.json`);
  } else {
    const rows = [['Name','Email','EncryptedPassword','URL','Category','Linked','Notes']];
    CV.passwords.forEach(p => rows.push([p.name,p.email,CV.encrypt(p._pwd,CV.masterKey),p.url,p.category,(p.linked||[]).join('|'),p.notes]));
    dlBlob(new Blob([rows.map(r=>r.map(c=>`"${(c||'').replace(/"/g,'""')}"`).join(',')).join('\n')],{type:'text/csv'}), `cybervault-export-${ts}.csv`);
  }
  CV.addActivity('vault','Exported encrypted vault'); toast('Vault exported (encrypted)', 'success');
}
function dlBlob(blob, name) { const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = name; a.click(); }
function importVault(input) {
  const file = input.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const data = JSON.parse(e.target.result);
      if (!data.vault) throw new Error('Invalid backup file');
      const dec = CV.decrypt(data.vault, CV.masterKey);
      if (!dec) throw new Error('Decryption failed — wrong master password?');
      showConfirm('Import Vault', `Import ${dec.length} entries? This will merge with your existing data.`, () => {
        const ids = new Set(CV.passwords.map(p => p.id));
        dec.forEach(p => { if (!ids.has(p.id)) CV.passwords.push(p); });
        CV.saveLocal(); renderPasswords(); renderDashboard();
        CV.addActivity('vault', `Imported ${dec.length} entries`); toast(`Imported ${dec.length} entries`, 'success');
      });
    } catch(e) { toast('Import failed: ' + e.message, 'error'); }
  };
  reader.readAsText(file); input.value = '';
}
function confirmWipe() {
  showConfirm('Secure Wipe', 'This will PERMANENTLY DELETE ALL passwords from this device and cloud storage. This cannot be undone.', () => {
    CV.passwords = []; CV.activityLog = []; localStorage.removeItem(CV.storageKey('vault'));
    if (window._firebaseReady && CV.user) try { window._firebaseModules.deleteDoc(window._firebaseModules.doc(window._firebaseDb,'vaults',CV.user.uid)); } catch(e){}
    renderPasswords(); renderDashboard(); toast('Vault wiped securely', 'warn');
  });
}

// ── Settings ──
function loadSettings() {
  const s = localStorage.getItem(`cv_settings_${CV.user?.uid}`);
  if (s) try { Object.assign(CV.settings, JSON.parse(s)); } catch(e){}
  const al = document.getElementById('setting-autolock'); if (al) al.value = CV.settings.autolock || 300;
  const cl = document.getElementById('setting-clipboard'); if (cl) cl.value = CV.settings.clipboard || 30;
  const bl = document.getElementById('setting-blur'); if (bl) bl.checked = CV.settings.blur !== false;
  CV.inactivityMax = CV.settings.autolock || 300;
}
function saveSetting(key, value) {
  CV.settings[key] = value; localStorage.setItem(`cv_settings_${CV.user?.uid}`, JSON.stringify(CV.settings));
  if (key === 'autolock') { CV.inactivityMax = parseInt(value); CV.resetInactivity(); }
  if (key === 'clipboard') CV.settings.clipboard = parseInt(value);
  toast('Setting saved', 'success');
}

// ── Inactivity ──
function startInactivity() {
  stopInactivity(); CV.inactivityLeft = CV.inactivityMax;
  CV.inactivityTimer = setInterval(() => {
    CV.inactivityLeft--;
    const fill = document.getElementById('inactivity-fill');
    if (fill) fill.style.width = (CV.inactivityLeft / CV.inactivityMax * 100) + '%';
    if (CV.inactivityLeft <= 0) lockVault();
    if (CV.inactivityLeft === 30) toast('Auto-lock in 30 seconds', 'warn');
  }, 1000);
  ['mousemove','keydown','click','scroll','touchstart'].forEach(e => document.addEventListener(e, resetInactivity, { passive:true }));
}
function stopInactivity() {
  clearInterval(CV.inactivityTimer);
  ['mousemove','keydown','click','scroll','touchstart'].forEach(e => document.removeEventListener(e, resetInactivity));
}
function resetInactivity() { CV.inactivityLeft = CV.inactivityMax; }

document.addEventListener('visibilitychange', () => {
  const blur = document.hidden && CV.settings.blur !== false && !CV.vaultLocked;
  document.querySelectorAll('.pwd-revealed').forEach(el => { el.style.filter = blur ? 'blur(6px)' : ''; });
});

// ── Confirm Modal ──
function showConfirm(title, text, onOk) {
  document.getElementById('confirm-title').textContent = title;
  document.getElementById('confirm-text').textContent = text;
  document.getElementById('confirm-ok').onclick = () => { onOk(); closeConfirm(); };
  show('confirm-modal');
}
function closeConfirm() { hide('confirm-modal'); }

// ── Toast ──
function toast(msg, type='info') {
  const icons = {
    success: `<svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
    error:   `<svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>`,
    info:    `<svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>`,
    warn:    `<svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>`,
  };
  const t = document.createElement('div'); t.className = `toast ${type}`;
  t.innerHTML = `${icons[type]||icons.info}<div class="toast-msg">${msg}</div><button class="toast-close" onclick="this.parentElement.remove()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>`;
  document.getElementById('toastContainer').appendChild(t);
  setTimeout(() => { t.classList.add('removing'); setTimeout(() => t.remove(), 250); }, 3500);
}

// ── Utils ──
function show(id) { const el = document.getElementById(id); if (el) el.classList.remove('hidden'); }
function hide(id) { const el = document.getElementById(id); if (el) el.classList.add('hidden'); }

// ── Keyboard Shortcuts ──
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') { hide('pwd-modal'); hide('master-modal'); hide('confirm-modal'); closeSidebar(); }
  if (e.ctrlKey && e.key === 'l') { e.preventDefault(); lockVault(); }
  if (e.ctrlKey && e.key === 'n' && !CV.vaultLocked) { e.preventDefault(); openAddModal(); }
});
document.getElementById('login-password').addEventListener('keydown', e => { if (e.key === 'Enter') handleLogin(); });
document.getElementById('master-input').addEventListener('keydown', e => { if (e.key === 'Enter') unlockVault(); });

// ── CSS for gen-flash ──
const genFlashStyle = document.createElement('style');
genFlashStyle.textContent = `@keyframes gen-flash { 0%{opacity:0.4;transform:scale(0.98)} 100%{opacity:1;transform:scale(1)} }`;
document.head.appendChild(genFlashStyle);

// ── Init ──
(function init() {
  if (window._firebaseReady) {
    const check = setInterval(() => {
      if (window._firebaseModules) {
        clearInterval(check);
        window._firebaseModules.onAuthStateChanged(window._firebaseAuth, user => {
          if (user) {
            CV.user = { uid: user.uid, email: user.email };
            const hash = localStorage.getItem(`cv_${CV.user.uid}_master`);
            if (hash) { CV.masterHash = hash; hide('auth-screen'); showVaultScreen(); }
          }
        });
      }
    }, 100);
  }
  setTimeout(generatePassword, 600);
})();
</script>
</body>
</html>

</html>
